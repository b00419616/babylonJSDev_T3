const __vite__fileDeps=["assets/flowGraphCodeExecutionBlock-BBI7KaOi.js","assets/nativeXRFrame-DOeo_lEL.js","assets/flowGraphGLTFDataProvider-C4kuehID.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{L as C,a9 as _,aa as sr,ab as Vn,ac as Wt,ad as ar,c as ir,ae as lr,n as cr,af as ur,l as M,ag as hr,O as oe,ah as dr,ai as Dn,aj as _r,ak as pr,m as ee,a4 as fr,V as G,j as qe,T as $,al as Oe,am as $n,a0 as Hn,t as Kn,an as Yt,b as Xt,C as V,ao as _e,q as Te,ap as x,aq as j,H as Un,D as Jt,ar as Zt,as as ye,F as Vt,at as qn,d as Ne,au as Ze,av as mr,aw as yr,ax as Wn,ay as gr,a2 as N,f as kn,az as wr,aA as br,aB as Ar,aC as Tr,aD as W,aE as xr,aF as Er,aG as vr,w as he,aH as kr,aI as Br,aJ as Ir,aK as Fr,aL as Yn,aM as Bn,aN as Or,i as Cr,aO as Gr,y as Rt,aP as Pr}from"./nativeXRFrame-DOeo_lEL.js";class Qt{constructor(e,t,n){this.frame=e,this.action=t,this.onlyOnce=n,this.isDone=!1}_clone(){return new Qt(this.frame,this.action,this.onlyOnce)}}class Nr{constructor(e,t,n){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],t.length!==n.length)throw new Error("Sounds length does not equal weights length");this.loop=e,this._weights=n;let o=0;for(const a of n)o+=a;const s=o>0?1/o:0;for(let a=0;a<this._weights.length;a++)this._weights[a]*=s;this._sounds=t;for(const a of this._sounds)a.onEndedObservable.add(()=>{this._onended()})}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(e){if(e!==this._coneInnerAngle){if(this._coneOuterAngle<e){C.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");return}this._coneInnerAngle=e;for(const t of this._sounds)t.directionalConeInnerAngle=e}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(e){if(e!==this._coneOuterAngle){if(e<this._coneInnerAngle){C.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");return}this._coneOuterAngle=e;for(const t of this._sounds)t.directionalConeOuterAngle=e}}get volume(){return this._volume}set volume(e){if(e!==this._volume)for(const t of this._sounds)t.setVolume(e)}_onended(){this._currentIndex!==void 0&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,this._currentIndex!==void 0&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,this._currentIndex!==void 0&&this._sounds[this._currentIndex].stop()}play(e){if(!this.isPaused){this.stop();const n=Math.random();let o=0;for(let s=0;s<this._weights.length;s++)if(o+=this._weights[s],n<=o){this._currentIndex=s;break}}const t=this._sounds[this._currentIndex??0];t.isReady()?t.play(0,this.isPaused?void 0:e):t.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}const Dt={};function Lr(r,e,t){Dt[`${r}/${e}`]=t}function Sr(r){switch(r){case"FlowGraphPlayAnimationBlock":return async()=>(await _(async()=>{const{FlowGraphPlayAnimationBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bG);return{FlowGraphPlayAnimationBlock:e}},[])).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await _(async()=>{const{FlowGraphStopAnimationBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bH);return{FlowGraphStopAnimationBlock:e}},[])).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await _(async()=>{const{FlowGraphPauseAnimationBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bI);return{FlowGraphPauseAnimationBlock:e}},[])).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await _(async()=>{const{FlowGraphInterpolationBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bJ);return{FlowGraphInterpolationBlock:e}},[])).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await _(async()=>{const{FlowGraphSceneReadyEventBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.c4);return{FlowGraphSceneReadyEventBlock:e}},[])).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await _(async()=>{const{FlowGraphSceneTickEventBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.c7);return{FlowGraphSceneTickEventBlock:e}},[])).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await _(async()=>{const{FlowGraphSendCustomEventBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.c6);return{FlowGraphSendCustomEventBlock:e}},[])).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await _(async()=>{const{FlowGraphReceiveCustomEventBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.c5);return{FlowGraphReceiveCustomEventBlock:e}},[])).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await _(async()=>{const{FlowGraphMeshPickEventBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.c3);return{FlowGraphMeshPickEventBlock:e}},[])).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await _(async()=>{const{FlowGraphEBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphEBlock:e}},[])).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await _(async()=>{const{FlowGraphPiBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphPiBlock:e}},[])).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await _(async()=>{const{FlowGraphInfBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphInfBlock:e}},[])).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await _(async()=>{const{FlowGraphNaNBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphNaNBlock:e}},[])).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await _(async()=>{const{FlowGraphRandomBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphRandomBlock:e}},[])).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await _(async()=>{const{FlowGraphAddBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphAddBlock:e}},[])).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await _(async()=>{const{FlowGraphSubtractBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphSubtractBlock:e}},[])).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await _(async()=>{const{FlowGraphMultiplyBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphMultiplyBlock:e}},[])).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await _(async()=>{const{FlowGraphDivideBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphDivideBlock:e}},[])).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await _(async()=>{const{FlowGraphAbsBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphAbsBlock:e}},[])).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await _(async()=>{const{FlowGraphSignBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphSignBlock:e}},[])).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await _(async()=>{const{FlowGraphTruncBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphTruncBlock:e}},[])).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await _(async()=>{const{FlowGraphFloorBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphFloorBlock:e}},[])).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await _(async()=>{const{FlowGraphCeilBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphCeilBlock:e}},[])).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await _(async()=>{const{FlowGraphRoundBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphRoundBlock:e}},[])).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await _(async()=>{const{FlowGraphFractionBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphFractionBlock:e}},[])).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await _(async()=>{const{FlowGraphNegationBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphNegationBlock:e}},[])).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await _(async()=>{const{FlowGraphModuloBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphModuloBlock:e}},[])).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await _(async()=>{const{FlowGraphMinBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphMinBlock:e}},[])).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await _(async()=>{const{FlowGraphMaxBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphMaxBlock:e}},[])).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await _(async()=>{const{FlowGraphClampBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphClampBlock:e}},[])).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await _(async()=>{const{FlowGraphSaturateBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphSaturateBlock:e}},[])).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await _(async()=>{const{FlowGraphMathInterpolationBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphMathInterpolationBlock:e}},[])).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await _(async()=>{const{FlowGraphEqualityBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphEqualityBlock:e}},[])).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await _(async()=>{const{FlowGraphLessThanBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphLessThanBlock:e}},[])).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await _(async()=>{const{FlowGraphLessThanOrEqualBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphLessThanOrEqualBlock:e}},[])).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await _(async()=>{const{FlowGraphGreaterThanBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphGreaterThanBlock:e}},[])).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await _(async()=>{const{FlowGraphGreaterThanOrEqualBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphGreaterThanOrEqualBlock:e}},[])).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await _(async()=>{const{FlowGraphIsNanBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphIsNanBlock:e}},[])).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await _(async()=>{const{FlowGraphIsInfinityBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphIsInfinityBlock:e}},[])).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await _(async()=>{const{FlowGraphDegToRadBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphDegToRadBlock:e}},[])).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await _(async()=>{const{FlowGraphRadToDegBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphRadToDegBlock:e}},[])).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await _(async()=>{const{FlowGraphSinBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphSinBlock:e}},[])).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await _(async()=>{const{FlowGraphCosBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphCosBlock:e}},[])).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await _(async()=>{const{FlowGraphTanBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphTanBlock:e}},[])).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await _(async()=>{const{FlowGraphAsinBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphAsinBlock:e}},[])).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await _(async()=>{const{FlowGraphAcosBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphAcosBlock:e}},[])).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await _(async()=>{const{FlowGraphAtanBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphAtanBlock:e}},[])).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await _(async()=>{const{FlowGraphAtan2Block:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphAtan2Block:e}},[])).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await _(async()=>{const{FlowGraphSinhBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphSinhBlock:e}},[])).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await _(async()=>{const{FlowGraphCoshBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphCoshBlock:e}},[])).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await _(async()=>{const{FlowGraphTanhBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphTanhBlock:e}},[])).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await _(async()=>{const{FlowGraphAsinhBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphAsinhBlock:e}},[])).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await _(async()=>{const{FlowGraphAcoshBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphAcoshBlock:e}},[])).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await _(async()=>{const{FlowGraphAtanhBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphAtanhBlock:e}},[])).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await _(async()=>{const{FlowGraphExpBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphExpBlock:e}},[])).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await _(async()=>{const{FlowGraphLogBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphLogBlock:e}},[])).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await _(async()=>{const{FlowGraphLog2Block:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphLog2Block:e}},[])).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await _(async()=>{const{FlowGraphLog10Block:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphLog10Block:e}},[])).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await _(async()=>{const{FlowGraphSquareRootBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphSquareRootBlock:e}},[])).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await _(async()=>{const{FlowGraphPowerBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphPowerBlock:e}},[])).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await _(async()=>{const{FlowGraphCubeRootBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphCubeRootBlock:e}},[])).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await _(async()=>{const{FlowGraphBitwiseAndBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphBitwiseAndBlock:e}},[])).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await _(async()=>{const{FlowGraphBitwiseOrBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphBitwiseOrBlock:e}},[])).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await _(async()=>{const{FlowGraphBitwiseNotBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphBitwiseNotBlock:e}},[])).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await _(async()=>{const{FlowGraphBitwiseXorBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphBitwiseXorBlock:e}},[])).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await _(async()=>{const{FlowGraphBitwiseLeftShiftBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphBitwiseLeftShiftBlock:e}},[])).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await _(async()=>{const{FlowGraphBitwiseRightShiftBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphBitwiseRightShiftBlock:e}},[])).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await _(async()=>{const{FlowGraphLengthBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bY);return{FlowGraphLengthBlock:e}},[])).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await _(async()=>{const{FlowGraphNormalizeBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bY);return{FlowGraphNormalizeBlock:e}},[])).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await _(async()=>{const{FlowGraphDotBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bY);return{FlowGraphDotBlock:e}},[])).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await _(async()=>{const{FlowGraphCrossBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bY);return{FlowGraphCrossBlock:e}},[])).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await _(async()=>{const{FlowGraphRotate2DBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bY);return{FlowGraphRotate2DBlock:e}},[])).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await _(async()=>{const{FlowGraphRotate3DBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bY);return{FlowGraphRotate3DBlock:e}},[])).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await _(async()=>{const{FlowGraphTransposeBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bX);return{FlowGraphTransposeBlock:e}},[])).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await _(async()=>{const{FlowGraphDeterminantBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bX);return{FlowGraphDeterminantBlock:e}},[])).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await _(async()=>{const{FlowGraphInvertMatrixBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bX);return{FlowGraphInvertMatrixBlock:e}},[])).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await _(async()=>{const{FlowGraphMatrixMultiplicationBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bX);return{FlowGraphMatrixMultiplicationBlock:e}},[])).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await _(async()=>{const{FlowGraphBranchBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bs);return{FlowGraphBranchBlock:e}},[])).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await _(async()=>{const{FlowGraphSetDelayBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bE);return{FlowGraphSetDelayBlock:e}},[])).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await _(async()=>{const{FlowGraphCancelDelayBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bF);return{FlowGraphCancelDelayBlock:e}},[])).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await _(async()=>{const{FlowGraphCallCounterBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bz);return{FlowGraphCallCounterBlock:e}},[])).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await _(async()=>{const{FlowGraphDebounceBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bB);return{FlowGraphDebounceBlock:e}},[])).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await _(async()=>{const{FlowGraphThrottleBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bv);return{FlowGraphThrottleBlock:e}},[])).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await _(async()=>{const{FlowGraphDoNBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bt);return{FlowGraphDoNBlock:e}},[])).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await _(async()=>{const{FlowGraphFlipFlopBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bC);return{FlowGraphFlipFlopBlock:e}},[])).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await _(async()=>{const{FlowGraphForLoopBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bu);return{FlowGraphForLoopBlock:e}},[])).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await _(async()=>{const{FlowGraphMultiGateBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bw);return{FlowGraphMultiGateBlock:e}},[])).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await _(async()=>{const{FlowGraphSequenceBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bD);return{FlowGraphSequenceBlock:e}},[])).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await _(async()=>{const{FlowGraphSwitchBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bx);return{FlowGraphSwitchBlock:e}},[])).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await _(async()=>{const{FlowGraphWaitAllBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.by);return{FlowGraphWaitAllBlock:e}},[])).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await _(async()=>{const{FlowGraphWhileLoopBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bA);return{FlowGraphWhileLoopBlock:e}},[])).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await _(async()=>{const{FlowGraphConsoleLogBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.br);return{FlowGraphConsoleLogBlock:e}},[])).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await _(async()=>{const{FlowGraphConditionalDataBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bM);return{FlowGraphConditionalDataBlock:e}},[])).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await _(async()=>{const{FlowGraphConstantBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bS);return{FlowGraphConstantBlock:e}},[])).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await _(async()=>{const{FlowGraphTransformCoordinatesSystemBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bP);return{FlowGraphTransformCoordinatesSystemBlock:e}},[])).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await _(async()=>{const{FlowGraphGetAssetBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bT);return{FlowGraphGetAssetBlock:e}},[])).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await _(async()=>{const{FlowGraphGetPropertyBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bQ);return{FlowGraphGetPropertyBlock:e}},[])).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await _(async()=>{const{FlowGraphSetPropertyBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bR);return{FlowGraphSetPropertyBlock:e}},[])).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await _(async()=>{const{FlowGraphGetVariableBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bN);return{FlowGraphGetVariableBlock:e}},[])).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await _(async()=>{const{FlowGraphSetVariableBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bO);return{FlowGraphSetVariableBlock:e}},[])).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await _(async()=>{const{FlowGraphJsonPointerParserBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bZ);return{FlowGraphJsonPointerParserBlock:e}},[])).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await _(async()=>{const{FlowGraphLeadingZerosBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphLeadingZerosBlock:e}},[])).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await _(async()=>{const{FlowGraphTrailingZerosBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphTrailingZerosBlock:e}},[])).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await _(async()=>{const{FlowGraphOneBitsCounterBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bV);return{FlowGraphOneBitsCounterBlock:e}},[])).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await _(async()=>{const{FlowGraphCombineVector2Block:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bW);return{FlowGraphCombineVector2Block:e}},[])).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await _(async()=>{const{FlowGraphCombineVector3Block:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bW);return{FlowGraphCombineVector3Block:e}},[])).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await _(async()=>{const{FlowGraphCombineVector4Block:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bW);return{FlowGraphCombineVector4Block:e}},[])).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await _(async()=>{const{FlowGraphCombineMatrixBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bW);return{FlowGraphCombineMatrixBlock:e}},[])).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await _(async()=>{const{FlowGraphExtractVector2Block:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bW);return{FlowGraphExtractVector2Block:e}},[])).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await _(async()=>{const{FlowGraphExtractVector3Block:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bW);return{FlowGraphExtractVector3Block:e}},[])).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await _(async()=>{const{FlowGraphExtractVector4Block:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bW);return{FlowGraphExtractVector4Block:e}},[])).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await _(async()=>{const{FlowGraphExtractMatrixBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bW);return{FlowGraphExtractMatrixBlock:e}},[])).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await _(async()=>{const{FlowGraphTransformBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bY);return{FlowGraphTransformBlock:e}},[])).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await _(async()=>{const{FlowGraphTransformCoordinatesBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bY);return{FlowGraphTransformCoordinatesBlock:e}},[])).FlowGraphTransformCoordinatesBlock;case"FlowGraphMatrixDecompose":return async()=>(await _(async()=>{const{FlowGraphMatrixDecomposeBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bX);return{FlowGraphMatrixDecomposeBlock:e}},[])).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await _(async()=>{const{FlowGraphMatrixComposeBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bX);return{FlowGraphMatrixComposeBlock:e}},[])).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await _(async()=>{const{FlowGraphBooleanToFloat:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.b_);return{FlowGraphBooleanToFloat:e}},[])).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await _(async()=>{const{FlowGraphBooleanToInt:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.b_);return{FlowGraphBooleanToInt:e}},[])).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await _(async()=>{const{FlowGraphFloatToBoolean:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.b_);return{FlowGraphFloatToBoolean:e}},[])).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await _(async()=>{const{FlowGraphIntToBoolean:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.b_);return{FlowGraphIntToBoolean:e}},[])).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await _(async()=>{const{FlowGraphIntToFloat:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.b_);return{FlowGraphIntToFloat:e}},[])).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await _(async()=>{const{FlowGraphFloatToInt:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.b_);return{FlowGraphFloatToInt:e}},[])).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await _(async()=>{const{FlowGraphEasingBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bK);return{FlowGraphEasingBlock:e}},[])).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await _(async()=>{const{FlowGraphBezierCurveEasingBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bL);return{FlowGraphBezierCurveEasingBlock:e}},[])).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await _(async()=>{const{FlowGraphPointerOverEventBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.c9);return{FlowGraphPointerOverEventBlock:e}},[])).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await _(async()=>{const{FlowGraphPointerOutEventBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.c8);return{FlowGraphPointerOutEventBlock:e}},[])).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await _(async()=>{const{FlowGraphContextBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.b$);return{FlowGraphContextBlock:e}},[])).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await _(async()=>{const{FlowGraphArrayIndexBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.c0);return{FlowGraphArrayIndexBlock:e}},[])).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await _(async()=>{const{FlowGraphCodeExecutionBlock:e}=await import("./flowGraphCodeExecutionBlock-BBI7KaOi.js");return{FlowGraphCodeExecutionBlock:e}},__vite__mapDeps([0,1]))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await _(async()=>{const{FlowGraphIndexOfBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.c1);return{FlowGraphIndexOfBlock:e}},[])).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await _(async()=>{const{FlowGraphFunctionReferenceBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.c2);return{FlowGraphFunctionReferenceBlock:e}},[])).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await _(async()=>{const{FlowGraphDataSwitchBlock:e}=await import("./nativeXRFrame-DOeo_lEL.js").then(t=>t.bU);return{FlowGraphDataSwitchBlock:e}},[])).FlowGraphDataSwitchBlock;default:if(Dt[r])return Dt[r];throw new Error(`Unknown block name ${r}`)}}function Rr(r,e){for(const t of r)for(const n of t.dataOutputs)if(n.uniqueId===e)return n;throw new Error("Could not find data out connection with unique id "+e)}function Mr(r,e){for(const t of r)if(t instanceof Vn){for(const n of t.signalInputs)if(n.uniqueId===e)return n}throw new Error("Could not find signal in connection with unique id "+e)}async function Vr(r,e){const t=await Promise.all(r.allBlocks.map(async n=>Sr(n.className)()));return Dr(r,e,t)}function Dr(r,e,t){const n=e.coordinator.createGraph(),o=[],s=e.valueParseFunction??Wt;for(let a=0;a<r.allBlocks.length;a++){const i=r.allBlocks[a],l=Hr(i,{scene:e.coordinator.config.scene,pathConverter:e.pathConverter,assetsContainer:e.coordinator.config.scene,valueParseFunction:s},t[a]);o.push(l),l instanceof sr&&n.addEventBlock(l)}for(const a of o){for(const i of a.dataInputs)for(const l of i.connectedPointIds){const c=Rr(o,l);i.connectTo(c)}if(a instanceof Vn)for(const i of a.signalOutputs)for(const l of i.connectedPointIds){const c=Mr(o,l);i.connectTo(c)}}for(const a of r.executionContexts)$r(a,{graph:n,valueParseFunction:s},r.rightHanded);return n}function $r(r,e,t){var a,i,l,c,u,h,d,p,m,b;const n=e.graph.createContext();r.enableLogging&&(n.enableLogging=!0),n.treatDataAsRightHanded=t||!1;const o=e.valueParseFunction??Wt;n.uniqueId=r.uniqueId;const s=n.getScene();if(r._assetsContext){const A=r._assetsContext,E={meshes:(a=A.meshes)==null?void 0:a.map(I=>s.getMeshById(I)),lights:(i=A.lights)==null?void 0:i.map(I=>s.getLightByName(I)),cameras:(l=A.cameras)==null?void 0:l.map(I=>s.getCameraByName(I)),materials:(c=A.materials)==null?void 0:c.map(I=>s.getMaterialById(I)),textures:(u=A.textures)==null?void 0:u.map(I=>s.getTextureByName(I)),animations:(h=A.animations)==null?void 0:h.map(I=>s.animations.find(P=>P.name===I)),skeletons:(d=A.skeletons)==null?void 0:d.map(I=>s.getSkeletonByName(I)),particleSystems:(p=A.particleSystems)==null?void 0:p.map(I=>s.getParticleSystemById(I)),animationGroups:(m=A.animationGroups)==null?void 0:m.map(I=>s.getAnimationGroupByName(I)),transformNodes:(b=A.transformNodes)==null?void 0:b.map(I=>s.getTransformNodeById(I)),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],sounds:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};n.assetsContext=E}for(const A in r._userVariables){const E=o(A,r._userVariables,n.assetsContext,s);n.userVariables[A]=E}for(const A in r._connectionValues){const E=o(A,r._connectionValues,n.assetsContext,s);n._setConnectionValueByKey(A,E)}return n}function Hr(r,e,t){const n={},o=e.valueParseFunction??Wt;if(r.config)for(const a in r.config)n[a]=o(a,r.config,e.assetsContainer||e.scene,e.scene);if(ar(r.className)){if(!e.pathConverter)throw new Error("Path converter is required for this block");n.pathConverter=e.pathConverter}const s=new t(n);s.uniqueId=r.uniqueId;for(let a=0;a<r.dataInputs.length;a++){const i=s.getDataInput(r.dataInputs[a].name);if(i)i.deserialize(r.dataInputs[a]);else throw new Error("Could not find data input with name "+r.dataInputs[a].name+" in block "+r.className)}for(let a=0;a<r.dataOutputs.length;a++){const i=s.getDataOutput(r.dataOutputs[a].name);if(i)i.deserialize(r.dataOutputs[a]);else throw new Error("Could not find data output with name "+r.dataOutputs[a].name+" in block "+r.className)}return s.metadata=r.metadata,s.deserialize&&s.deserialize(r),s}class jt extends ir{constructor(e,t,n,o=5,s=0,a=!1,i=!1,l=3,c=null){super("",e),this._texture=e.getEngine().createRawCubeTexture(t,n,o,s,a,i,l,c)}update(e,t,n,o,s=null){this._texture.getEngine().updateRawCubeTexture(this._texture,e,t,n,o,s)}updateRGBDAsync(e,t=null,n=.8,o=0){return lr(this._texture,e,t,n,o).then(()=>{})}clone(){return cr.Clone(()=>{const e=this.getScene(),t=this._texture,n=new jt(e,t._bufferViewArray,t.width,t.format,t.type,t.generateMipMaps,t.invertY,t.samplingMode,t._compression);return t.source===13&&n.updateRGBDAsync(t._bufferViewArrayArray,t._sphericalPolynomial,t._lodGenerationScale,t._lodGenerationOffset),n},this)}}class He{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}}class je{constructor(e){this.byteOffset=0,this.buffer=e}loadAsync(e){return this.buffer.readAsync(this.byteOffset,e).then(t=>{this._dataView=new DataView(t.buffer,t.byteOffset,t.byteLength),this._dataByteOffset=0})}readUint32(){const e=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,e}readUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,e);return this._dataByteOffset+=e,this.byteOffset+=e,t}readString(e){return ur(this.readUint8Array(e))}skipBytes(e){this._dataByteOffset+=e,this.byteOffset+=e}}function $t(r,e,t,n){const o={externalResourceFunction:n};return t&&(o.uri=e==="file:"?t:e+t),ArrayBuffer.isView(r)?GLTFValidator.validateBytes(r,o):GLTFValidator.validateString(r,o)}function Kr(){const r=[];onmessage=e=>{const t=e.data;switch(t.id){case"init":{importScripts(t.url);break}case"validate":{$t(t.data,t.rootUrl,t.fileName,n=>new Promise((o,s)=>{const a=r.length;r.push({resolve:o,reject:s}),postMessage({id:"getExternalResource",index:a,uri:n})})).then(n=>{postMessage({id:"validate.resolve",value:n})},n=>{postMessage({id:"validate.reject",reason:n})});break}case"getExternalResource.resolve":{r[t.index].resolve(t.value);break}case"getExternalResource.reject":{r[t.index].reject(t.reason);break}}}}class Xn{static ValidateAsync(e,t,n,o){return typeof Worker=="function"?new Promise((s,a)=>{const i=`${$t}(${Kr})()`,l=URL.createObjectURL(new Blob([i],{type:"application/javascript"})),c=new Worker(l),u=d=>{c.removeEventListener("error",u),c.removeEventListener("message",h),a(d)},h=d=>{const p=d.data;switch(p.id){case"getExternalResource":{o(p.uri).then(m=>{c.postMessage({id:"getExternalResource.resolve",index:p.index,value:m},[m.buffer])},m=>{c.postMessage({id:"getExternalResource.reject",index:p.index,reason:m})});break}case"validate.resolve":{c.removeEventListener("error",u),c.removeEventListener("message",h),s(p.value),c.terminate();break}case"validate.reject":c.removeEventListener("error",u),c.removeEventListener("message",h),a(p.reason),c.terminate()}};if(c.addEventListener("error",u),c.addEventListener("message",h),c.postMessage({id:"init",url:M.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(e)){const d=e.slice();c.postMessage({id:"validate",data:d,rootUrl:t,fileName:n},[d.buffer])}else c.postMessage({id:"validate",data:e,rootUrl:t,fileName:n})}):(this._LoadScriptPromise||(this._LoadScriptPromise=M.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then(()=>$t(e,t,n,o)))}}Xn.Configuration={url:`${M._DefaultCdnUrl}/gltf_validator.js`};const Ee="Z2xURg",ze={name:"gltf",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad(r){return r.indexOf("asset")!==-1&&r.indexOf("version")!==-1||r.startsWith("data:base64,"+Ee)||r.startsWith("data:;base64,"+Ee)||r.startsWith("data:application/octet-stream;base64,"+Ee)||r.startsWith("data:model/gltf-binary;base64,"+Ee)}};function In(r,e,t){try{return Promise.resolve(new Uint8Array(r,e,t))}catch(n){return Promise.reject(n)}}function Ur(r,e,t){try{if(e<0||e>=r.byteLength)throw new RangeError("Offset is out of range.");if(e+t>r.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(r.buffer,r.byteOffset+e,t))}catch(n){return Promise.reject(n)}}var We;(function(r){r[r.AUTO=0]="AUTO",r[r.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"})(We||(We={}));var Pe;(function(r){r[r.NONE=0]="NONE",r[r.FIRST=1]="FIRST",r[r.ALL=2]="ALL"})(Pe||(Pe={}));var le;(function(r){r[r.LOADING=0]="LOADING",r[r.READY=1]="READY",r[r.COMPLETE=2]="COMPLETE"})(le||(le={}));class qr{constructor(){this.coordinateSystemMode=We.AUTO,this.animationStartMode=Pe.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=e=>Promise.resolve(e),this.extensionOptions={}}copyFrom(e){e&&(this.onParsed=e.onParsed,this.coordinateSystemMode=e.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=e.animationStartMode??this.animationStartMode,this.loadNodeAnimations=e.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=e.loadSkins??this.loadSkins,this.loadMorphTargets=e.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=e.compileMaterials??this.compileMaterials,this.useClipPlane=e.useClipPlane??this.useClipPlane,this.compileShadowGenerators=e.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=e.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=e.useRangeRequests??this.useRangeRequests,this.createInstances=e.createInstances??this.createInstances,this.alwaysComputeBoundingBox=e.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=e.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=e.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=e.skipMaterials??this.skipMaterials,this.useSRGBBuffers=e.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=e.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=e.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=e.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=e.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=e.customRootNode,this.onMeshLoaded=e.onMeshLoaded,this.onSkinLoaded=e.onSkinLoaded,this.onTextureLoaded=e.onTextureLoaded,this.onMaterialLoaded=e.onMaterialLoaded,this.onCameraLoaded=e.onCameraLoaded,this.extensionOptions=e.extensionOptions??this.extensionOptions)}}class Q extends qr{constructor(e){super(),this.onParsedObservable=new oe,this.onMeshLoadedObservable=new oe,this.onSkinLoadedObservable=new oe,this.onTextureLoadedObservable=new oe,this.onMaterialLoadedObservable=new oe,this.onCameraLoadedObservable=new oe,this.onCompleteObservable=new oe,this.onErrorObservable=new oe,this.onDisposeObservable=new oe,this.onExtensionLoadedObservable=new oe,this.validate=!1,this.onValidatedObservable=new oe,this._loader=null,this._state=null,this._requests=new Array,this.name=ze.name,this.extensions=ze.extensions,this.onLoaderStateChangedObservable=new oe,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.copyFrom(e)}set onParsed(e){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),e&&(this._onParsedObserver=this.onParsedObservable.add(e))}set onMeshLoaded(e){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),e&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(e))}set onSkinLoaded(e){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),e&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add(t=>e(t.node,t.skinnedNode)))}set onTextureLoaded(e){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),e&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(e))}set onMaterialLoaded(e){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),e&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(e))}set onCameraLoaded(e){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),e&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(e))}set onComplete(e){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(e)}set onError(e){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(e)}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}set onExtensionLoaded(e){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(e)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(e){this._loggingEnabled!==e&&(this._loggingEnabled=e,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(e){this._capturePerformanceCounters!==e&&(this._capturePerformanceCounters=e,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(e){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(e)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const e of this._requests)e.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=e=>Promise.resolve(e),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()}loadFile(e,t,n,o,s,a,i,l){if(ArrayBuffer.isView(t))return this._loadBinary(e,t,n,o,i,l),null;this._progressCallback=s;const c=t.name||M.GetFilename(t);if(a){if(this.useRangeRequests){this.validate&&C.Warn("glTF validation is not supported when range requests are enabled");const u={abort:()=>{},onCompleteObservable:new oe},h={readAsync:(d,p)=>new Promise((m,b)=>{this._loadFile(e,t,A=>{m(new Uint8Array(A))},!0,A=>{b(A)},A=>{A.setRequestHeader("Range",`bytes=${d}-${d+p-1}`)})}),byteLength:0};return this._unpackBinaryAsync(new je(h)).then(d=>{u.onCompleteObservable.notifyObservers(u),o(d)},i?d=>i(void 0,d):void 0),u}return this._loadFile(e,t,u=>{this._validate(e,new Uint8Array(u,0,u.byteLength),n,c),this._unpackBinaryAsync(new je({readAsync:(h,d)=>In(u,h,d),byteLength:u.byteLength})).then(h=>{o(h)},i?h=>i(void 0,h):void 0)},!0,i)}else return this._loadFile(e,t,u=>{try{this._validate(e,u,n,c),o({json:this._parseJson(u)})}catch{i&&i()}},!1,i)}_loadBinary(e,t,n,o,s,a){this._validate(e,new Uint8Array(t.buffer,t.byteOffset,t.byteLength),n,a),this._unpackBinaryAsync(new je({readAsync:(i,l)=>Ur(t,i,l),byteLength:t.byteLength})).then(i=>{o(i)},s?i=>s(void 0,i):void 0)}importMeshAsync(e,t,n,o,s,a){return Promise.resolve().then(()=>(this.onParsedObservable.notifyObservers(n),this.onParsedObservable.clear(),this._log(`Loading ${a||""}`),this._loader=this._getLoader(n),this._loader.importMeshAsync(e,t,null,n,o,s,a)))}loadAsync(e,t,n,o,s){return Promise.resolve().then(()=>(this.onParsedObservable.notifyObservers(t),this.onParsedObservable.clear(),this._log(`Loading ${s||""}`),this._loader=this._getLoader(t),this._loader.loadAsync(e,t,n,o,s)))}loadAssetContainerAsync(e,t,n,o,s){return Promise.resolve().then(()=>{this.onParsedObservable.notifyObservers(t),this.onParsedObservable.clear(),this._log(`Loading ${s||""}`),this._loader=this._getLoader(t);const a=new dr(e),i=[];this.onMaterialLoadedObservable.add(h=>{i.push(h)});const l=[];this.onTextureLoadedObservable.add(h=>{l.push(h)});const c=[];this.onCameraLoadedObservable.add(h=>{c.push(h)});const u=[];return this.onMeshLoadedObservable.add(h=>{h.morphTargetManager&&u.push(h.morphTargetManager)}),this._loader.importMeshAsync(null,e,a,t,n,o,s).then(h=>(Array.prototype.push.apply(a.geometries,h.geometries),Array.prototype.push.apply(a.meshes,h.meshes),Array.prototype.push.apply(a.particleSystems,h.particleSystems),Array.prototype.push.apply(a.skeletons,h.skeletons),Array.prototype.push.apply(a.animationGroups,h.animationGroups),Array.prototype.push.apply(a.materials,i),Array.prototype.push.apply(a.textures,l),Array.prototype.push.apply(a.lights,h.lights),Array.prototype.push.apply(a.transformNodes,h.transformNodes),Array.prototype.push.apply(a.cameras,c),Array.prototype.push.apply(a.morphTargetManagers,u),a))})}canDirectLoad(e){return ze.canDirectLoad(e)}directLoad(e,t){if(t.startsWith("base64,"+Ee)||t.startsWith(";base64,"+Ee)||t.startsWith("application/octet-stream;base64,"+Ee)||t.startsWith("model/gltf-binary;base64,"+Ee)){const n=Dn(t);return this._validate(e,new Uint8Array(n,0,n.byteLength)),this._unpackBinaryAsync(new je({readAsync:(o,s)=>In(n,o,s),byteLength:n.byteLength}))}return this._validate(e,t),Promise.resolve({json:this._parseJson(t)})}createPlugin(e){return new Q(e[ze.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise((e,t)=>{this.onCompleteObservable.addOnce(()=>{e()}),this.onErrorObservable.addOnce(n=>{t(n)})})}_setState(e){this._state!==e&&(this._state=e,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(le[this._state]))}_loadFile(e,t,n,o,s,a){const i=e._loadFile(t,n,l=>{this._onProgress(l,i)},!0,o,s,a);return i.onCompleteObservable.add(()=>{i._lengthComputable=!0,i._total=i._loaded}),this._requests.push(i),i}_onProgress(e,t){if(!this._progressCallback)return;t._lengthComputable=e.lengthComputable,t._loaded=e.loaded,t._total=e.total;let n=!0,o=0,s=0;for(const a of this._requests){if(a._lengthComputable===void 0||a._loaded===void 0||a._total===void 0)return;n=n&&a._lengthComputable,o+=a._loaded,s+=a._total}this._progressCallback({lengthComputable:n,loaded:o,total:n?s:0})}_validate(e,t,n="",o=""){this.validate&&(this._startPerformanceCounter("Validate JSON"),Xn.ValidateAsync(t,n,o,s=>this.preprocessUrlAsync(n+s).then(a=>e._loadFileAsync(a,void 0,!0,!0).then(i=>new Uint8Array(i,0,i.byteLength)))).then(s=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(s),this.onValidatedObservable.clear()},s=>{this._endPerformanceCounter("Validate JSON"),M.Warn(`Failed to validate: ${s.message}`),this.onValidatedObservable.clear()}))}_getLoader(e){const t=e.json.asset||{};this._log(`Asset version: ${t.version}`),t.minVersion&&this._log(`Asset minimum version: ${t.minVersion}`),t.generator&&this._log(`Asset generator: ${t.generator}`);const n=Q._parseVersion(t.version);if(!n)throw new Error("Invalid version: "+t.version);if(t.minVersion!==void 0){const a=Q._parseVersion(t.minVersion);if(!a)throw new Error("Invalid minimum version: "+t.minVersion);if(Q._compareVersion(a,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+t.minVersion)}const s={1:Q._CreateGLTF1Loader,2:Q._CreateGLTF2Loader}[n.major];if(!s)throw new Error("Unsupported version: "+t.version);return s(this)}_parseJson(e){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${e.length}`);const t=JSON.parse(e);return this._endPerformanceCounter("Parse JSON"),t}_unpackBinaryAsync(e){return this._startPerformanceCounter("Unpack Binary"),e.loadAsync(20).then(()=>{const t={Magic:1179937895},n=e.readUint32();if(n!==t.Magic)throw new _r("Unexpected magic: "+n,pr.GLTFLoaderUnexpectedMagicError);const o=e.readUint32();this.loggingEnabled&&this._log(`Binary version: ${o}`);const s=e.readUint32();!this.useRangeRequests&&s!==e.buffer.byteLength&&C.Warn(`Length in header does not match actual data length: ${s} != ${e.buffer.byteLength}`);let a;switch(o){case 1:{a=this._unpackBinaryV1Async(e,s);break}case 2:{a=this._unpackBinaryV2Async(e,s);break}default:throw new Error("Unsupported version: "+o)}return this._endPerformanceCounter("Unpack Binary"),a})}_unpackBinaryV1Async(e,t){const n={JSON:0},o=e.readUint32(),s=e.readUint32();if(s!==n.JSON)throw new Error(`Unexpected content format: ${s}`);const a=t-e.byteOffset,i={json:this._parseJson(e.readString(o)),bin:null};if(a!==0){const l=e.byteOffset;i.bin={readAsync:(c,u)=>e.buffer.readAsync(l+c,u),byteLength:a}}return Promise.resolve(i)}_unpackBinaryV2Async(e,t){const n={JSON:1313821514,BIN:5130562},o=e.readUint32();if(e.readUint32()!==n.JSON)throw new Error("First chunk format is not JSON");return e.byteOffset+o===t?e.loadAsync(o).then(()=>({json:this._parseJson(e.readString(o)),bin:null})):e.loadAsync(o+8).then(()=>{const a={json:this._parseJson(e.readString(o)),bin:null},i=()=>{const l=e.readUint32();switch(e.readUint32()){case n.JSON:throw new Error("Unexpected JSON chunk");case n.BIN:{const u=e.byteOffset;a.bin={readAsync:(h,d)=>e.buffer.readAsync(u+h,d),byteLength:l},e.skipBytes(l);break}default:{e.skipBytes(l);break}}return e.byteOffset!==t?e.loadAsync(8).then(i):Promise.resolve(a)};return i()})}static _parseVersion(e){if(e==="1.0"||e==="1.0.1")return{major:1,minor:0};const t=(e+"").match(/^(\d+)\.(\d+)/);return t?{major:parseInt(t[1]),minor:parseInt(t[2])}:null}static _compareVersion(e,t){return e.major>t.major?1:e.major<t.major?-1:e.minor>t.minor?1:e.minor<t.minor?-1:0}_logOpen(e){this._log(e),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(e){const t=Q._logSpaces.substring(0,this._logIndentLevel*2);C.Log(`${t}${e}`)}_logDisabled(e){}_startPerformanceCounterEnabled(e){M.StartPerformanceCounter(e)}_startPerformanceCounterDisabled(e){}_endPerformanceCounterEnabled(e){M.EndPerformanceCounter(e)}_endPerformanceCounterDisabled(e){}}Q.IncrementalLoading=!0;Q.HomogeneousCoordinates=!1;Q._logSpaces="                                ";hr(new Q);var ve;(function(r){r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.FLOAT=5126]="FLOAT"})(ve||(ve={}));var Ht;(function(r){r[r.FRAGMENT=35632]="FRAGMENT",r[r.VERTEX=35633]="VERTEX"})(Ht||(Ht={}));var ie;(function(r){r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.INT=5124]="INT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.FLOAT=5126]="FLOAT",r[r.FLOAT_VEC2=35664]="FLOAT_VEC2",r[r.FLOAT_VEC3=35665]="FLOAT_VEC3",r[r.FLOAT_VEC4=35666]="FLOAT_VEC4",r[r.INT_VEC2=35667]="INT_VEC2",r[r.INT_VEC3=35668]="INT_VEC3",r[r.INT_VEC4=35669]="INT_VEC4",r[r.BOOL=35670]="BOOL",r[r.BOOL_VEC2=35671]="BOOL_VEC2",r[r.BOOL_VEC3=35672]="BOOL_VEC3",r[r.BOOL_VEC4=35673]="BOOL_VEC4",r[r.FLOAT_MAT2=35674]="FLOAT_MAT2",r[r.FLOAT_MAT3=35675]="FLOAT_MAT3",r[r.FLOAT_MAT4=35676]="FLOAT_MAT4",r[r.SAMPLER_2D=35678]="SAMPLER_2D"})(ie||(ie={}));var Ke;(function(r){r[r.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r[r.REPEAT=10497]="REPEAT"})(Ke||(Ke={}));var fe;(function(r){r[r.NEAREST=9728]="NEAREST",r[r.LINEAR=9728]="LINEAR",r[r.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",r[r.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(fe||(fe={}));var Fn;(function(r){r[r.ALPHA=6406]="ALPHA",r[r.RGB=6407]="RGB",r[r.RGBA=6408]="RGBA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA"})(Fn||(Fn={}));var Kt;(function(r){r[r.FRONT=1028]="FRONT",r[r.BACK=1029]="BACK",r[r.FRONT_AND_BACK=1032]="FRONT_AND_BACK"})(Kt||(Kt={}));var U;(function(r){r[r.ZERO=0]="ZERO",r[r.ONE=1]="ONE",r[r.SRC_COLOR=768]="SRC_COLOR",r[r.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",r[r.DST_COLOR=774]="DST_COLOR",r[r.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.DST_ALPHA=772]="DST_ALPHA",r[r.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",r[r.CONSTANT_COLOR=32769]="CONSTANT_COLOR",r[r.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",r[r.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",r[r.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",r[r.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"})(U||(U={}));class Y{static SetMatrix(e,t,n,o,s){let a=null;if(n.semantic==="MODEL"?a=t.getWorldMatrix():n.semantic==="PROJECTION"?a=e.getProjectionMatrix():n.semantic==="VIEW"?a=e.getViewMatrix():n.semantic==="MODELVIEWINVERSETRANSPOSE"?a=ee.Transpose(t.getWorldMatrix().multiply(e.getViewMatrix()).invert()):n.semantic==="MODELVIEW"?a=t.getWorldMatrix().multiply(e.getViewMatrix()):n.semantic==="MODELVIEWPROJECTION"?a=t.getWorldMatrix().multiply(e.getTransformMatrix()):n.semantic==="MODELINVERSE"?a=t.getWorldMatrix().invert():n.semantic==="VIEWINVERSE"?a=e.getViewMatrix().invert():n.semantic==="PROJECTIONINVERSE"?a=e.getProjectionMatrix().invert():n.semantic==="MODELVIEWINVERSE"?a=t.getWorldMatrix().multiply(e.getViewMatrix()).invert():n.semantic==="MODELVIEWPROJECTIONINVERSE"?a=t.getWorldMatrix().multiply(e.getTransformMatrix()).invert():n.semantic==="MODELINVERSETRANSPOSE"&&(a=ee.Transpose(t.getWorldMatrix().invert())),a)switch(n.type){case ie.FLOAT_MAT2:s.setMatrix2x2(o,ee.GetAsMatrix2x2(a));break;case ie.FLOAT_MAT3:s.setMatrix3x3(o,ee.GetAsMatrix3x3(a));break;case ie.FLOAT_MAT4:s.setMatrix(o,a);break}}static SetUniform(e,t,n,o){switch(o){case ie.FLOAT:return e.setFloat(t,n),!0;case ie.FLOAT_VEC2:return e.setVector2(t,qe.FromArray(n)),!0;case ie.FLOAT_VEC3:return e.setVector3(t,G.FromArray(n)),!0;case ie.FLOAT_VEC4:return e.setVector4(t,fr.FromArray(n)),!0;default:return!1}}static GetWrapMode(e){switch(e){case Ke.CLAMP_TO_EDGE:return $.CLAMP_ADDRESSMODE;case Ke.MIRRORED_REPEAT:return $.MIRROR_ADDRESSMODE;case Ke.REPEAT:return $.WRAP_ADDRESSMODE;default:return $.WRAP_ADDRESSMODE}}static GetByteStrideFromType(e){switch(e.type){case"VEC2":return 2;case"VEC3":return 3;case"VEC4":return 4;case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:return 1}}static GetTextureFilterMode(e){switch(e){case fe.LINEAR:case fe.LINEAR_MIPMAP_NEAREST:case fe.LINEAR_MIPMAP_LINEAR:return $.TRILINEAR_SAMPLINGMODE;case fe.NEAREST:case fe.NEAREST_MIPMAP_NEAREST:return $.NEAREST_SAMPLINGMODE;default:return $.BILINEAR_SAMPLINGMODE}}static GetBufferFromBufferView(e,t,n,o,s){n=t.byteOffset+n;const a=e.loadedBufferViews[t.buffer];if(n+o>a.byteLength)throw new Error("Buffer access is out of range");const i=a.buffer;switch(n+=a.byteOffset,s){case ve.BYTE:return new Int8Array(i,n,o);case ve.UNSIGNED_BYTE:return new Uint8Array(i,n,o);case ve.SHORT:return new Int16Array(i,n,o);case ve.UNSIGNED_SHORT:return new Uint16Array(i,n,o);default:return new Float32Array(i,n,o)}}static GetBufferFromAccessor(e,t){const n=e.bufferViews[t.bufferView],o=t.count*Y.GetByteStrideFromType(t);return Y.GetBufferFromBufferView(e,n,t.byteOffset,o,t.componentType)}static DecodeBufferToText(e){let t="";const n=e.byteLength;for(let o=0;o<n;++o)t+=String.fromCharCode(e[o]);return t}static GetDefaultMaterial(e){if(!Y._DefaultMaterial){Oe.ShadersStore.GLTFDefaultMaterialVertexShader=["precision highp float;","","uniform mat4 worldView;","uniform mat4 projection;","","attribute vec3 position;","","void main(void)","{","    gl_Position = projection * worldView * vec4(position, 1.0);","}"].join(`
`),Oe.ShadersStore.GLTFDefaultMaterialPixelShader=["precision highp float;","","uniform vec4 u_emission;","","void main(void)","{","    gl_FragColor = u_emission;","}"].join(`
`);const t={vertex:"GLTFDefaultMaterial",fragment:"GLTFDefaultMaterial"},n={attributes:["position"],uniforms:["worldView","projection","u_emission"],samplers:new Array,needAlphaBlending:!1};Y._DefaultMaterial=new $n("GLTFDefaultMaterial",e,t,n),Y._DefaultMaterial.setColor4("u_emission",new Hn(.5,.5,.5,1))}return Y._DefaultMaterial}}Y._DefaultMaterial=null;var ke;(function(r){r[r.IDENTIFIER=1]="IDENTIFIER",r[r.UNKNOWN=2]="UNKNOWN",r[r.END_OF_INPUT=3]="END_OF_INPUT"})(ke||(ke={}));class On{constructor(e){this._pos=0,this.currentToken=ke.UNKNOWN,this.currentIdentifier="",this.currentString="",this.isLetterOrDigitPattern=/^[a-zA-Z0-9]+$/,this._toParse=e,this._maxPos=e.length}getNextToken(){if(this.isEnd())return ke.END_OF_INPUT;if(this.currentString=this.read(),this.currentToken=ke.UNKNOWN,this.currentString==="_"||this.isLetterOrDigitPattern.test(this.currentString))for(this.currentToken=ke.IDENTIFIER,this.currentIdentifier=this.currentString;!this.isEnd()&&(this.isLetterOrDigitPattern.test(this.currentString=this.peek())||this.currentString==="_");)this.currentIdentifier+=this.currentString,this.forward();return this.currentToken}peek(){return this._toParse[this._pos]}read(){return this._toParse[this._pos++]}forward(){this._pos++}isEnd(){return this._pos>=this._maxPos}}const Jn=["MODEL","VIEW","PROJECTION","MODELVIEW","MODELVIEWPROJECTION","JOINTMATRIX"],Zn=["world","view","projection","worldView","worldViewProjection","mBones"],Wr=["translation","rotation","scale"],Yr=["position","rotationQuaternion","scaling"],Xr=(r,e)=>{for(const t in r){const n=r[t];e.buffers[t]=n,e.buffersCount++}},Jr=(r,e)=>{for(const t in r){const n=r[t];e.shaders[t]=n,e.shaderscount++}},re=(r,e,t)=>{for(const n in r){const o=r[n];t[e][n]=o}},Zr=r=>{if(r)for(let e=0;e<r.length/2;e++)r[e*2+1]=1-r[e*2+1]},Cn=r=>{if(r.semantic==="NORMAL")return"normal";if(r.semantic==="POSITION")return"position";if(r.semantic==="JOINT")return"matricesIndices";if(r.semantic==="WEIGHT")return"matricesWeights";if(r.semantic==="COLOR")return"color";if(r.semantic&&r.semantic.indexOf("TEXCOORD_")!==-1){const e=Number(r.semantic.split("_")[1]);return"uv"+(e===0?"":e+1)}return null},Qr=r=>{for(const e in r.animations){const t=r.animations[e];if(!t.channels||!t.samplers)continue;let n=null;for(let o=0;o<t.channels.length;o++){const s=t.channels[o],a=t.samplers[s.sampler];if(!a)continue;let i=null,l=null;t.parameters?(i=t.parameters[a.input],l=t.parameters[a.output]):(i=a.input,l=a.output);const c=Y.GetBufferFromAccessor(r,r.accessors[i]),u=Y.GetBufferFromAccessor(r,r.accessors[l]),h=s.target.id;let d=r.scene.getNodeById(h);if(d===null&&(d=r.scene.getNodeByName(h)),d===null){M.Warn("Creating animation named "+e+". But cannot find node named "+h+" to attach to");continue}const p=d instanceof Ze;let m=s.target.path;const b=Wr.indexOf(m);b!==-1&&(m=Yr[b]);let A=x.ANIMATIONTYPE_MATRIX;p||(m==="rotationQuaternion"?(A=x.ANIMATIONTYPE_QUATERNION,d.rotationQuaternion=new j):A=x.ANIMATIONTYPE_VECTOR3);let E=null;const I=[];let P=0,O=!1;p&&n&&n.getKeys().length===c.length&&(E=n,O=!0),O||(r.scene._blockEntityCollection=!!r.assetContainer,E=new x(e,p?"_matrix":m,1,A,x.ANIMATIONLOOPMODE_CYCLE),r.scene._blockEntityCollection=!1);for(let k=0;k<c.length;k++){let B=null;if(m==="rotationQuaternion"?(B=j.FromArray([u[P],u[P+1],u[P+2],u[P+3]]),P+=4):(B=G.FromArray([u[P],u[P+1],u[P+2]]),P+=3),p){const v=d;let F=G.Zero(),H=new j,K=G.Zero(),q=v.getBaseMatrix();O&&n&&(q=n.getKeys()[k].value),q.decompose(K,H,F),m==="position"?F=B:m==="rotationQuaternion"?H=B:K=B,B=ee.Compose(K,H,F)}O?n&&(n.getKeys()[k].value=B):I.push({frame:c[k],value:B})}!O&&E&&(E.setKeys(I),d.animations.push(E)),n=E,r.scene.stopAnimation(d),r.scene.beginAnimation(d,0,c[c.length-1],!0,1)}}},zt=r=>{let e=null;if(r.translation||r.rotation||r.scale){const t=G.FromArray(r.scale||[1,1,1]),n=j.FromArray(r.rotation||[0,0,0,1]),o=G.FromArray(r.translation||[0,0,0]);e=ee.Compose(t,n,o)}else e=ee.FromArray(r.matrix);return e},Qn=(r,e,t,n)=>{for(let s=0;s<n.bones.length;s++)if(n.bones[s].name===t)return n.bones[s];const o=r.nodes;for(const s in o){const a=o[s];if(!a.jointName)continue;const i=a.children;for(let l=0;l<i.length;l++){const c=r.nodes[i[l]];if(c.jointName&&c.jointName===t){const u=zt(a),h=new Ze(a.name||"",n,Qn(r,e,a.jointName,n),u);return h.id=s,h}}}return null},jr=(r,e)=>{for(let t=0;t<r.length;t++){const n=r[t];for(let o=0;o<n.node.children.length;o++)if(n.node.children[o]===e)return n.bone}return null},Mt=(r,e)=>{const t=r.nodes;let n=t[e];if(n)return{node:n,id:e};for(const o in t)if(n=t[o],n.jointName===e)return{node:n,id:o};return null},zr=(r,e)=>{for(let t=0;t<r.jointNames.length;t++)if(r.jointNames[t]===e)return!0;return!1},eo=(r,e,t,n)=>{for(const o in r.nodes){const s=r.nodes[o],a=o;if(!s.jointName||zr(t,s.jointName))continue;const i=zt(s),l=new Ze(s.name||"",e,null,i);l.id=a,n.push({bone:l,node:s,id:a})}for(let o=0;o<n.length;o++){const s=n[o],a=s.node.children;for(let i=0;i<a.length;i++){let l=null;for(let c=0;c<n.length;c++)if(n[c].id===a[i]){l=n[c];break}l&&(l.bone._parent=s.bone,s.bone.children.push(l.bone))}}},to=(r,e,t,n)=>{if(n||(n=new Yt(e.name||"","",r.scene)),!e.babylonSkeleton)return n;const o=[],s=[];eo(r,n,e,o),n.bones=[];for(let i=0;i<e.jointNames.length;i++){const l=Mt(r,e.jointNames[i]);if(!l)continue;const c=l.node;if(!c){M.Warn("Joint named "+e.jointNames[i]+" does not exist");continue}const u=l.id,h=r.scene.getBoneById(u);if(h){n.bones.push(h);continue}let d=!1,p=null;for(let A=0;A<i;A++){const E=Mt(r,e.jointNames[A]);if(!E)continue;const I=E.node;if(!I){M.Warn("Joint named "+e.jointNames[A]+" does not exist when looking for parent");continue}const P=I.children;if(P){d=!1;for(let O=0;O<P.length;O++)if(P[O]===u){p=Qn(r,e,e.jointNames[A],n),d=!0;break}if(d)break}}const m=zt(c);!p&&o.length>0&&(p=jr(o,u),p&&s.indexOf(p)===-1&&s.push(p));const b=new Ze(c.jointName||"",n,p,m);b.id=u}const a=n.bones;n.bones=[];for(let i=0;i<e.jointNames.length;i++){const l=Mt(r,e.jointNames[i]);if(l){for(let c=0;c<a.length;c++)if(a[c].id===l.id){n.bones.push(a[c]);break}}}n.prepare();for(let i=0;i<s.length;i++)n.bones.push(s[i]);return n},Gn=(r,e,t,n,o)=>{if(o||(r.scene._blockEntityCollection=!!r.assetContainer,o=new Ne(e.name||"",r.scene),o._parentContainer=r.assetContainer,r.scene._blockEntityCollection=!1,o.id=n),!e.babylonNode)return o;const s=[];let a=null;const i=[],l=[],c=[],u=[];for(let p=0;p<t.length;p++){const m=t[p],b=r.meshes[m];if(b)for(let A=0;A<b.primitives.length;A++){const E=new mr,I=b.primitives[A];I.mode;const P=I.attributes;let O=null,k=null;for(const v in P)if(O=r.accessors[P[v]],k=Y.GetBufferFromAccessor(r,O),v==="NORMAL")E.normals=new Float32Array(k.length),E.normals.set(k);else if(v==="POSITION"){if(Q.HomogeneousCoordinates){E.positions=new Float32Array(k.length-k.length/4);for(let F=0;F<k.length;F+=4)E.positions[F]=k[F],E.positions[F+1]=k[F+1],E.positions[F+2]=k[F+2]}else E.positions=new Float32Array(k.length),E.positions.set(k);l.push(E.positions.length)}else if(v.indexOf("TEXCOORD_")!==-1){const F=Number(v.split("_")[1]),H=N.UVKind+(F===0?"":F+1),K=new Float32Array(k.length);K.set(k),Zr(K),E.set(K,H)}else v==="JOINT"?(E.matricesIndices=new Float32Array(k.length),E.matricesIndices.set(k)):v==="WEIGHT"?(E.matricesWeights=new Float32Array(k.length),E.matricesWeights.set(k)):v==="COLOR"&&(E.colors=new Float32Array(k.length),E.colors.set(k));if(O=r.accessors[I.indices],O)k=Y.GetBufferFromAccessor(r,O),E.indices=new Int32Array(k.length),E.indices.set(k),u.push(E.indices.length);else{const v=[];for(let F=0;F<E.positions.length/3;F++)v.push(F);E.indices=new Int32Array(v),u.push(E.indices.length)}a?a.merge(E):a=E;const B=r.scene.getMaterialById(I.material);s.push(B===null?Y.GetDefaultMaterial(r.scene):B),i.push(i.length===0?0:i[i.length-1]+l[l.length-2]),c.push(c.length===0?0:c[c.length-1]+u[u.length-2])}}let h;r.scene._blockEntityCollection=!!r.assetContainer,s.length>1?(h=new yr("multimat"+n,r.scene),h.subMaterials=s):h=new Xt("multimat"+n,r.scene),s.length===1&&(h=s[0]),h._parentContainer=r.assetContainer,o.material||(o.material=h),new Wn(n,r.scene,a,!1,o),o.computeWorldMatrix(!0),r.scene._blockEntityCollection=!1,o.subMeshes=[];let d=0;for(let p=0;p<t.length;p++){const m=t[p],b=r.meshes[m];if(b)for(let A=0;A<b.primitives.length;A++)b.primitives[A].mode,gr.AddToMesh(d,i[d],l[d],c[d],u[d],o,o,!0),d++}return o},Ut=(r,e,t,n)=>{r.position&&(r.position=e),(r.rotationQuaternion||r.rotation)&&(r.rotationQuaternion=t),r.scaling&&(r.scaling=n)},no=(r,e)=>{if(e.matrix){const t=new G(0,0,0),n=new j,o=new G(0,0,0);ee.FromArray(e.matrix).decompose(o,n,t),Ut(r,t,n,o)}else e.translation&&e.rotation&&e.scale&&Ut(r,G.FromArray(e.translation),j.FromArray(e.rotation),G.FromArray(e.scale));r.computeWorldMatrix(!0)},ro=(r,e,t)=>{let n=null;if(r.importOnlyMeshes&&(e.skin||e.meshes)&&r.importMeshesNames&&r.importMeshesNames.length>0&&r.importMeshesNames.indexOf(e.name||"")===-1)return null;if(e.skin){if(e.meshes){const o=r.skins[e.skin],s=Gn(r,e,e.meshes,t,e.babylonNode);s.skeleton=r.scene.getLastSkeletonById(e.skin),s.skeleton===null&&(s.skeleton=to(r,o,s,o.babylonSkeleton),o.babylonSkeleton||(o.babylonSkeleton=s.skeleton)),n=s}}else if(e.meshes)n=Gn(r,e,e.mesh?[e.mesh]:e.meshes,t,e.babylonNode);else if(e.light&&!e.babylonNode&&!r.importOnlyMeshes){const o=r.lights[e.light];if(o){if(o.type==="ambient"){const s=o[o.type],a=new Un(e.light,G.Zero(),r.scene);a.name=e.name||"",s.color&&(a.diffuse=V.FromArray(s.color)),n=a}else if(o.type==="directional"){const s=o[o.type],a=new Jt(e.light,G.Zero(),r.scene);a.name=e.name||"",s.color&&(a.diffuse=V.FromArray(s.color)),n=a}else if(o.type==="point"){const s=o[o.type],a=new Zt(e.light,G.Zero(),r.scene);a.name=e.name||"",s.color&&(a.diffuse=V.FromArray(s.color)),n=a}else if(o.type==="spot"){const s=o[o.type],a=new ye(e.light,G.Zero(),G.Zero(),0,0,r.scene);a.name=e.name||"",s.color&&(a.diffuse=V.FromArray(s.color)),s.fallOfAngle&&(a.angle=s.fallOfAngle),s.fallOffExponent&&(a.exponent=s.fallOffExponent),n=a}}}else if(e.camera&&!e.babylonNode&&!r.importOnlyMeshes){const o=r.cameras[e.camera];if(o){if(r.scene._blockEntityCollection=!!r.assetContainer,o.type==="orthographic"){const s=new Vt(e.camera,G.Zero(),r.scene,!1);s.name=e.name||"",s.mode=qn.ORTHOGRAPHIC_CAMERA,s.attachControl(),n=s,s._parentContainer=r.assetContainer}else if(o.type==="perspective"){const s=o[o.type],a=new Vt(e.camera,G.Zero(),r.scene,!1);a.name=e.name||"",a.attachControl(),s.aspectRatio||(s.aspectRatio=r.scene.getEngine().getRenderWidth()/r.scene.getEngine().getRenderHeight()),s.znear&&s.zfar&&(a.maxZ=s.zfar,a.minZ=s.znear),n=a,a._parentContainer=r.assetContainer}r.scene._blockEntityCollection=!1}}if(!e.jointName){if(e.babylonNode)return e.babylonNode;if(n===null){r.scene._blockEntityCollection=!!r.assetContainer;const o=new Ne(e.name||"",r.scene);o._parentContainer=r.assetContainer,r.scene._blockEntityCollection=!1,e.babylonNode=o,n=o}}if(n!==null){if(e.matrix&&n instanceof Ne)no(n,e);else{const o=e.translation||[0,0,0],s=e.rotation||[0,0,0,1],a=e.scale||[1,1,1];Ut(n,G.FromArray(o),j.FromArray(s),G.FromArray(a))}n.updateCache(!0),e.babylonNode=n}return n},Ye=(r,e,t,n=!1)=>{const o=r.nodes[e];let s=null;if(r.importOnlyMeshes&&!n&&r.importMeshesNames?r.importMeshesNames.indexOf(o.name||"")!==-1||r.importMeshesNames.length===0?n=!0:n=!1:n=!0,!o.jointName&&n&&(s=ro(r,o,e),s!==null&&(s.id=e,s.parent=t)),o.children)for(let a=0;a<o.children.length;a++)Ye(r,o.children[a],s,n)},Pn=r=>{let e=r.currentScene;if(e)for(let t=0;t<e.nodes.length;t++)Ye(r,e.nodes[t],null);else for(const t in r.scenes){e=r.scenes[t];for(let n=0;n<e.nodes.length;n++)Ye(r,e.nodes[n],null)}Qr(r);for(let t=0;t<r.scene.skeletons.length;t++){const n=r.scene.skeletons[t];r.scene.beginAnimation(n,0,Number.MAX_VALUE,!0,1)}},oo=(r,e,t,n,o,s,a)=>{const i=s.values||o.parameters;for(const l in t){const c=t[l],u=c.type;if(u===ie.FLOAT_MAT2||u===ie.FLOAT_MAT3||u===ie.FLOAT_MAT4){if(c.semantic&&!c.source&&!c.node)Y.SetMatrix(e.scene,r,c,l,n.getEffect());else if(c.semantic&&(c.source||c.node)){let h=e.scene.getNodeByName(c.source||c.node||"");if(h===null&&(h=e.scene.getNodeById(c.source||c.node||"")),h===null)continue;Y.SetMatrix(e.scene,h,c,l,n.getEffect())}}else{const h=i[o.uniforms[l]];if(!h)continue;if(u===ie.SAMPLER_2D){const d=e.textures[s.values?h:c.value].babylonTexture;if(d==null)continue;n.getEffect().setTexture(l,d)}else Y.SetUniform(n.getEffect(),l,h,u)}}a(n)},so=(r,e,t,n,o)=>{const s=n.values||t.parameters,a=t.uniforms;for(const i in o){const l=o[i],c=l.type;let u=s[a[i]];if(u===void 0&&(u=l.value),!u)continue;const h=d=>p=>{l.value&&d&&(e.setTexture(d,p),delete o[d])};c===ie.SAMPLER_2D?Z.LoadTextureAsync(r,n.values?u:l.value,h(i),()=>h(null)):l.value&&Y.SetUniform(e,i,n.values?u:l.value,c)&&delete o[i]}},ao=(r,e,t)=>(n,o)=>{e.dispose(!0),t("Cannot compile program named "+r.name+". Error: "+o+". Default material will be applied")},io=(r,e,t,n,o,s)=>a=>{so(r,e,t,n,o),e.onBind=i=>{oo(i,r,o,e,t,n,s)}},Nn=(r,e,t)=>{for(const n in e.uniforms){const o=e.uniforms[n],s=e.parameters[o];if(r.currentIdentifier===n&&s.semantic&&!s.source&&!s.node){const a=Jn.indexOf(s.semantic);if(a!==-1)return delete t[n],Zn[a]}}return r.currentIdentifier},Ln=r=>{for(const e in r.materials)Z.LoadMaterialAsync(r,e,()=>{},()=>{})};class ge{static CreateRuntime(e,t,n){const o={extensions:{},accessors:{},buffers:{},bufferViews:{},meshes:{},lights:{},cameras:{},nodes:{},images:{},textures:{},shaders:{},programs:{},samplers:{},techniques:{},materials:{},animations:{},skins:{},extensionsUsed:[],scenes:{},buffersCount:0,shaderscount:0,scene:t,rootUrl:n,loadedBufferCount:0,loadedBufferViews:{},loadedShaderCount:0,importOnlyMeshes:!1,dummyNodes:[],assetContainer:null};return e.extensions&&re(e.extensions,"extensions",o),e.extensionsUsed&&re(e.extensionsUsed,"extensionsUsed",o),e.buffers&&Xr(e.buffers,o),e.bufferViews&&re(e.bufferViews,"bufferViews",o),e.accessors&&re(e.accessors,"accessors",o),e.meshes&&re(e.meshes,"meshes",o),e.lights&&re(e.lights,"lights",o),e.cameras&&re(e.cameras,"cameras",o),e.nodes&&re(e.nodes,"nodes",o),e.images&&re(e.images,"images",o),e.textures&&re(e.textures,"textures",o),e.shaders&&Jr(e.shaders,o),e.programs&&re(e.programs,"programs",o),e.samplers&&re(e.samplers,"samplers",o),e.techniques&&re(e.techniques,"techniques",o),e.materials&&re(e.materials,"materials",o),e.animations&&re(e.animations,"animations",o),e.skins&&re(e.skins,"skins",o),e.scenes&&(o.scenes=e.scenes),e.scene&&e.scenes&&(o.currentScene=e.scenes[e.scene]),o}static LoadBufferAsync(e,t,n,o,s){const a=e.buffers[t];M.IsBase64(a.uri)?setTimeout(()=>n(new Uint8Array(M.DecodeBase64(a.uri)))):M.LoadFile(e.rootUrl+a.uri,i=>n(new Uint8Array(i)),s,void 0,!0,i=>{i&&o(i.status+" "+i.statusText)})}static LoadTextureBufferAsync(e,t,n,o){const s=e.textures[t];if(!s||!s.source){o("");return}if(s.babylonTexture){n(null);return}const a=e.images[s.source];M.IsBase64(a.uri)?setTimeout(()=>n(new Uint8Array(M.DecodeBase64(a.uri)))):M.LoadFile(e.rootUrl+a.uri,i=>n(new Uint8Array(i)),void 0,void 0,!0,i=>{i&&o(i.status+" "+i.statusText)})}static CreateTextureAsync(e,t,n,o){const s=e.textures[t];if(s.babylonTexture){o(s.babylonTexture);return}const a=e.samplers[s.sampler],i=a.minFilter===fe.NEAREST_MIPMAP_NEAREST||a.minFilter===fe.NEAREST_MIPMAP_LINEAR||a.minFilter===fe.LINEAR_MIPMAP_NEAREST||a.minFilter===fe.LINEAR_MIPMAP_LINEAR,l=$.BILINEAR_SAMPLINGMODE,c=n==null?new Blob:new Blob([n]),u=URL.createObjectURL(c),h=()=>URL.revokeObjectURL(u),d=new $(u,e.scene,!i,!0,l,h,h);a.wrapS!==void 0&&(d.wrapU=Y.GetWrapMode(a.wrapS)),a.wrapT!==void 0&&(d.wrapV=Y.GetWrapMode(a.wrapT)),d.name=t,s.babylonTexture=d,o(d)}static LoadShaderStringAsync(e,t,n,o){const s=e.shaders[t];if(M.IsBase64(s.uri)){const a=atob(s.uri.split(",")[1]);n&&n(a)}else M.LoadFile(e.rootUrl+s.uri,n,void 0,void 0,!1,a=>{a&&o&&o(a.status+" "+a.statusText)})}static LoadMaterialAsync(e,t,n,o){const s=e.materials[t];if(!s.technique){o&&o("No technique found.");return}const a=e.techniques[s.technique];if(!a){e.scene._blockEntityCollection=!!e.assetContainer;const B=new Xt(t,e.scene);B._parentContainer=e.assetContainer,e.scene._blockEntityCollection=!1,B.diffuseColor=new V(.5,.5,.5),B.sideOrientation=_e.CounterClockWiseSideOrientation,n(B);return}const i=e.programs[a.program],l=a.states,c=Oe.ShadersStore[i.vertexShader+"VertexShader"],u=Oe.ShadersStore[i.fragmentShader+"PixelShader"];let h="",d="";const p=new On(c),m=new On(u),b={},A=[],E=[],I=[];for(const B in a.uniforms){const v=a.uniforms[B],F=a.parameters[v];if(b[B]=F,F.semantic&&!F.node&&!F.source){const H=Jn.indexOf(F.semantic);H!==-1?(A.push(Zn[H]),delete b[B]):A.push(B)}else F.type===ie.SAMPLER_2D?I.push(B):A.push(B)}for(const B in a.attributes){const v=a.attributes[B],F=a.parameters[v];if(F.semantic){const H=Cn(F);H&&E.push(H)}}for(;!p.isEnd()&&p.getNextToken();){if(p.currentToken!==ke.IDENTIFIER){h+=p.currentString;continue}let v=!1;for(const F in a.attributes){const H=a.attributes[F],K=a.parameters[H];if(p.currentIdentifier===F&&K.semantic){h+=Cn(K),v=!0;break}}v||(h+=Nn(p,a,b))}for(;!m.isEnd()&&m.getNextToken();){if(m.currentToken!==ke.IDENTIFIER){d+=m.currentString;continue}d+=Nn(m,a,b)}const P={vertex:i.vertexShader+t,fragment:i.fragmentShader+t},O={attributes:E,uniforms:A,samplers:I,needAlphaBlending:l&&l.enable&&l.enable.indexOf(3042)!==-1};Oe.ShadersStore[i.vertexShader+t+"VertexShader"]=h,Oe.ShadersStore[i.fragmentShader+t+"PixelShader"]=d;const k=new $n(t,e.scene,P,O);if(k.onError=ao(i,k,o),k.onCompiled=io(e,k,a,s,b,n),k.sideOrientation=_e.CounterClockWiseSideOrientation,l&&l.functions){const B=l.functions;B.cullFace&&B.cullFace[0]!==Kt.BACK&&(k.backFaceCulling=!1);const v=B.blendFuncSeparate;v&&(v[0]===U.SRC_ALPHA&&v[1]===U.ONE_MINUS_SRC_ALPHA&&v[2]===U.ONE&&v[3]===U.ONE?k.alphaMode=Te.ALPHA_COMBINE:v[0]===U.ONE&&v[1]===U.ONE&&v[2]===U.ZERO&&v[3]===U.ONE?k.alphaMode=Te.ALPHA_ONEONE:v[0]===U.SRC_ALPHA&&v[1]===U.ONE&&v[2]===U.ZERO&&v[3]===U.ONE?k.alphaMode=Te.ALPHA_ADD:v[0]===U.ZERO&&v[1]===U.ONE_MINUS_SRC_COLOR&&v[2]===U.ONE&&v[3]===U.ONE?k.alphaMode=Te.ALPHA_SUBTRACT:v[0]===U.DST_COLOR&&v[1]===U.ZERO&&v[2]===U.ONE&&v[3]===U.ONE?k.alphaMode=Te.ALPHA_MULTIPLY:v[0]===U.SRC_ALPHA&&v[1]===U.ONE_MINUS_SRC_COLOR&&v[2]===U.ONE&&v[3]===U.ONE&&(k.alphaMode=Te.ALPHA_MAXIMIZED))}}}let Le=class qt{static RegisterExtension(e){if(qt.Extensions[e.name]){M.Error('Tool with the same name "'+e.name+'" already exists');return}qt.Extensions[e.name]=e}dispose(){}_importMeshAsync(e,t,n,o,s,a,i,l){return t.useRightHandedSystem=!0,Z.LoadRuntimeAsync(t,n,o,c=>{c.assetContainer=s,c.importOnlyMeshes=!0,e===""?c.importMeshesNames=[]:typeof e=="string"?c.importMeshesNames=[e]:e&&!(e instanceof Array)?c.importMeshesNames=[e]:(c.importMeshesNames=[],M.Warn("Argument meshesNames must be of type string or string[]")),this._createNodes(c);const u=[],h=[];for(const d in c.nodes){const p=c.nodes[d];p.babylonNode instanceof Kn&&u.push(p.babylonNode)}for(const d in c.skins){const p=c.skins[d];p.babylonSkeleton instanceof Yt&&h.push(p.babylonSkeleton)}this._loadBuffersAsync(c,()=>{this._loadShadersAsync(c,()=>{Ln(c),Pn(c),!Q.IncrementalLoading&&a&&a(u,h)})}),Q.IncrementalLoading&&a&&a(u,h)},l),!0}importMeshAsync(e,t,n,o,s,a){return new Promise((i,l)=>{this._importMeshAsync(e,t,o,s,n,(c,u)=>{i({meshes:c,particleSystems:[],skeletons:u,animationGroups:[],lights:[],transformNodes:[],geometries:[],spriteManagers:[]})},a,c=>{l(new Error(c))})})}_loadAsync(e,t,n,o,s,a){e.useRightHandedSystem=!0,Z.LoadRuntimeAsync(e,t,n,i=>{Z.LoadRuntimeExtensionsAsync(i,()=>{this._createNodes(i),this._loadBuffersAsync(i,()=>{this._loadShadersAsync(i,()=>{Ln(i),Pn(i),Q.IncrementalLoading||o()})}),Q.IncrementalLoading&&o()},a)},a)}loadAsync(e,t,n,o){return new Promise((s,a)=>{this._loadAsync(e,t,n,()=>{s()},o,i=>{a(new Error(i))})})}_loadShadersAsync(e,t){let n=!1;const o=(s,a)=>{Z.LoadShaderStringAsync(e,s,i=>{i instanceof ArrayBuffer||(e.loadedShaderCount++,i&&(Oe.ShadersStore[s+(a.type===Ht.VERTEX?"VertexShader":"PixelShader")]=i),e.loadedShaderCount===e.shaderscount&&t())},()=>{M.Error("Error when loading shader program named "+s+" located at "+a.uri)})};for(const s in e.shaders){n=!0;const a=e.shaders[s];a?o.bind(this,s,a)():M.Error("No shader named: "+s)}n||t()}_loadBuffersAsync(e,t){let n=!1;const o=(s,a)=>{Z.LoadBufferAsync(e,s,i=>{e.loadedBufferCount++,i&&(i.byteLength!=e.buffers[s].byteLength&&M.Error("Buffer named "+s+" is length "+i.byteLength+". Expected: "+a.byteLength),e.loadedBufferViews[s]=i),e.loadedBufferCount===e.buffersCount&&t()},()=>{M.Error("Error when loading buffer named "+s+" located at "+a.uri)})};for(const s in e.buffers){n=!0;const a=e.buffers[s];a?o.bind(this,s,a)():M.Error("No buffer named: "+s)}n||t()}_createNodes(e){let t=e.currentScene;if(t)for(let n=0;n<t.nodes.length;n++)Ye(e,t.nodes[n],null);else for(const n in e.scenes){t=e.scenes[n];for(let o=0;o<t.nodes.length;o++)Ye(e,t.nodes[o],null)}}};Le.Extensions={};class Z{constructor(e){this._name=e}get name(){return this._name}loadRuntimeAsync(e,t,n,o,s){return!1}loadRuntimeExtensionsAsync(e,t,n){return!1}loadBufferAsync(e,t,n,o,s){return!1}loadTextureBufferAsync(e,t,n,o){return!1}createTextureAsync(e,t,n,o,s){return!1}loadShaderStringAsync(e,t,n,o){return!1}loadMaterialAsync(e,t,n,o){return!1}static LoadRuntimeAsync(e,t,n,o,s){Z._ApplyExtensions(a=>a.loadRuntimeAsync(e,t,n,o,s),()=>{setTimeout(()=>{o&&o(ge.CreateRuntime(t.json,e,n))})})}static LoadRuntimeExtensionsAsync(e,t,n){Z._ApplyExtensions(o=>o.loadRuntimeExtensionsAsync(e,t,n),()=>{setTimeout(()=>{t()})})}static LoadBufferAsync(e,t,n,o,s){Z._ApplyExtensions(a=>a.loadBufferAsync(e,t,n,o,s),()=>{ge.LoadBufferAsync(e,t,n,o,s)})}static LoadTextureAsync(e,t,n,o){Z._LoadTextureBufferAsync(e,t,s=>{s&&Z._CreateTextureAsync(e,t,s,n,o)},o)}static LoadShaderStringAsync(e,t,n,o){Z._ApplyExtensions(s=>s.loadShaderStringAsync(e,t,n,o),()=>{ge.LoadShaderStringAsync(e,t,n,o)})}static LoadMaterialAsync(e,t,n,o){Z._ApplyExtensions(s=>s.loadMaterialAsync(e,t,n,o),()=>{ge.LoadMaterialAsync(e,t,n,o)})}static _LoadTextureBufferAsync(e,t,n,o){Z._ApplyExtensions(s=>s.loadTextureBufferAsync(e,t,n,o),()=>{ge.LoadTextureBufferAsync(e,t,n,o)})}static _CreateTextureAsync(e,t,n,o,s){Z._ApplyExtensions(a=>a.createTextureAsync(e,t,n,o,s),()=>{ge.CreateTextureAsync(e,t,n,o)})}static _ApplyExtensions(e,t){for(const n in Le.Extensions){const o=Le.Extensions[n];if(e(o))return}t()}}Q._CreateGLTF1Loader=()=>new Le;const lo="binary_glTF";class co extends Z{constructor(){super("KHR_binary_glTF")}loadRuntimeAsync(e,t,n,o){const s=t.json.extensionsUsed;return!s||s.indexOf(this.name)===-1||!t.bin?!1:(this._bin=t.bin,o(ge.CreateRuntime(t.json,e,n)),!0)}loadBufferAsync(e,t,n,o){return e.extensionsUsed.indexOf(this.name)===-1||t!==lo?!1:(this._bin.readAsync(0,this._bin.byteLength).then(n,s=>o(s.message)),!0)}loadTextureBufferAsync(e,t,n){const o=e.textures[t],s=e.images[o.source];if(!s.extensions||!(this.name in s.extensions))return!1;const a=s.extensions[this.name],i=e.bufferViews[a.bufferView],l=Y.GetBufferFromBufferView(e,i,0,i.byteLength,ve.UNSIGNED_BYTE);return n(l),!0}loadShaderStringAsync(e,t,n){const o=e.shaders[t];if(!o.extensions||!(this.name in o.extensions))return!1;const s=o.extensions[this.name],a=e.bufferViews[s.bufferView],i=Y.GetBufferFromBufferView(e,a,0,a.byteLength,ve.UNSIGNED_BYTE);return setTimeout(()=>{const l=Y.DecodeBufferToText(i);n(l)}),!0}}Le.RegisterExtension(new co);class uo extends Z{constructor(){super("KHR_materials_common")}loadRuntimeExtensionsAsync(e){if(!e.extensions)return!1;const t=e.extensions[this.name];if(!t)return!1;const n=t.lights;if(n)for(const o in n){const s=n[o];switch(s.type){case"ambient":{const a=new Un(s.name,new G(0,1,0),e.scene),i=s.ambient;i&&(a.diffuse=V.FromArray(i.color||[1,1,1]));break}case"point":{const a=new Zt(s.name,new G(10,10,10),e.scene),i=s.point;i&&(a.diffuse=V.FromArray(i.color||[1,1,1]));break}case"directional":{const a=new Jt(s.name,new G(0,-1,0),e.scene),i=s.directional;i&&(a.diffuse=V.FromArray(i.color||[1,1,1]));break}case"spot":{const a=s.spot;if(a){const i=new ye(s.name,new G(0,10,0),new G(0,-1,0),a.fallOffAngle||Math.PI,a.fallOffExponent||0,e.scene);i.diffuse=V.FromArray(a.color||[1,1,1])}break}default:M.Warn('GLTF Material Common extension: light type "'+s.type+" not supported");break}}return!1}loadMaterialAsync(e,t,n,o){const s=e.materials[t];if(!s||!s.extensions)return!1;const a=s.extensions[this.name];if(!a)return!1;const i=new Xt(t,e.scene);return i.sideOrientation=_e.CounterClockWiseSideOrientation,a.technique==="CONSTANT"&&(i.disableLighting=!0),i.backFaceCulling=a.doubleSided===void 0?!1:!a.doubleSided,i.alpha=a.values.transparency===void 0?1:a.values.transparency,i.specularPower=a.values.shininess===void 0?0:a.values.shininess,typeof a.values.ambient=="string"?this._loadTexture(e,a.values.ambient,i,"ambientTexture",o):i.ambientColor=V.FromArray(a.values.ambient||[0,0,0]),typeof a.values.diffuse=="string"?this._loadTexture(e,a.values.diffuse,i,"diffuseTexture",o):i.diffuseColor=V.FromArray(a.values.diffuse||[0,0,0]),typeof a.values.emission=="string"?this._loadTexture(e,a.values.emission,i,"emissiveTexture",o):i.emissiveColor=V.FromArray(a.values.emission||[0,0,0]),typeof a.values.specular=="string"?this._loadTexture(e,a.values.specular,i,"specularTexture",o):i.specularColor=V.FromArray(a.values.specular||[0,0,0]),!0}_loadTexture(e,t,n,o,s){ge.LoadTextureBufferAsync(e,t,a=>{ge.CreateTextureAsync(e,t,a,i=>n[o]=i)},s)}}Le.RegisterExtension(new uo);const en=new Map,ho=en;function S(r,e,t){L(r)&&C.Warn(`Extension with the name '${r}' already exists`),en.set(r,{isGLTFExtension:e,factory:t})}function L(r){return en.delete(r)}class _o{constructor(e,t){this._gltf=e,this._infoTree=t}convert(e){let t=this._gltf,n=this._infoTree,o;if(!e.startsWith("/"))throw new Error("Path must start with a /");const s=e.split("/");if(s.shift(),s[s.length-1].includes(".length")){const l=s[s.length-1].split(".");s.pop(),s.push(...l)}let a=!1;for(const i of s){const l=i==="length";if(l&&!n.__array__)throw new Error(`Path ${e} is invalid`);if(n.__ignoreObjectTree__&&(a=!0),n.__array__&&!l)n=n.__array__;else if(n=n[i],!n)throw new Error(`Path ${e} is invalid`);if(!a){if(t===void 0)throw new Error(`Path ${e} is invalid`);l||(t=t==null?void 0:t[i])}(n.__target__||l)&&(o=t)}return{object:o,info:n}}}const po={length:{type:"number",get:r=>r.length,getTarget:r=>r.map(e=>e._babylonTransformNode),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Vector3",get:r=>{var e;return(e=r._babylonTransformNode)==null?void 0:e.position},set:(r,e)=>{var t;return(t=e._babylonTransformNode)==null?void 0:t.position.copyFrom(r)},getTarget:r=>r._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:r=>{var e;return(e=r._babylonTransformNode)==null?void 0:e.rotationQuaternion},set:(r,e)=>{var t,n;return(n=(t=e._babylonTransformNode)==null?void 0:t.rotationQuaternion)==null?void 0:n.copyFrom(r)},getTarget:r=>r._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Vector3",get:r=>{var e;return(e=r._babylonTransformNode)==null?void 0:e.scaling},set:(r,e)=>{var t;return(t=e._babylonTransformNode)==null?void 0:t.scaling.copyFrom(r)},getTarget:r=>r._babylonTransformNode,getPropertyName:[()=>"scaling"]},weights:{length:{type:"number",get:r=>r._numMorphTargets,getTarget:r=>r._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(r,e)=>{var t,n;return e!==void 0?(n=(t=r._primitiveBabylonMeshes)==null?void 0:t[0].morphTargetManager)==null?void 0:n.getTarget(e).influence:void 0},getTarget:r=>r._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(r,e)=>[0],getTarget:r=>r._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:r=>{var e,t,n;return ee.Compose((e=r._babylonTransformNode)==null?void 0:e.scaling,(t=r._babylonTransformNode)==null?void 0:t.rotationQuaternion,(n=r._babylonTransformNode)==null?void 0:n.position)},getTarget:r=>r._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:r=>{var o,s,a,i,l,c,u;const e=ee.Identity();let t=r.parent;for(;t&&t.parent;)t=t.parent;const n=((o=r._babylonTransformNode)==null?void 0:o.position._isDirty)||((a=(s=r._babylonTransformNode)==null?void 0:s.rotationQuaternion)==null?void 0:a._isDirty)||((i=r._babylonTransformNode)==null?void 0:i.scaling._isDirty);if(t){const h=(l=t._babylonTransformNode)==null?void 0:l.computeWorldMatrix(!0).invert();h&&((u=(c=r._babylonTransformNode)==null?void 0:c.computeWorldMatrix(n))==null||u.multiplyToRef(h,e))}else r._babylonTransformNode&&e.copyFrom(r._babylonTransformNode.computeWorldMatrix(n));return e},getTarget:r=>r._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:r=>{var e,t;return(t=(e=r._babylonTransformNode)==null?void 0:e.getChildren(n=>n instanceof ye,!0)[0])==null?void 0:t.intensity},getTarget:r=>{var e;return(e=r._babylonTransformNode)==null?void 0:e.getChildren(t=>t instanceof ye,!0)[0]},set:(r,e)=>{if(e._babylonTransformNode){const t=e._babylonTransformNode.getChildren(n=>n instanceof ye,!0)[0];t&&(t.intensity=r)}}},color:{type:"Color3",get:r=>{var e,t;return(t=(e=r._babylonTransformNode)==null?void 0:e.getChildren(n=>n instanceof ye,!0)[0])==null?void 0:t.diffuse},getTarget:r=>{var e;return(e=r._babylonTransformNode)==null?void 0:e.getChildren(t=>t instanceof ye,!0)[0]},set:(r,e)=>{if(e._babylonTransformNode){const t=e._babylonTransformNode.getChildren(n=>n instanceof ye,!0)[0];t&&(t.diffuse=r)}}}}}}},fo={length:{type:"number",get:r=>r.length,getTarget:r=>r.map(e=>e._babylonAnimationGroup),getPropertyName:[()=>"length"]},__array__:{}},mo={length:{type:"number",get:r=>r.length,getTarget:r=>r.map(e=>{var t;return(t=e.primitives[0]._instanceData)==null?void 0:t.babylonSourceMesh}),getPropertyName:[()=>"length"]},__array__:{}},yo={__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:r=>{var e,t;return new qe(((e=r._babylonCamera)==null?void 0:e.orthoLeft)??0,((t=r._babylonCamera)==null?void 0:t.orthoRight)??0)},set:(r,e)=>{e._babylonCamera&&(e._babylonCamera.orthoLeft=r.x,e._babylonCamera.orthoRight=r.y)},getTarget:r=>r,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:r=>{var e,t;return new qe(((e=r._babylonCamera)==null?void 0:e.orthoBottom)??0,((t=r._babylonCamera)==null?void 0:t.orthoTop)??0)},set:(r,e)=>{e._babylonCamera&&(e._babylonCamera.orthoBottom=r.x,e._babylonCamera.orthoTop=r.y)},getTarget:r=>r,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:r=>{var e;return(e=r._babylonCamera)==null?void 0:e.maxZ},set:(r,e)=>{e._babylonCamera&&(e._babylonCamera.maxZ=r)},getTarget:r=>r,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:r=>{var e;return(e=r._babylonCamera)==null?void 0:e.minZ},set:(r,e)=>{e._babylonCamera&&(e._babylonCamera.minZ=r)},getTarget:r=>r,getPropertyName:[()=>"minZ"]}},perspective:{aspectRatio:{type:"number",get:r=>{var e;return(e=r._babylonCamera)==null?void 0:e.getEngine().getAspectRatio(r._babylonCamera)},getTarget:r=>r,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:r=>{var e;return(e=r._babylonCamera)==null?void 0:e.fov},set:(r,e)=>{e._babylonCamera&&(e._babylonCamera.fov=r)},getTarget:r=>r,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:r=>{var e;return(e=r._babylonCamera)==null?void 0:e.maxZ},set:(r,e)=>{e._babylonCamera&&(e._babylonCamera.maxZ=r)},getTarget:r=>r,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:r=>{var e;return(e=r._babylonCamera)==null?void 0:e.minZ},set:(r,e)=>{e._babylonCamera&&(e._babylonCamera.minZ=r)},getTarget:r=>r,getPropertyName:[()=>"minZ"]}}}},go={__array__:{__target__:!0,emissiveFactor:{type:"Color3",get:(r,e,t)=>y(r,e,t).emissiveColor,set:(r,e,t,n)=>y(e,t,n).emissiveColor.copyFrom(r),getTarget:(r,e,t)=>y(r,e,t),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:J("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(r,e,t)=>{var n;return(n=xe(r,t,"bumpTexture"))==null?void 0:n.level},set:(r,e,t,n)=>{const o=xe(e,n,"bumpTexture");o&&(o.level=r)},getTarget:(r,e,t)=>y(r,e,t),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:J("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(r,e,t)=>y(r,e,t).ambientTextureStrength,set:(r,e,t,n)=>{const o=y(e,t,n);o&&(o.ambientTextureStrength=r)},getTarget:(r,e,t)=>y(r,e,t),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:J("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Color4",get:(r,e,t)=>{const n=y(r,e,t);return Hn.FromColor3(n.albedoColor,n.alpha)},set:(r,e,t,n)=>{const o=y(e,t,n);o.albedoColor.set(r.r,r.g,r.b),o.alpha=r.a},getTarget:(r,e,t)=>y(r,e,t),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:J("albedoTexture")}},metallicFactor:{type:"number",get:(r,e,t)=>y(r,e,t).metallic,set:(r,e,t,n)=>{const o=y(e,t,n);o&&(o.metallic=r)},getTarget:(r,e,t)=>y(r,e,t),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(r,e,t)=>y(r,e,t).roughness,set:(r,e,t,n)=>{const o=y(e,t,n);o&&(o.roughness=r)},getTarget:(r,e,t)=>y(r,e,t),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:J("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(r,e,t)=>y(r,e,t).anisotropy.intensity,set:(r,e,t,n)=>{y(e,t,n).anisotropy.intensity=r},getTarget:(r,e,t)=>y(r,e,t),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(r,e,t)=>y(r,e,t).anisotropy.angle,set:(r,e,t,n)=>{y(e,t,n).anisotropy.angle=r},getTarget:(r,e,t)=>y(r,e,t),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:J("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(r,e,t)=>y(r,e,t).clearCoat.intensity,set:(r,e,t,n)=>{y(e,t,n).clearCoat.intensity=r},getTarget:(r,e,t)=>y(r,e,t),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(r,e,t)=>y(r,e,t).clearCoat.roughness,set:(r,e,t,n)=>{y(e,t,n).clearCoat.roughness=r},getTarget:(r,e,t)=>y(r,e,t),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:J("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(r,e,t)=>{var n;return(n=y(r,e,t).clearCoat.bumpTexture)==null?void 0:n.level},getTarget:y,set:(r,e,t,n)=>y(e,t,n).clearCoat.bumpTexture.level=r},extensions:{KHR_texture_transform:J("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:J("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(r,e,t)=>y(r,e,t).subSurface.dispersion,getTarget:y,set:(r,e,t,n)=>y(e,t,n).subSurface.dispersion=r}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(r,e,t)=>y(r,e,t).emissiveIntensity,getTarget:y,set:(r,e,t,n)=>y(e,t,n).emissiveIntensity=r}},KHR_materials_ior:{ior:{type:"number",get:(r,e,t)=>y(r,e,t).indexOfRefraction,getTarget:y,set:(r,e,t,n)=>y(e,t,n).indexOfRefraction=r}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(r,e,t)=>y(r,e,t).iridescence.intensity,getTarget:y,set:(r,e,t,n)=>y(e,t,n).iridescence.intensity=r},iridescenceIor:{type:"number",get:(r,e,t)=>y(r,e,t).iridescence.indexOfRefraction,getTarget:y,set:(r,e,t,n)=>y(e,t,n).iridescence.indexOfRefraction=r},iridescenceTexture:{extensions:{KHR_texture_transform:J("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(r,e,t)=>y(r,e,t).iridescence.maximumThickness,getTarget:y,set:(r,e,t,n)=>y(e,t,n).iridescence.maximumThickness=r},iridescenceThicknessMinimum:{type:"number",get:(r,e,t)=>y(r,e,t).iridescence.minimumThickness,getTarget:y,set:(r,e,t,n)=>y(e,t,n).iridescence.minimumThickness=r},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:J("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Color3",get:(r,e,t)=>y(r,e,t).sheen.color,getTarget:y,set:(r,e,t,n)=>y(e,t,n).sheen.color.copyFrom(r)},sheenColorTexture:{extensions:{KHR_texture_transform:J("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(r,e,t)=>y(r,e,t).sheen.intensity,getTarget:y,set:(r,e,t,n)=>y(e,t,n).sheen.intensity=r},sheenRoughnessTexture:{extensions:{KHR_texture_transform:J("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(r,e,t)=>y(r,e,t).metallicF0Factor,getTarget:y,set:(r,e,t,n)=>y(e,t,n).metallicF0Factor=r,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Color3",get:(r,e,t)=>y(r,e,t).metallicReflectanceColor,getTarget:y,set:(r,e,t,n)=>y(e,t,n).metallicReflectanceColor.copyFrom(r),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:J("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:J("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(r,e,t)=>y(r,e,t).subSurface.refractionIntensity,getTarget:y,set:(r,e,t,n)=>y(e,t,n).subSurface.refractionIntensity=r,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:J("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(r,e,t)=>y(r,e,t).subSurface.translucencyIntensity,getTarget:y,set:(r,e,t,n)=>y(e,t,n).subSurface.translucencyIntensity=r},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:J("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Color3",get:(r,e,t)=>y(r,e,t).subSurface.translucencyColor,getTarget:y,set:(r,e,t,n)=>{var o;return r&&((o=y(e,t,n).subSurface.translucencyColor)==null?void 0:o.copyFrom(r))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:J("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Color3",get:(r,e,t)=>y(r,e,t).subSurface.tintColor,getTarget:y,set:(r,e,t,n)=>y(e,t,n).subSurface.tintColor.copyFrom(r)},attenuationDistance:{type:"number",get:(r,e,t)=>y(r,e,t).subSurface.tintColorAtDistance,getTarget:y,set:(r,e,t,n)=>y(e,t,n).subSurface.tintColorAtDistance=r},thicknessFactor:{type:"number",get:(r,e,t)=>y(r,e,t).subSurface.maximumThickness,getTarget:y,set:(r,e,t,n)=>y(e,t,n).subSurface.maximumThickness=r},thicknessTexture:{extensions:{KHR_texture_transform:J("subSurface","thicknessTexture")}}}}}},wo={KHR_lights_punctual:{lights:{length:{type:"number",get:r=>r.length,getTarget:r=>r.map(e=>e._babylonLight),getPropertyName:[r=>"length"]},__array__:{__target__:!0,color:{type:"Color3",get:r=>{var e;return(e=r._babylonLight)==null?void 0:e.diffuse},set:(r,e)=>{var t;return(t=e._babylonLight)==null?void 0:t.diffuse.copyFrom(r)},getTarget:r=>r._babylonLight,getPropertyName:[r=>"diffuse"]},intensity:{type:"number",get:r=>{var e;return(e=r._babylonLight)==null?void 0:e.intensity},set:(r,e)=>e._babylonLight?e._babylonLight.intensity=r:void 0,getTarget:r=>r._babylonLight,getPropertyName:[r=>"intensity"]},range:{type:"number",get:r=>{var e;return(e=r._babylonLight)==null?void 0:e.range},set:(r,e)=>e._babylonLight?e._babylonLight.range=r:void 0,getTarget:r=>r._babylonLight,getPropertyName:[r=>"range"]},spot:{innerConeAngle:{type:"number",get:r=>{var e;return(e=r._babylonLight)==null?void 0:e.innerAngle},set:(r,e)=>e._babylonLight?e._babylonLight.innerAngle=r:void 0,getTarget:r=>r._babylonLight,getPropertyName:[r=>"innerConeAngle"]},outerConeAngle:{type:"number",get:r=>{var e;return(e=r._babylonLight)==null?void 0:e.angle},set:(r,e)=>e._babylonLight?e._babylonLight.angle=r:void 0,getTarget:r=>r._babylonLight,getPropertyName:[r=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:r=>r.length,getTarget:r=>r.map(e=>e._babylonLight),getPropertyName:[r=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:r=>r.length,getTarget:r=>r.map(e=>e._babylonTexture),getPropertyName:[r=>"length"]},__array__:{__target__:!0,intensity:{type:"number",get:r=>{var e;return(e=r._babylonTexture)==null?void 0:e.level},set:(r,e)=>{e._babylonTexture&&(e._babylonTexture.level=r)},getTarget:r=>r._babylonTexture},rotation:{type:"Quaternion",get:r=>{var e;return r._babylonTexture&&j.FromRotationMatrix((e=r._babylonTexture)==null?void 0:e.getReflectionTextureMatrix())},set:(r,e)=>{var t;e._babylonTexture&&((t=e._babylonTexture.getScene())!=null&&t.useRightHandedSystem||(r=j.Inverse(r)),ee.FromQuaternionToRef(r,e._babylonTexture.getReflectionTextureMatrix()))},getTarget:r=>r._babylonTexture}}}}};function xe(r,e,t,n){const o=y(r);return n?o[t][n]:o[t]}function y(r,e,t){var n,o;return(o=(n=r._data)==null?void 0:n[(t==null?void 0:t.fillMode)??Te.MATERIAL_TriangleFillMode])==null?void 0:o.babylonMaterial}function J(r,e){return{offset:{componentsCount:2,type:"Vector2",get:(t,n,o)=>{const s=xe(t,o,r,e);return new qe(s==null?void 0:s.uOffset,s==null?void 0:s.vOffset)},getTarget:y,set:(t,n,o,s)=>{const a=xe(n,s,r,e);a.uOffset=t.x,a.vOffset=t.y},getPropertyName:[()=>`${r}${e?"."+e:""}.uOffset`,()=>`${r}${e?"."+e:""}.vOffset`]},rotation:{type:"number",get:(t,n,o)=>{var s;return(s=xe(t,o,r,e))==null?void 0:s.wAng},getTarget:y,set:(t,n,o,s)=>xe(n,s,r,e).wAng=t,getPropertyName:[()=>`${r}${e?"."+e:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(t,n,o)=>{const s=xe(t,o,r,e);return new qe(s==null?void 0:s.uScale,s==null?void 0:s.vScale)},getTarget:y,set:(t,n,o,s)=>{const a=xe(n,s,r,e);a.uScale=t.x,a.vScale=t.y},getPropertyName:[()=>`${r}${e?"."+e:""}.uScale`,()=>`${r}${e?"."+e:""}.vScale`]}}}const Pt={cameras:yo,nodes:po,materials:go,extensions:wo,animations:fo,meshes:mo};function jn(r){return new _o(r,Pt)}function et(r){const e=r.split("/").map(n=>n.replace(/{}/g,"__array__"));let t=Pt;for(const n of e)n&&(t=t[n]);if(t&&t.type&&t.get)return t}function f(r,e){const t=r.split("/").map(o=>o.replace(/{}/g,"__array__"));let n=Pt;for(const o of t)o&&(n=n[o]);n&&n.type&&n.get&&(n.interpolation=e)}function me(r,e){const t=r.split("/").map(o=>o.replace(/{}/g,"__array__"));let n=Pt;for(const o of t)if(o){if(!n[o]){if(o==="?"){n.__ignoreObjectTree__=!0;continue}n[o]={},o==="__array__"&&(n[o].__target__=!0)}n=n[o]}Object.assign(n,e)}class g{static Get(e,t,n){if(!t||n==null||!t[n])throw new Error(`${e}: Failed to find index (${n})`);return t[n]}static TryGet(e,t){return!e||t==null||!e[t]?null:e[t]}static Assign(e){if(e)for(let t=0;t<e.length;t++)e[t].index=t}}function zn(r){if(r.min&&r.max){const e=r.min,t=r.max,n=he.Vector3[0].copyFromFloats(e[0],e[1],e[2]),o=he.Vector3[1].copyFromFloats(t[0],t[1],t[2]);if(r.normalized&&r.componentType!==5126){let s=1;switch(r.componentType){case 5120:s=127;break;case 5121:s=255;break;case 5122:s=32767;break;case 5123:s=65535;break}const a=1/s;n.scaleInPlace(a),o.scaleInPlace(a)}return new kr(n,o)}return null}class T{static RegisterExtension(e,t){S(e,!1,t)}static UnregisterExtension(e){return L(e)}get gltf(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(e){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=e}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach(e=>e.dispose&&e.dispose()),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(e,t,n,o,s,a,i=""){return Promise.resolve().then(()=>{this._babylonScene=t,this._assetContainer=n,this._loadData(o);let l=null;if(e){const c={};if(this._gltf.nodes)for(const h of this._gltf.nodes)h.name&&(c[h.name]=h.index);l=(e instanceof Array?e:[e]).map(h=>{const d=c[h];if(d===void 0)throw new Error(`Failed to find node '${h}'`);return d})}return this._loadAsync(s,i,l,()=>({meshes:this._getMeshes(),particleSystems:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]}))})}loadAsync(e,t,n,o,s=""){return Promise.resolve().then(()=>(this._babylonScene=e,this._loadData(t),this._loadAsync(n,s,null,()=>{})))}_loadAsync(e,t,n,o){return Promise.resolve().then(async()=>{this._rootUrl=e,this._uniqueRootUrl=!e.startsWith("file:")&&t?e:`${e}${Date.now()}/`,this._fileName=t,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const s=`${le[le.LOADING]} => ${le[le.READY]}`,a=`${le[le.LOADING]} => ${le[le.COMPLETE]}`;this._parent._startPerformanceCounter(s),this._parent._startPerformanceCounter(a),this._parent._setState(le.LOADING),this._extensionsOnLoading();const i=new Array,l=this._babylonScene.blockMaterialDirtyMechanism;if(this._babylonScene.blockMaterialDirtyMechanism=!0,!this.parent.loadOnlyMaterials){if(n)i.push(this.loadSceneAsync("/nodes",{nodes:n,index:-1}));else if(this._gltf.scene!=null||this._gltf.scenes&&this._gltf.scenes[0]){const u=g.Get("/scene",this._gltf.scenes,this._gltf.scene||0);i.push(this.loadSceneAsync(`/scenes/${u.index}`,u))}}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let u=0;u<this._gltf.materials.length;++u){const h=this._gltf.materials[u],d="/materials/"+u,p=_e.TriangleFillMode;i.push(this._loadMaterialAsync(d,h,null,p,()=>{}))}return this._allMaterialsDirtyRequired?this._babylonScene.blockMaterialDirtyMechanism=l:this._babylonScene._forceBlockMaterialDirtyMechanism(l),this._parent.compileMaterials&&i.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&i.push(this._compileShadowGeneratorsAsync()),Promise.all(i).then(()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.setEnabled(!0);for(const u of this._babylonScene.materials){const h=u;h.maxSimultaneousLights!==void 0&&(h.maxSimultaneousLights=Math.max(h.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(le.READY),this._skipStartAnimationStep||this._startAnimations(),o()}).then(u=>(this._parent._endPerformanceCounter(s),M.SetImmediate(()=>{this._disposed||Promise.all(this._completePromises).then(()=>{this._parent._endPerformanceCounter(a),this._parent._setState(le.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()},h=>{this._parent.onErrorObservable.notifyObservers(h),this._parent.onErrorObservable.clear(),this.dispose()})}),u))}).catch(s=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(s),this._parent.onErrorObservable.clear(),this.dispose()),s})}_loadData(e){if(this._gltf=e.json,this._setupData(),e.bin){const t=this._gltf.buffers;if(t&&t[0]&&!t[0].uri){const n=t[0];(n.byteLength<e.bin.byteLength-3||n.byteLength>e.bin.byteLength)&&C.Warn(`Binary buffer length (${n.byteLength}) from JSON does not match chunk length (${e.bin.byteLength})`),this._bin=e.bin}else C.Warn("Unexpected BIN chunk")}}_setupData(){if(g.Assign(this._gltf.accessors),g.Assign(this._gltf.animations),g.Assign(this._gltf.buffers),g.Assign(this._gltf.bufferViews),g.Assign(this._gltf.cameras),g.Assign(this._gltf.images),g.Assign(this._gltf.materials),g.Assign(this._gltf.meshes),g.Assign(this._gltf.nodes),g.Assign(this._gltf.samplers),g.Assign(this._gltf.scenes),g.Assign(this._gltf.skins),g.Assign(this._gltf.textures),this._gltf.nodes){const e={};for(const n of this._gltf.nodes)if(n.children)for(const o of n.children)e[o]=n.index;const t=this._createRootNode();for(const n of this._gltf.nodes){const o=e[n.index];n.parent=o===void 0?t:this._gltf.nodes[o]}}}async _loadExtensionsAsync(){var t;const e=[];if(ho.forEach((n,o)=>{var s;((s=this.parent.extensionOptions[o])==null?void 0:s.enabled)===!1?n.isGLTFExtension&&this.isExtensionUsed(o)&&C.Warn(`Extension ${o} is used but has been explicitly disabled.`):(!n.isGLTFExtension||this.isExtensionUsed(o))&&e.push((async()=>{const a=await n.factory(this);return a.name!==o&&C.Warn(`The name of the glTF loader extension instance does not match the registered name: ${a.name} !== ${o}`),this._parent.onExtensionLoadedObservable.notifyObservers(a),a})())}),this._extensions.push(...await Promise.all(e)),this._extensions.sort((n,o)=>(n.order||Number.MAX_VALUE)-(o.order||Number.MAX_VALUE)),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired){for(const n of this._gltf.extensionsRequired)if(!this._extensions.some(s=>s.name===n&&s.enabled))throw((t=this.parent.extensionOptions[n])==null?void 0:t.enabled)===!1?new Error(`Required extension ${n} is disabled`):new Error(`Required extension ${n} is not available`)}}_createRootNode(){if(this._parent.customRootNode!==void 0)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:this._rootBabylonMesh===null?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const e=new Ne("__root__",this._babylonScene);this._rootBabylonMesh=e,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.setEnabled(!1);const t={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case We.AUTO:{this._babylonScene.useRightHandedSystem||(t.rotation=[0,1,0,0],t.scale=[1,1,-1],T._LoadTransform(t,this._rootBabylonMesh));break}case We.FORCE_RIGHT_HANDED:{this._babylonScene.useRightHandedSystem=!0;break}default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(e),t}loadSceneAsync(e,t){const n=this._extensionsLoadSceneAsync(e,t);if(n)return n;const o=new Array;if(this.logOpen(`${e} ${t.name||""}`),t.nodes)for(const s of t.nodes){const a=g.Get(`${e}/nodes/${s}`,this._gltf.nodes,s);o.push(this.loadNodeAsync(`/nodes/${a.index}`,a,i=>{i.parent=this._rootBabylonMesh}))}for(const s of this._postSceneLoadActions)s();return o.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(o).then(()=>{})}_forEachPrimitive(e,t){if(e._primitiveBabylonMeshes)for(const n of e._primitiveBabylonMeshes)t(n)}_getGeometries(){const e=[],t=this._gltf.nodes;if(t)for(const n of t)this._forEachPrimitive(n,o=>{const s=o.geometry;s&&e.indexOf(s)===-1&&e.push(s)});return e}_getMeshes(){const e=[];this._rootBabylonMesh instanceof Kn&&e.push(this._rootBabylonMesh);const t=this._gltf.nodes;if(t)for(const n of t)this._forEachPrimitive(n,o=>{e.push(o)});return e}_getTransformNodes(){const e=[],t=this._gltf.nodes;if(t)for(const n of t)n._babylonTransformNode&&n._babylonTransformNode.getClassName()==="TransformNode"&&e.push(n._babylonTransformNode),n._babylonTransformNodeForSkin&&e.push(n._babylonTransformNodeForSkin);return e}_getSkeletons(){const e=[],t=this._gltf.skins;if(t)for(const n of t)n._data&&e.push(n._data.babylonSkeleton);return e}_getAnimationGroups(){const e=[],t=this._gltf.animations;if(t)for(const n of t)n._babylonAnimationGroup&&e.push(n._babylonAnimationGroup);return e}_startAnimations(){switch(this._parent.animationStartMode){case Pe.NONE:break;case Pe.FIRST:{const e=this._getAnimationGroups();e.length!==0&&e[0].start(!0);break}case Pe.ALL:{const e=this._getAnimationGroups();for(const t of e)t.start(!0);break}default:{C.Error(`Invalid animation start mode (${this._parent.animationStartMode})`);return}}}loadNodeAsync(e,t,n=()=>{}){const o=this._extensionsLoadNodeAsync(e,t,n);if(o)return o;if(t._babylonTransformNode)throw new Error(`${e}: Invalid recursive node hierarchy`);const s=new Array;this.logOpen(`${e} ${t.name||""}`);const a=c=>{if(T.AddPointerMetadata(c,e),T._LoadTransform(t,c),t.camera!=null){const u=g.Get(`${e}/camera`,this._gltf.cameras,t.camera);s.push(this.loadCameraAsync(`/cameras/${u.index}`,u,h=>{h.parent=c}))}if(t.children)for(const u of t.children){const h=g.Get(`${e}/children/${u}`,this._gltf.nodes,u);s.push(this.loadNodeAsync(`/nodes/${h.index}`,h,d=>{d.parent=c}))}n(c)},i=t.mesh!=null,l=this._parent.loadSkins&&t.skin!=null;if(!i||l){const c=t.name||`node${t.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const u=new kn(c,this._babylonScene);u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t.mesh==null?t._babylonTransformNode=u:t._babylonTransformNodeForSkin=u,a(u)}if(i)if(l){const c=g.Get(`${e}/mesh`,this._gltf.meshes,t.mesh);s.push(this._loadMeshAsync(`/meshes/${c.index}`,t,c,u=>{const h=t._babylonTransformNodeForSkin;u.metadata=wr(h.metadata,u.metadata||{});const d=g.Get(`${e}/skin`,this._gltf.skins,t.skin);s.push(this._loadSkinAsync(`/skins/${d.index}`,t,d,p=>{this._forEachPrimitive(t,m=>{m.skeleton=p}),this._postSceneLoadActions.push(()=>{if(d.skeleton!=null){const m=g.Get(`/skins/${d.index}/skeleton`,this._gltf.nodes,d.skeleton).parent;t.index===m.index?u.parent=h.parent:u.parent=m._babylonTransformNode}else u.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:h,skinnedNode:u})})}))}))}else{const c=g.Get(`${e}/mesh`,this._gltf.meshes,t.mesh);s.push(this._loadMeshAsync(`/meshes/${c.index}`,t,c,a))}return this.logClose(),Promise.all(s).then(()=>(this._forEachPrimitive(t,c=>{const u=c;!u.isAnInstance&&u.geometry&&u.geometry.useBoundingInfoFromGeometry?c._updateBoundingInfo():c.refreshBoundingInfo(!0,!0)}),t._babylonTransformNode))}_loadMeshAsync(e,t,n,o){const s=n.primitives;if(!s||!s.length)throw new Error(`${e}: Primitives are missing`);s[0].index==null&&g.Assign(s);const a=new Array;this.logOpen(`${e} ${n.name||""}`);const i=t.name||`node${t.index}`;if(s.length===1){const l=n.primitives[0];a.push(this._loadMeshPrimitiveAsync(`${e}/primitives/${l.index}`,i,t,n,l,c=>{t._babylonTransformNode=c,t._primitiveBabylonMeshes=[c]}))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,t._babylonTransformNode=new kn(i,this._babylonScene),t._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._primitiveBabylonMeshes=[];for(const l of s)a.push(this._loadMeshPrimitiveAsync(`${e}/primitives/${l.index}`,`${i}_primitive${l.index}`,t,n,l,c=>{c.parent=t._babylonTransformNode,t._primitiveBabylonMeshes.push(c)}))}return o(t._babylonTransformNode),this.logClose(),Promise.all(a).then(()=>t._babylonTransformNode)}_loadMeshPrimitiveAsync(e,t,n,o,s,a){const i=this._extensionsLoadMeshPrimitiveAsync(e,t,n,o,s,a);if(i)return i;this.logOpen(`${e}`);const l=this._disableInstancedMesh===0&&this._parent.createInstances&&n.skin==null&&!o.primitives[0].targets;let c,u;if(l&&s._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,c=s._instanceData.babylonSourceMesh.createInstance(t),c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u=s._instanceData.promise;else{const h=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const d=new Ne(t,this._babylonScene);d._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d.sideOrientation=this._babylonScene.useRightHandedSystem?_e.CounterClockWiseSideOrientation:_e.ClockWiseSideOrientation,this._createMorphTargets(e,n,o,s,d),h.push(this._loadVertexDataAsync(e,s,d).then(m=>this._loadMorphTargetsAsync(e,s,d,m).then(()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,m.applyToMesh(d),m._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})));const p=T._GetDrawMode(e,s.mode);if(s.material==null){let m=this._defaultBabylonMaterialData[p];m||(m=this._createDefaultMaterial("__GLTFLoader._default",p),this._parent.onMaterialLoadedObservable.notifyObservers(m),this._defaultBabylonMaterialData[p]=m),d.material=m}else if(!this.parent.skipMaterials){const m=g.Get(`${e}/material`,this._gltf.materials,s.material);h.push(this._loadMaterialAsync(`/materials/${m.index}`,m,d,p,b=>{d.material=b}))}u=Promise.all(h),l&&(s._instanceData={babylonSourceMesh:d,promise:u}),c=d}return T.AddPointerMetadata(c,e),this._parent.onMeshLoadedObservable.notifyObservers(c),a(c),this.logClose(),u.then(()=>c)}_loadVertexDataAsync(e,t,n){const o=this._extensionsLoadVertexDataAsync(e,t,n);if(o)return o;const s=t.attributes;if(!s)throw new Error(`${e}: Attributes are missing`);const a=new Array,i=new Wn(n.name,this._babylonScene);if(t.indices==null)n.isUnIndexed=!0;else{const c=g.Get(`${e}/indices`,this._gltf.accessors,t.indices);a.push(this._loadIndicesAccessorAsync(`/accessors/${c.index}`,c).then(u=>{i.setIndices(u)}))}const l=(c,u,h)=>{if(s[c]==null)return;n._delayInfo=n._delayInfo||[],n._delayInfo.indexOf(u)===-1&&n._delayInfo.push(u);const d=g.Get(`${e}/attributes/${c}`,this._gltf.accessors,s[c]);a.push(this._loadVertexAccessorAsync(`/accessors/${d.index}`,d,u).then(p=>{if(p.getKind()===N.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!n.skeleton){const m=zn(d);m&&(i._boundingInfo=m,i.useBoundingInfoFromGeometry=!0)}i.setVerticesBuffer(p,d.count)})),u==N.MatricesIndicesExtraKind&&(n.numBoneInfluencers=8),h&&h(d)};return l("POSITION",N.PositionKind),l("NORMAL",N.NormalKind),l("TANGENT",N.TangentKind),l("TEXCOORD_0",N.UVKind),l("TEXCOORD_1",N.UV2Kind),l("TEXCOORD_2",N.UV3Kind),l("TEXCOORD_3",N.UV4Kind),l("TEXCOORD_4",N.UV5Kind),l("TEXCOORD_5",N.UV6Kind),l("JOINTS_0",N.MatricesIndicesKind),l("WEIGHTS_0",N.MatricesWeightsKind),l("JOINTS_1",N.MatricesIndicesExtraKind),l("WEIGHTS_1",N.MatricesWeightsExtraKind),l("COLOR_0",N.ColorKind,c=>{c.type==="VEC4"&&(n.hasVertexAlpha=!0)}),Promise.all(a).then(()=>i)}_createMorphTargets(e,t,n,o,s){if(!o.targets||!this._parent.loadMorphTargets)return;if(t._numMorphTargets==null)t._numMorphTargets=o.targets.length;else if(o.targets.length!==t._numMorphTargets)throw new Error(`${e}: Primitives do not have the same number of targets`);const a=n.extras?n.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,s.morphTargetManager=new br(this._babylonScene),s.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,s.morphTargetManager.areUpdatesFrozen=!0;for(let i=0;i<o.targets.length;i++){const l=t.weights?t.weights[i]:n.weights?n.weights[i]:0,c=a?a[i]:`morphTarget${i}`;s.morphTargetManager.addTarget(new Ar(c,l,s.getScene()))}}_loadMorphTargetsAsync(e,t,n,o){if(!t.targets||!this._parent.loadMorphTargets)return Promise.resolve();const s=new Array,a=n.morphTargetManager;for(let i=0;i<a.numTargets;i++){const l=a.getTarget(i);s.push(this._loadMorphTargetVertexDataAsync(`${e}/targets/${i}`,o,t.targets[i],l))}return Promise.all(s).then(()=>{a.areUpdatesFrozen=!1})}_loadMorphTargetVertexDataAsync(e,t,n,o){const s=new Array,a=(i,l,c)=>{if(n[i]==null)return;const u=t.getVertexBuffer(l);if(!u)return;const h=g.Get(`${e}/${i}`,this._gltf.accessors,n[i]);s.push(this._loadFloatAccessorAsync(`/accessors/${h.index}`,h).then(d=>{c(u,d)}))};return a("POSITION",N.PositionKind,(i,l)=>{const c=new Float32Array(l.length);i.forEach(l.length,(u,h)=>{c[h]=l[h]+u}),o.setPositions(c)}),a("NORMAL",N.NormalKind,(i,l)=>{const c=new Float32Array(l.length);i.forEach(c.length,(u,h)=>{c[h]=l[h]+u}),o.setNormals(c)}),a("TANGENT",N.TangentKind,(i,l)=>{const c=new Float32Array(l.length/3*4);let u=0;i.forEach(l.length/3*4,(h,d)=>{(d+1)%4!==0&&(c[u]=l[u]+h,u++)}),o.setTangents(c)}),a("TEXCOORD_0",N.UVKind,(i,l)=>{const c=new Float32Array(l.length);i.forEach(l.length,(u,h)=>{c[h]=l[h]+u}),o.setUVs(c)}),a("TEXCOORD_1",N.UV2Kind,(i,l)=>{const c=new Float32Array(l.length);i.forEach(l.length,(u,h)=>{c[h]=l[h]+u}),o.setUV2s(c)}),a("COLOR_0",N.ColorKind,(i,l)=>{let c=null;const u=i.getSize();if(u===3){c=new Float32Array(l.length/3*4),i.forEach(l.length,(h,d)=>{const p=Math.floor(d/3),m=d%3;c[4*p+m]=l[3*p+m]+h});for(let h=0;h<l.length/3;++h)c[4*h+3]=1}else if(u===4)c=new Float32Array(l.length),i.forEach(l.length,(h,d)=>{c[d]=l[d]+h});else throw new Error(`${e}: Invalid number of components (${u}) for COLOR_0 attribute`);o.setColors(c)}),Promise.all(s).then(()=>{})}static _LoadTransform(e,t){if(e.skin!=null)return;let n=G.Zero(),o=j.Identity(),s=G.One();e.matrix?ee.FromArray(e.matrix).decompose(s,o,n):(e.translation&&(n=G.FromArray(e.translation)),e.rotation&&(o=j.FromArray(e.rotation)),e.scale&&(s=G.FromArray(e.scale))),t.position=n,t.rotationQuaternion=o,t.scaling=s}_loadSkinAsync(e,t,n,o){if(!this._parent.loadSkins)return Promise.resolve();const s=this._extensionsLoadSkinAsync(e,t,n);if(s)return s;if(n._data)return o(n._data.babylonSkeleton),n._data.promise;const a=`skeleton${n.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new Yt(n.name||a,a,this._babylonScene);i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(e,n,i);const l=this._loadSkinInverseBindMatricesDataAsync(e,n).then(c=>{this._updateBoneMatrices(i,c)});return n._data={babylonSkeleton:i,promise:l},o(i),l}_loadBones(e,t,n){if(t.skeleton==null||this._parent.alwaysComputeSkeletonRootNode){const s=this._findSkeletonRootNode(`${e}/joints`,t.joints);if(s)if(t.skeleton===void 0)t.skeleton=s.index;else{const a=(l,c)=>{for(;c.parent;c=c.parent)if(c.parent===l)return!0;return!1},i=g.Get(`${e}/skeleton`,this._gltf.nodes,t.skeleton);i!==s&&!a(i,s)&&(C.Warn(`${e}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),t.skeleton=s.index)}else C.Warn(`${e}: Failed to find common root`)}const o={};for(const s of t.joints){const a=g.Get(`${e}/joints/${s}`,this._gltf.nodes,s);this._loadBone(a,t,n,o)}}_findSkeletonRootNode(e,t){if(t.length===0)return null;const n={};for(const s of t){const a=[];let i=g.Get(`${e}/${s}`,this._gltf.nodes,s);for(;i.index!==-1;)a.unshift(i),i=i.parent;n[s]=a}let o=null;for(let s=0;;++s){let a=n[t[0]];if(s>=a.length)return o;const i=a[s];for(let l=1;l<t.length;++l)if(a=n[t[l]],s>=a.length||i!==a[s])return o;o=i}}_loadBone(e,t,n,o){e._isJoint=!0;let s=o[e.index];if(s)return s;let a=null;e.index!==t.skeleton&&(e.parent&&e.parent.index!==-1?a=this._loadBone(e.parent,t,n,o):t.skeleton!==void 0&&C.Warn(`/skins/${t.index}/skeleton: Skeleton node is not a common root`));const i=t.joints.indexOf(e.index);return s=new Ze(e.name||`joint${e.index}`,n,a,this._getNodeMatrix(e),null,null,i),o[e.index]=s,this._postSceneLoadActions.push(()=>{s.linkTransformNode(e._babylonTransformNode)}),s}_loadSkinInverseBindMatricesDataAsync(e,t){if(t.inverseBindMatrices==null)return Promise.resolve(null);const n=g.Get(`${e}/inverseBindMatrices`,this._gltf.accessors,t.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${n.index}`,n)}_updateBoneMatrices(e,t){for(const n of e.bones){const o=ee.Identity(),s=n._index;t&&s!==-1&&(ee.FromArrayToRef(t,s*16,o),o.invertToRef(o));const a=n.getParent();a&&o.multiplyToRef(a.getAbsoluteInverseBindMatrix(),o),n.updateMatrix(o,!1,!1),n._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(e){return e.matrix?ee.FromArray(e.matrix):ee.Compose(e.scale?G.FromArray(e.scale):G.One(),e.rotation?j.FromArray(e.rotation):j.Identity(),e.translation?G.FromArray(e.translation):G.Zero())}loadCameraAsync(e,t,n=()=>{}){const o=this._extensionsLoadCameraAsync(e,t,n);if(o)return o;const s=new Array;this.logOpen(`${e} ${t.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const a=new Vt(t.name||`camera${t.index}`,G.Zero(),this._babylonScene,!1);switch(a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a.ignoreParentScaling=!0,t._babylonCamera=a,a.rotation.set(0,Math.PI,0),t.type){case"perspective":{const i=t.perspective;if(!i)throw new Error(`${e}: Camera perspective properties are missing`);a.fov=i.yfov,a.minZ=i.znear,a.maxZ=i.zfar||0;break}case"orthographic":{if(!t.orthographic)throw new Error(`${e}: Camera orthographic properties are missing`);a.mode=qn.ORTHOGRAPHIC_CAMERA,a.orthoLeft=-t.orthographic.xmag,a.orthoRight=t.orthographic.xmag,a.orthoBottom=-t.orthographic.ymag,a.orthoTop=t.orthographic.ymag,a.minZ=t.orthographic.znear,a.maxZ=t.orthographic.zfar;break}default:throw new Error(`${e}: Invalid camera type (${t.type})`)}return T.AddPointerMetadata(a,e),this._parent.onCameraLoadedObservable.notifyObservers(a),n(a),this.logClose(),Promise.all(s).then(()=>a)}_loadAnimationsAsync(){const e=this._gltf.animations;if(!e)return Promise.resolve();const t=new Array;for(let n=0;n<e.length;n++){const o=e[n];t.push(this.loadAnimationAsync(`/animations/${o.index}`,o).then(s=>{s.targetedAnimations.length===0&&s.dispose()}))}return Promise.all(t).then(()=>{})}loadAnimationAsync(e,t){const n=this._extensionsLoadAnimationAsync(e,t);return n||_(async()=>{const{AnimationGroup:o}=await import("./nativeXRFrame-DOeo_lEL.js").then(s=>s.bq);return{AnimationGroup:o}},[]).then(({AnimationGroup:o})=>{this._babylonScene._blockEntityCollection=!!this._assetContainer;const s=new o(t.name||`animation${t.index}`,this._babylonScene);s._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._babylonAnimationGroup=s;const a=new Array;g.Assign(t.channels),g.Assign(t.samplers);for(const i of t.channels)a.push(this._loadAnimationChannelAsync(`${e}/channels/${i.index}`,e,t,i,(l,c)=>{l.animations=l.animations||[],l.animations.push(c),s.addTargetedAnimation(c,l)}));return Promise.all(a).then(()=>(s.normalize(0),s))})}async _loadAnimationChannelAsync(e,t,n,o,s){var d,p,m,b;const a=this._extensionsLoadAnimationChannelAsync(e,t,n,o,s);if(a)return a;if(o.target.node==null)return Promise.resolve();const i=g.Get(`${e}/target/node`,this._gltf.nodes,o.target.node),l=o.target.path,c=l==="weights";if(c&&!i._numMorphTargets||!c&&!i._babylonTransformNode||!this._parent.loadNodeAnimations&&!c&&!i._isJoint)return Promise.resolve();await _(()=>Promise.resolve().then(()=>bo),void 0);let u;switch(l){case"translation":{u=(d=et("/nodes/{}/translation"))==null?void 0:d.interpolation;break}case"rotation":{u=(p=et("/nodes/{}/rotation"))==null?void 0:p.interpolation;break}case"scale":{u=(m=et("/nodes/{}/scale"))==null?void 0:m.interpolation;break}case"weights":{u=(b=et("/nodes/{}/weights"))==null?void 0:b.interpolation;break}default:throw new Error(`${e}/target/path: Invalid value (${o.target.path})`)}if(!u)throw new Error(`${e}/target/path: Could not find interpolation properties for target path (${o.target.path})`);const h={object:i,info:u};return this._loadAnimationChannelFromTargetInfoAsync(e,t,n,o,h,s)}_loadAnimationChannelFromTargetInfoAsync(e,t,n,o,s,a){const i=this.parent.targetFps,l=1/i,c=g.Get(`${e}/sampler`,n.samplers,o.sampler);return this._loadAnimationSamplerAsync(`${t}/samplers/${o.sampler}`,c).then(u=>{let h=0;const d=s.object,p=s.info;for(const m of p){const b=m.getStride(d),A=u.input,E=u.output,I=new Array(A.length);let P=0;switch(u.interpolation){case"STEP":{for(let O=0;O<A.length;O++){const k=m.getValue(d,E,P,1);P+=b,I[O]={frame:A[O]*i,value:k,interpolation:1}}break}case"CUBICSPLINE":{for(let O=0;O<A.length;O++){const k=m.getValue(d,E,P,l);P+=b;const B=m.getValue(d,E,P,1);P+=b;const v=m.getValue(d,E,P,l);P+=b,I[O]={frame:A[O]*i,inTangent:k,value:B,outTangent:v}}break}case"LINEAR":{for(let O=0;O<A.length;O++){const k=m.getValue(d,E,P,1);P+=b,I[O]={frame:A[O]*i,value:k}}break}}if(P>0){const O=`${n.name||`animation${n.index}`}_channel${o.index}_${h}`,k=m.buildAnimations(d,O,i,I);for(const B of k)h++,a(B.babylonAnimatable,B.babylonAnimation)}}})}_loadAnimationSamplerAsync(e,t){if(t._data)return t._data;const n=t.interpolation||"LINEAR";switch(n){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${e}/interpolation: Invalid value (${t.interpolation})`)}const o=g.Get(`${e}/input`,this._gltf.accessors,t.input),s=g.Get(`${e}/output`,this._gltf.accessors,t.output);return t._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${o.index}`,o),this._loadFloatAccessorAsync(`/accessors/${s.index}`,s)]).then(([a,i])=>({input:a,interpolation:n,output:i})),t._data}loadBufferAsync(e,t,n,o){const s=this._extensionsLoadBufferAsync(e,t,n,o);if(s)return s;if(!t._data)if(t.uri)t._data=this.loadUriAsync(`${e}/uri`,t,t.uri);else{if(!this._bin)throw new Error(`${e}: Uri is missing or the binary glTF is missing its binary chunk`);t._data=this._bin.readAsync(0,t.byteLength)}return t._data.then(a=>{try{return new Uint8Array(a.buffer,a.byteOffset+n,o)}catch(i){throw new Error(`${e}: ${i.message}`)}})}loadBufferViewAsync(e,t){const n=this._extensionsLoadBufferViewAsync(e,t);if(n)return n;if(t._data)return t._data;const o=g.Get(`${e}/buffer`,this._gltf.buffers,t.buffer);return t._data=this.loadBufferAsync(`/buffers/${o.index}`,o,t.byteOffset||0,t.byteLength),t._data}_loadAccessorAsync(e,t,n){if(t._data)return t._data;const o=T._GetNumComponents(e,t.type),s=o*N.GetTypeByteLength(t.componentType),a=o*t.count;if(t.bufferView==null)t._data=Promise.resolve(new n(a));else{const i=g.Get(`${e}/bufferView`,this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync(`/bufferViews/${i.index}`,i).then(l=>{if(t.componentType===5126&&!t.normalized&&(!i.byteStride||i.byteStride===s))return T._GetTypedArray(e,t.componentType,l,t.byteOffset,a);{const c=new n(a);return N.ForEach(l,t.byteOffset||0,i.byteStride||s,o,t.componentType,c.length,t.normalized||!1,(u,h)=>{c[h]=u}),c}})}if(t.sparse){const i=t.sparse;t._data=t._data.then(l=>{const c=l,u=g.Get(`${e}/sparse/indices/bufferView`,this._gltf.bufferViews,i.indices.bufferView),h=g.Get(`${e}/sparse/values/bufferView`,this._gltf.bufferViews,i.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${u.index}`,u),this.loadBufferViewAsync(`/bufferViews/${h.index}`,h)]).then(([d,p])=>{const m=T._GetTypedArray(`${e}/sparse/indices`,i.indices.componentType,d,i.indices.byteOffset,i.count),b=o*i.count;let A;if(t.componentType===5126&&!t.normalized)A=T._GetTypedArray(`${e}/sparse/values`,t.componentType,p,i.values.byteOffset,b);else{const I=T._GetTypedArray(`${e}/sparse/values`,t.componentType,p,i.values.byteOffset,b);A=new n(b),N.ForEach(I,0,s,o,t.componentType,A.length,t.normalized||!1,(P,O)=>{A[O]=P})}let E=0;for(let I=0;I<m.length;I++){let P=m[I]*o;for(let O=0;O<o;O++)c[P++]=A[E++]}return c})})}return t._data}_loadFloatAccessorAsync(e,t){return this._loadAccessorAsync(e,t,Float32Array)}_loadIndicesAccessorAsync(e,t){if(t.type!=="SCALAR")throw new Error(`${e}/type: Invalid value ${t.type}`);if(t.componentType!==5121&&t.componentType!==5123&&t.componentType!==5125)throw new Error(`${e}/componentType: Invalid value ${t.componentType}`);if(t._data)return t._data;if(t.sparse){const n=T._GetTypedArrayConstructor(`${e}/componentType`,t.componentType);t._data=this._loadAccessorAsync(e,t,n)}else{const n=g.Get(`${e}/bufferView`,this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync(`/bufferViews/${n.index}`,n).then(o=>T._GetTypedArray(e,t.componentType,o,t.byteOffset,t.count))}return t._data}_loadVertexBufferViewAsync(e){if(e._babylonBuffer)return e._babylonBuffer;const t=this._babylonScene.getEngine();return e._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${e.index}`,e).then(n=>new Tr(t,n,!1)),e._babylonBuffer}_loadVertexAccessorAsync(e,t,n){var s;if((s=t._babylonVertexBuffer)!=null&&s[n])return t._babylonVertexBuffer[n];t._babylonVertexBuffer||(t._babylonVertexBuffer={});const o=this._babylonScene.getEngine();if(t.sparse||t.bufferView==null)t._babylonVertexBuffer[n]=this._loadFloatAccessorAsync(e,t).then(a=>new N(o,a,n,!1));else{const a=g.Get(`${e}/bufferView`,this._gltf.bufferViews,t.bufferView);t._babylonVertexBuffer[n]=this._loadVertexBufferViewAsync(a).then(i=>{const l=T._GetNumComponents(e,t.type);return new N(o,i,n,!1,void 0,a.byteStride,void 0,t.byteOffset,l,t.componentType,t.normalized,!0,void 0,!0)})}return t._babylonVertexBuffer[n]}_loadMaterialMetallicRoughnessPropertiesAsync(e,t,n){if(!(n instanceof W))throw new Error(`${e}: Material type not supported`);const o=new Array;return t&&(t.baseColorFactor?(n.albedoColor=V.FromArray(t.baseColorFactor),n.alpha=t.baseColorFactor[3]):n.albedoColor=V.White(),n.metallic=t.metallicFactor==null?1:t.metallicFactor,n.roughness=t.roughnessFactor==null?1:t.roughnessFactor,t.baseColorTexture&&o.push(this.loadTextureInfoAsync(`${e}/baseColorTexture`,t.baseColorTexture,s=>{s.name=`${n.name} (Base Color)`,n.albedoTexture=s})),t.metallicRoughnessTexture&&(t.metallicRoughnessTexture.nonColorData=!0,o.push(this.loadTextureInfoAsync(`${e}/metallicRoughnessTexture`,t.metallicRoughnessTexture,s=>{s.name=`${n.name} (Metallic Roughness)`,n.metallicTexture=s})),n.useMetallnessFromMetallicTextureBlue=!0,n.useRoughnessFromMetallicTextureGreen=!0,n.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(o).then(()=>{})}_loadMaterialAsync(e,t,n,o,s=()=>{}){const a=this._extensionsLoadMaterialAsync(e,t,n,o,s);if(a)return a;t._data=t._data||{};let i=t._data[o];if(!i){this.logOpen(`${e} ${t.name||""}`);const l=this.createMaterial(e,t,o);i={babylonMaterial:l,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(e,t,l)},t._data[o]=i,T.AddPointerMetadata(l,e),this._parent.onMaterialLoadedObservable.notifyObservers(l),this.logClose()}return n&&(i.babylonMeshes.push(n),n.onDisposeObservable.addOnce(()=>{const l=i.babylonMeshes.indexOf(n);l!==-1&&i.babylonMeshes.splice(l,1)})),s(i.babylonMaterial),i.promise.then(()=>i.babylonMaterial)}_createDefaultMaterial(e,t){this._babylonScene._blockEntityCollection=!!this._assetContainer;const n=new W(e,this._babylonScene);return n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n.fillMode=t,n.enableSpecularAntiAliasing=!0,n.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,n.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,n.transparencyMode=W.PBRMATERIAL_OPAQUE,n.metallic=1,n.roughness=1,n}createMaterial(e,t,n){const o=this._extensionsCreateMaterial(e,t,n);if(o)return o;const s=t.name||`material${t.index}`;return this._createDefaultMaterial(s,n)}loadMaterialPropertiesAsync(e,t,n){const o=this._extensionsLoadMaterialPropertiesAsync(e,t,n);if(o)return o;const s=new Array;return s.push(this.loadMaterialBasePropertiesAsync(e,t,n)),t.pbrMetallicRoughness&&s.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${e}/pbrMetallicRoughness`,t.pbrMetallicRoughness,n)),this.loadMaterialAlphaProperties(e,t,n),Promise.all(s).then(()=>{})}loadMaterialBasePropertiesAsync(e,t,n){if(!(n instanceof W))throw new Error(`${e}: Material type not supported`);const o=new Array;return n.emissiveColor=t.emissiveFactor?V.FromArray(t.emissiveFactor):new V(0,0,0),t.doubleSided&&(n.backFaceCulling=!1,n.twoSidedLighting=!0),t.normalTexture&&(t.normalTexture.nonColorData=!0,o.push(this.loadTextureInfoAsync(`${e}/normalTexture`,t.normalTexture,s=>{s.name=`${n.name} (Normal)`,n.bumpTexture=s})),n.invertNormalMapX=!this._babylonScene.useRightHandedSystem,n.invertNormalMapY=this._babylonScene.useRightHandedSystem,t.normalTexture.scale!=null&&n.bumpTexture&&(n.bumpTexture.level=t.normalTexture.scale),n.forceIrradianceInFragment=!0),t.occlusionTexture&&(t.occlusionTexture.nonColorData=!0,o.push(this.loadTextureInfoAsync(`${e}/occlusionTexture`,t.occlusionTexture,s=>{s.name=`${n.name} (Occlusion)`,n.ambientTexture=s})),n.useAmbientInGrayScale=!0,t.occlusionTexture.strength!=null&&(n.ambientTextureStrength=t.occlusionTexture.strength)),t.emissiveTexture&&o.push(this.loadTextureInfoAsync(`${e}/emissiveTexture`,t.emissiveTexture,s=>{s.name=`${n.name} (Emissive)`,n.emissiveTexture=s})),Promise.all(o).then(()=>{})}loadMaterialAlphaProperties(e,t,n){if(!(n instanceof W))throw new Error(`${e}: Material type not supported`);switch(t.alphaMode||"OPAQUE"){case"OPAQUE":{n.transparencyMode=W.PBRMATERIAL_OPAQUE,n.alpha=1;break}case"MASK":{n.transparencyMode=W.PBRMATERIAL_ALPHATEST,n.alphaCutOff=t.alphaCutoff==null?.5:t.alphaCutoff,n.albedoTexture&&(n.albedoTexture.hasAlpha=!0);break}case"BLEND":{n.transparencyMode=W.PBRMATERIAL_ALPHABLEND,n.albedoTexture&&(n.albedoTexture.hasAlpha=!0,n.useAlphaFromAlbedoTexture=!0);break}default:throw new Error(`${e}/alphaMode: Invalid value (${t.alphaMode})`)}}loadTextureInfoAsync(e,t,n=()=>{}){const o=this._extensionsLoadTextureInfoAsync(e,t,n);if(o)return o;if(this.logOpen(`${e}`),t.texCoord>=6)throw new Error(`${e}/texCoord: Invalid value (${t.texCoord})`);const s=g.Get(`${e}/index`,this._gltf.textures,t.index);s._textureInfo=t;const a=this._loadTextureAsync(`/textures/${t.index}`,s,i=>{i.coordinatesIndex=t.texCoord||0,T.AddPointerMetadata(i,e),this._parent.onTextureLoadedObservable.notifyObservers(i),n(i)});return this.logClose(),a}_loadTextureAsync(e,t,n=()=>{}){const o=this._extensionsLoadTextureAsync(e,t,n);if(o)return o;this.logOpen(`${e} ${t.name||""}`);const s=t.sampler==null?T.DefaultSampler:g.Get(`${e}/sampler`,this._gltf.samplers,t.sampler),a=g.Get(`${e}/source`,this._gltf.images,t.source),i=this._createTextureAsync(e,s,a,n,void 0,!t._textureInfo.nonColorData);return this.logClose(),i}_createTextureAsync(e,t,n,o=()=>{},s,a){const i=this._loadSampler(`/samplers/${t.index}`,t),l=new Array,c=new He;this._babylonScene._blockEntityCollection=!!this._assetContainer;const u={noMipmap:i.noMipMaps,invertY:!1,samplingMode:i.samplingMode,onLoad:()=>{this._disposed||c.resolve()},onError:(d,p)=>{this._disposed||c.reject(new Error(`${e}: ${p&&p.message?p.message:d||"Failed to load texture"}`))},mimeType:n.mimeType,loaderOptions:s,useSRGBBuffer:!!a&&this._parent.useSRGBBuffers},h=new $(null,this._babylonScene,u);return h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l.push(c.promise),l.push(this.loadImageAsync(`/images/${n.index}`,n).then(d=>{const p=n.uri||`${this._fileName}#image${n.index}`,m=`data:${this._uniqueRootUrl}${p}`;h.updateURL(m,d);const b=h.getInternalTexture();b&&(b.label=n.name)})),h.wrapU=i.wrapU,h.wrapV=i.wrapV,o(h),this._parent.useGltfTextureNames&&(h.name=n.name||n.uri||`image${n.index}`),Promise.all(l).then(()=>h)}_loadSampler(e,t){return t._data||(t._data={noMipMaps:t.minFilter===9728||t.minFilter===9729,samplingMode:T._GetTextureSamplingMode(e,t),wrapU:T._GetTextureWrapMode(`${e}/wrapS`,t.wrapS),wrapV:T._GetTextureWrapMode(`${e}/wrapT`,t.wrapT)}),t._data}loadImageAsync(e,t){if(!t._data){if(this.logOpen(`${e} ${t.name||""}`),t.uri)t._data=this.loadUriAsync(`${e}/uri`,t,t.uri);else{const n=g.Get(`${e}/bufferView`,this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync(`/bufferViews/${n.index}`,n)}this.logClose()}return t._data}loadUriAsync(e,t,n){const o=this._extensionsLoadUriAsync(e,t,n);if(o)return o;if(!T._ValidateUri(n))throw new Error(`${e}: '${n}' is invalid`);if(xr(n)){const s=new Uint8Array(Dn(n));return this.log(`${e}: Decoded ${n.substring(0,64)}... (${s.length} bytes)`),Promise.resolve(s)}return this.log(`${e}: Loading ${n}`),this._parent.preprocessUrlAsync(this._rootUrl+n).then(s=>new Promise((a,i)=>{this._parent._loadFile(this._babylonScene,s,l=>{this._disposed||(this.log(`${e}: Loaded ${n} (${l.byteLength} bytes)`),a(new Uint8Array(l)))},!0,l=>{i(new Er(`${e}: Failed to load '${n}'${l?": "+l.status+" "+l.statusText:""}`,l))})}))}static AddPointerMetadata(e,t){e.metadata=e.metadata||{};const n=e._internalMetadata=e._internalMetadata||{},o=n.gltf=n.gltf||{};(o.pointers=o.pointers||[]).push(t)}static _GetTextureWrapMode(e,t){switch(t=t??10497,t){case 33071:return $.CLAMP_ADDRESSMODE;case 33648:return $.MIRROR_ADDRESSMODE;case 10497:return $.WRAP_ADDRESSMODE;default:return C.Warn(`${e}: Invalid value (${t})`),$.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(e,t){const n=t.magFilter==null?9729:t.magFilter,o=t.minFilter==null?9987:t.minFilter;if(n===9729)switch(o){case 9728:return $.LINEAR_NEAREST;case 9729:return $.LINEAR_LINEAR;case 9984:return $.LINEAR_NEAREST_MIPNEAREST;case 9985:return $.LINEAR_LINEAR_MIPNEAREST;case 9986:return $.LINEAR_NEAREST_MIPLINEAR;case 9987:return $.LINEAR_LINEAR_MIPLINEAR;default:return C.Warn(`${e}/minFilter: Invalid value (${o})`),$.LINEAR_LINEAR_MIPLINEAR}else switch(n!==9728&&C.Warn(`${e}/magFilter: Invalid value (${n})`),o){case 9728:return $.NEAREST_NEAREST;case 9729:return $.NEAREST_LINEAR;case 9984:return $.NEAREST_NEAREST_MIPNEAREST;case 9985:return $.NEAREST_LINEAR_MIPNEAREST;case 9986:return $.NEAREST_NEAREST_MIPLINEAR;case 9987:return $.NEAREST_LINEAR_MIPLINEAR;default:return C.Warn(`${e}/minFilter: Invalid value (${o})`),$.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(e,t){try{return vr(t)}catch(n){throw new Error(`${e}: ${n.message}`)}}static _GetTypedArray(e,t,n,o,s){const a=n.buffer;o=n.byteOffset+(o||0);const i=T._GetTypedArrayConstructor(`${e}/componentType`,t),l=N.GetTypeByteLength(t);return o%l!==0?(C.Warn(`${e}: Copying buffer as byte offset (${o}) is not a multiple of component type byte length (${l})`),new i(a.slice(o,o+s*l),0)):new i(a,o,s)}static _GetNumComponents(e,t){switch(t){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":return 4;case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${e}: Invalid type (${t})`)}static _ValidateUri(e){return M.IsBase64(e)||e.indexOf("..")===-1}static _GetDrawMode(e,t){switch(t==null&&(t=4),t){case 0:return _e.PointListDrawMode;case 1:return _e.LineListDrawMode;case 2:return _e.LineLoopDrawMode;case 3:return _e.LineStripDrawMode;case 4:return _e.TriangleFillMode;case 5:return _e.TriangleStripDrawMode;case 6:return _e.TriangleFanDrawMode}throw new Error(`${e}: Invalid mesh primitive mode (${t})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const e=new Array;if(this._gltf.materials){for(const t of this._gltf.materials)if(t._data)for(const n in t._data){const o=t._data[n];for(const s of o.babylonMeshes){s.computeWorldMatrix(!0);const a=o.babylonMaterial;e.push(a.forceCompilationAsync(s)),e.push(a.forceCompilationAsync(s,{useInstances:!0})),this._parent.useClipPlane&&(e.push(a.forceCompilationAsync(s,{clipPlane:!0})),e.push(a.forceCompilationAsync(s,{clipPlane:!0,useInstances:!0})))}}}return Promise.all(e).then(()=>{this._parent._endPerformanceCounter("Compile materials")})}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const e=new Array,t=this._babylonScene.lights;for(const n of t){const o=n.getShadowGenerator();o&&e.push(o.forceCompilationAsync())}return Promise.all(e).then(()=>{this._parent._endPerformanceCounter("Compile shadow generators")})}_forEachExtensions(e){for(const t of this._extensions)t.enabled&&e(t)}_applyExtensions(e,t,n){for(const o of this._extensions)if(o.enabled){const s=`${o.name}.${t}`,a=e;a._activeLoaderExtensionFunctions=a._activeLoaderExtensionFunctions||{};const i=a._activeLoaderExtensionFunctions;if(!i[s]){i[s]=!0;try{const l=n(o);if(l)return l}finally{delete i[s]}}}return null}_extensionsOnLoading(){this._forEachExtensions(e=>e.onLoading&&e.onLoading())}_extensionsOnReady(){this._forEachExtensions(e=>e.onReady&&e.onReady())}_extensionsLoadSceneAsync(e,t){return this._applyExtensions(t,"loadScene",n=>n.loadSceneAsync&&n.loadSceneAsync(e,t))}_extensionsLoadNodeAsync(e,t,n){return this._applyExtensions(t,"loadNode",o=>o.loadNodeAsync&&o.loadNodeAsync(e,t,n))}_extensionsLoadCameraAsync(e,t,n){return this._applyExtensions(t,"loadCamera",o=>o.loadCameraAsync&&o.loadCameraAsync(e,t,n))}_extensionsLoadVertexDataAsync(e,t,n){return this._applyExtensions(t,"loadVertexData",o=>o._loadVertexDataAsync&&o._loadVertexDataAsync(e,t,n))}_extensionsLoadMeshPrimitiveAsync(e,t,n,o,s,a){return this._applyExtensions(s,"loadMeshPrimitive",i=>i._loadMeshPrimitiveAsync&&i._loadMeshPrimitiveAsync(e,t,n,o,s,a))}_extensionsLoadMaterialAsync(e,t,n,o,s){return this._applyExtensions(t,"loadMaterial",a=>a._loadMaterialAsync&&a._loadMaterialAsync(e,t,n,o,s))}_extensionsCreateMaterial(e,t,n){return this._applyExtensions(t,"createMaterial",o=>o.createMaterial&&o.createMaterial(e,t,n))}_extensionsLoadMaterialPropertiesAsync(e,t,n){return this._applyExtensions(t,"loadMaterialProperties",o=>o.loadMaterialPropertiesAsync&&o.loadMaterialPropertiesAsync(e,t,n))}_extensionsLoadTextureInfoAsync(e,t,n){return this._applyExtensions(t,"loadTextureInfo",o=>o.loadTextureInfoAsync&&o.loadTextureInfoAsync(e,t,n))}_extensionsLoadTextureAsync(e,t,n){return this._applyExtensions(t,"loadTexture",o=>o._loadTextureAsync&&o._loadTextureAsync(e,t,n))}_extensionsLoadAnimationAsync(e,t){return this._applyExtensions(t,"loadAnimation",n=>n.loadAnimationAsync&&n.loadAnimationAsync(e,t))}_extensionsLoadAnimationChannelAsync(e,t,n,o,s){return this._applyExtensions(n,"loadAnimationChannel",a=>a._loadAnimationChannelAsync&&a._loadAnimationChannelAsync(e,t,n,o,s))}_extensionsLoadSkinAsync(e,t,n){return this._applyExtensions(n,"loadSkin",o=>o._loadSkinAsync&&o._loadSkinAsync(e,t,n))}_extensionsLoadUriAsync(e,t,n){return this._applyExtensions(t,"loadUri",o=>o._loadUriAsync&&o._loadUriAsync(e,t,n))}_extensionsLoadBufferViewAsync(e,t){return this._applyExtensions(t,"loadBufferView",n=>n.loadBufferViewAsync&&n.loadBufferViewAsync(e,t))}_extensionsLoadBufferAsync(e,t,n,o){return this._applyExtensions(t,"loadBuffer",s=>s.loadBufferAsync&&s.loadBufferAsync(e,t,n,o))}static LoadExtensionAsync(e,t,n,o){if(!t.extensions)return null;const a=t.extensions[n];return a?o(`${e}/extensions/${n}`,a):null}static LoadExtraAsync(e,t,n,o){if(!t.extras)return null;const a=t.extras[n];return a?o(`${e}/extras/${n}`,a):null}isExtensionUsed(e){return!!this._gltf.extensionsUsed&&this._gltf.extensionsUsed.indexOf(e)!==-1}logOpen(e){this._parent._logOpen(e)}logClose(){this._parent._logClose()}log(e){this._parent._log(e)}startPerformanceCounter(e){this._parent._startPerformanceCounter(e)}endPerformanceCounter(e){this._parent._endPerformanceCounter(e)}}T.DefaultSampler={index:-1};Q._CreateGLTF2Loader=r=>new T(r);function tn(r,e,t,n){return G.FromArray(e,t).scaleInPlace(n)}function er(r,e,t,n){return j.FromArray(e,t).scaleInPlace(n)}function tr(r,e,t,n){const o=new Array(r._numMorphTargets);for(let s=0;s<o.length;s++)o[s]=e[t++]*n;return o}class Re{constructor(e,t,n,o){this.type=e,this.name=t,this.getValue=n,this.getStride=o}_buildAnimation(e,t,n){const o=new x(e,this.name,t,this.type);return o.setKeys(n),o}}class Nt extends Re{buildAnimations(e,t,n,o){const s=[];return s.push({babylonAnimatable:e._babylonTransformNode,babylonAnimation:this._buildAnimation(t,n,o)}),s}}class nr extends Re{buildAnimations(e,t,n,o){const s=[];if(e._numMorphTargets)for(let a=0;a<e._numMorphTargets;a++){const i=new x(`${t}_${a}`,this.name,n,this.type);if(i.setKeys(o.map(l=>({frame:l.frame,inTangent:l.inTangent?l.inTangent[a]:void 0,value:l.value[a],outTangent:l.outTangent?l.outTangent[a]:void 0,interpolation:l.interpolation}))),e._primitiveBabylonMeshes){for(const l of e._primitiveBabylonMeshes)if(l.morphTargetManager){const c=l.morphTargetManager.getTarget(a),u=i.clone();c.animations.push(u),s.push({babylonAnimatable:c,babylonAnimation:u})}}}return s}}f("/nodes/{}/translation",[new Nt(x.ANIMATIONTYPE_VECTOR3,"position",tn,()=>3)]);f("/nodes/{}/rotation",[new Nt(x.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",er,()=>4)]);f("/nodes/{}/scale",[new Nt(x.ANIMATIONTYPE_VECTOR3,"scaling",tn,()=>3)]);f("/nodes/{}/weights",[new nr(x.ANIMATIONTYPE_FLOAT,"influence",tr,r=>r._numMorphTargets)]);const bo=Object.freeze(Object.defineProperty({__proto__:null,AnimationPropertyInfo:Re,TransformNodeAnimationPropertyInfo:Nt,WeightAnimationPropertyInfo:nr,getQuaternion:er,getVector3:tn,getWeights:tr},Symbol.toStringTag,{value:"Module"})),nt="EXT_lights_image_based";class Ao{constructor(e){this.name=nt,this._loader=e,this.enabled=this._loader.isExtensionUsed(nt)}dispose(){this._loader=null,delete this._lights}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._lights=t.lights}}loadSceneAsync(e,t){return T.LoadExtensionAsync(e,t,this.name,(n,o)=>{this._loader._allMaterialsDirtyRequired=!0;const s=new Array;s.push(this._loader.loadSceneAsync(e,t)),this._loader.logOpen(`${n}`);const a=g.Get(`${n}/light`,this._lights,o.light);return s.push(this._loadLightAsync(`/extensions/${this.name}/lights/${o.light}`,a).then(i=>{this._loader.babylonScene.environmentTexture=i})),this._loader.logClose(),Promise.all(s).then(()=>{})})}_loadLightAsync(e,t){if(!t._loaded){const n=new Array;this._loader.logOpen(`${e}`);const o=new Array(t.specularImages.length);for(let s=0;s<t.specularImages.length;s++){const a=t.specularImages[s];o[s]=new Array(a.length);for(let i=0;i<a.length;i++){const l=`${e}/specularImages/${s}/${i}`;this._loader.logOpen(`${l}`);const c=a[i],u=g.Get(l,this._loader.gltf.images,c);n.push(this._loader.loadImageAsync(`/images/${c}`,u).then(h=>{o[s][i]=h})),this._loader.logClose()}}this._loader.logClose(),t._loaded=Promise.all(n).then(()=>{const s=new jt(this._loader.babylonScene,null,t.specularImageSize);if(s.name=t.name||"environment",t._babylonTexture=s,t.intensity!=null&&(s.level=t.intensity),t.rotation){let c=j.FromArray(t.rotation);this._loader.babylonScene.useRightHandedSystem||(c=j.Inverse(c)),ee.FromQuaternionToRef(c,s.getReflectionTextureMatrix())}if(!t.irradianceCoefficients)throw new Error(`${e}: Irradiance coefficients are missing`);const a=Br.FromArray(t.irradianceCoefficients);a.scaleInPlace(t.intensity),a.convertIrradianceToLambertianRadiance();const i=Ir.FromHarmonics(a),l=(o.length-1)/Math.log2(t.specularImageSize);return s.updateRGBDAsync(o,i,l)})}return t._loaded.then(()=>t._babylonTexture)}}L(nt);S(nt,!0,r=>new Ao(r));const rt="EXT_mesh_gpu_instancing";class To{constructor(e){this.name=rt,this._loader=e,this.enabled=this._loader.isExtensionUsed(rt)}dispose(){this._loader=null}loadNodeAsync(e,t,n){return T.LoadExtensionAsync(e,t,this.name,(o,s)=>{this._loader._disableInstancedMesh++;const a=this._loader.loadNodeAsync(`/nodes/${t.index}`,t,n);if(this._loader._disableInstancedMesh--,!t._primitiveBabylonMeshes)return a;const i=new Array;let l=0;const c=u=>{if(s.attributes[u]==null){i.push(Promise.resolve(null));return}const h=g.Get(`${o}/attributes/${u}`,this._loader.gltf.accessors,s.attributes[u]);if(i.push(this._loader._loadFloatAccessorAsync(`/accessors/${h.bufferView}`,h)),l===0)l=h.count;else if(l!==h.count)throw new Error(`${o}/attributes: Instance buffer accessors do not have the same count.`)};return c("TRANSLATION"),c("ROTATION"),c("SCALE"),a.then(u=>Promise.all(i).then(([h,d,p])=>{const m=new Float32Array(l*16);he.Vector3[0].copyFromFloats(0,0,0),he.Quaternion[0].copyFromFloats(0,0,0,1),he.Vector3[1].copyFromFloats(1,1,1);for(let b=0;b<l;++b)h&&G.FromArrayToRef(h,b*3,he.Vector3[0]),d&&j.FromArrayToRef(d,b*4,he.Quaternion[0]),p&&G.FromArrayToRef(p,b*3,he.Vector3[1]),ee.ComposeToRef(he.Vector3[1],he.Quaternion[0],he.Vector3[0],he.Matrix[0]),he.Matrix[0].copyToArray(m,b*16);for(const b of t._primitiveBabylonMeshes)b.thinInstanceSetBuffer("matrix",m,16,!0);return u}))})}}L(rt);S(rt,!0,r=>new To(r));const ot="EXT_meshopt_compression";class xo{constructor(e){this.name=ot,this.enabled=e.isExtensionUsed(ot),this._loader=e}dispose(){this._loader=null}loadBufferViewAsync(e,t){return T.LoadExtensionAsync(e,t,this.name,(n,o)=>{const s=t;if(s._meshOptData)return s._meshOptData;const a=g.Get(`${e}/buffer`,this._loader.gltf.buffers,o.buffer);return s._meshOptData=this._loader.loadBufferAsync(`/buffers/${a.index}`,a,o.byteOffset||0,o.byteLength).then(i=>Fr.Default.decodeGltfBufferAsync(i,o.count,o.byteStride,o.mode,o.filter)),s._meshOptData})}}L(ot);S(ot,!0,r=>new xo(r));const st="EXT_texture_webp";class Eo{constructor(e){this.name=st,this._loader=e,this.enabled=e.isExtensionUsed(st)}dispose(){this._loader=null}_loadTextureAsync(e,t,n){return T.LoadExtensionAsync(e,t,this.name,(o,s)=>{const a=t.sampler==null?T.DefaultSampler:g.Get(`${e}/sampler`,this._loader.gltf.samplers,t.sampler),i=g.Get(`${o}/source`,this._loader.gltf.images,s.source);return this._loader._createTextureAsync(e,a,i,l=>{n(l)},void 0,!t._textureInfo.nonColorData)})}}L(st);S(st,!0,r=>new Eo(r));const at="EXT_texture_avif";class vo{constructor(e){this.name=at,this._loader=e,this.enabled=e.isExtensionUsed(at)}dispose(){this._loader=null}_loadTextureAsync(e,t,n){return T.LoadExtensionAsync(e,t,this.name,(o,s)=>{const a=t.sampler==null?T.DefaultSampler:g.Get(`${e}/sampler`,this._loader.gltf.samplers,t.sampler),i=g.Get(`${o}/source`,this._loader.gltf.images,s.source);return this._loader._createTextureAsync(e,a,i,l=>{n(l)},void 0,!t._textureInfo.nonColorData)})}}L(at);S(at,!0,r=>new vo(r));const it="EXT_lights_ies";class ko{constructor(e){this.name=it,this._loader=e,this.enabled=this._loader.isExtensionUsed(it)}dispose(){this._loader=null,delete this._lights}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._lights=t.lights,g.Assign(this._lights)}}loadNodeAsync(e,t,n){return T.LoadExtensionAsync(e,t,this.name,async(o,s)=>{this._loader._allMaterialsDirtyRequired=!0;let a,i;const l=await this._loader.loadNodeAsync(e,t,u=>{i=g.Get(o,this._lights,s.light);const h=i.name||u.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,a=new ye(h,G.Zero(),G.Backward(),0,1,this._loader.babylonScene),a.angle=Math.PI/2,a.innerAngle=0,a._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,i._babylonLight=a,a.falloffType=Yn.FALLOFF_GLTF,a.diffuse=s.color?V.FromArray(s.color):V.White(),a.intensity=s.multiplier||1,a.range=Number.MAX_VALUE,a.parent=u,this._loader._babylonLights.push(a),T.AddPointerMetadata(a,o),n(u)});let c;if(i.uri)c=await this._loader.loadUriAsync(e,i,i.uri);else{const u=g.Get(`${e}/bufferView`,this._loader.gltf.bufferViews,i.bufferView);c=await this._loader.loadBufferViewAsync(`/bufferViews/${u.index}`,u)}return a.iesProfileTexture=new $(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,c,!0,void 0,void 0,void 0,void 0,".ies"),l})}}L(it);S(it,!0,r=>new ko(r));const lt="KHR_draco_mesh_compression";class Bo{constructor(e){this.name=lt,this.useNormalizedFlagFromAccessor=!0,this._loader=e,this.enabled=Bn.DefaultAvailable&&this._loader.isExtensionUsed(lt)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(e,t,n){return T.LoadExtensionAsync(e,t,this.name,(o,s)=>{if(t.mode!=null&&t.mode!==4&&t.mode!==5)throw new Error(`${e}: Unsupported mode ${t.mode}`);const a={},i={},l=(u,h)=>{const d=s.attributes[u];if(d!=null&&(n._delayInfo=n._delayInfo||[],n._delayInfo.indexOf(h)===-1&&n._delayInfo.push(h),a[h]=d,this.useNormalizedFlagFromAccessor)){const p=g.TryGet(this._loader.gltf.accessors,t.attributes[u]);p&&(i[h]=p.normalized||!1)}};l("POSITION",N.PositionKind),l("NORMAL",N.NormalKind),l("TANGENT",N.TangentKind),l("TEXCOORD_0",N.UVKind),l("TEXCOORD_1",N.UV2Kind),l("TEXCOORD_2",N.UV3Kind),l("TEXCOORD_3",N.UV4Kind),l("TEXCOORD_4",N.UV5Kind),l("TEXCOORD_5",N.UV6Kind),l("JOINTS_0",N.MatricesIndicesKind),l("WEIGHTS_0",N.MatricesWeightsKind),l("COLOR_0",N.ColorKind);const c=g.Get(o,this._loader.gltf.bufferViews,s.bufferView);return c._dracoBabylonGeometry||(c._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${c.index}`,c).then(u=>{const h=this.dracoDecoder||Bn.Default,d=g.TryGet(this._loader.gltf.accessors,t.attributes.POSITION),p=!this._loader.parent.alwaysComputeBoundingBox&&!n.skeleton&&d?zn(d):null;return h._decodeMeshToGeometryForGltfAsync(n.name,this._loader.babylonScene,u,a,i,p).catch(m=>{throw new Error(`${e}: ${m.message}`)})})),c._dracoBabylonGeometry})}}L(lt);S(lt,!0,r=>new Bo(r));const ct="KHR_lights_punctual";class Io{constructor(e){this.name=ct,this._loader=e,this.enabled=this._loader.isExtensionUsed(ct)}dispose(){this._loader=null,delete this._lights}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._lights=t.lights,g.Assign(this._lights)}}loadNodeAsync(e,t,n){return T.LoadExtensionAsync(e,t,this.name,(o,s)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(e,t,a=>{let i;const l=g.Get(o,this._lights,s.light),c=l.name||a.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,l.type){case"directional":{const u=new Jt(c,G.Backward(),this._loader.babylonScene);u.position.setAll(0),i=u;break}case"point":{i=new Zt(c,G.Zero(),this._loader.babylonScene);break}case"spot":{const u=new ye(c,G.Zero(),G.Backward(),0,1,this._loader.babylonScene);u.angle=(l.spot&&l.spot.outerConeAngle||Math.PI/4)*2,u.innerAngle=(l.spot&&l.spot.innerConeAngle||0)*2,i=u;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${o}: Invalid light type (${l.type})`)}i._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,l._babylonLight=i,i.falloffType=Yn.FALLOFF_GLTF,i.diffuse=l.color?V.FromArray(l.color):V.White(),i.intensity=l.intensity==null?1:l.intensity,i.range=l.range==null?Number.MAX_VALUE:l.range,i.parent=a,this._loader._babylonLights.push(i),T.AddPointerMetadata(i,o),n(a)})))}}L(ct);S(ct,!0,r=>new Io(r));const ut="KHR_materials_pbrSpecularGlossiness";class Fo{constructor(e){this.name=ut,this.order=200,this._loader=e,this.enabled=this._loader.isExtensionUsed(ut)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return T.LoadExtensionAsync(e,t,this.name,(o,s)=>{const a=new Array;return a.push(this._loader.loadMaterialBasePropertiesAsync(e,t,n)),a.push(this._loadSpecularGlossinessPropertiesAsync(o,s,n)),this._loader.loadMaterialAlphaProperties(e,t,n),Promise.all(a).then(()=>{})})}_loadSpecularGlossinessPropertiesAsync(e,t,n){if(!(n instanceof W))throw new Error(`${e}: Material type not supported`);const o=new Array;return n.metallic=null,n.roughness=null,t.diffuseFactor?(n.albedoColor=V.FromArray(t.diffuseFactor),n.alpha=t.diffuseFactor[3]):n.albedoColor=V.White(),n.reflectivityColor=t.specularFactor?V.FromArray(t.specularFactor):V.White(),n.microSurface=t.glossinessFactor==null?1:t.glossinessFactor,t.diffuseTexture&&o.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTexture`,t.diffuseTexture,s=>{s.name=`${n.name} (Diffuse)`,n.albedoTexture=s})),t.specularGlossinessTexture&&(o.push(this._loader.loadTextureInfoAsync(`${e}/specularGlossinessTexture`,t.specularGlossinessTexture,s=>{s.name=`${n.name} (Specular Glossiness)`,n.reflectivityTexture=s,n.reflectivityTexture.hasAlpha=!0})),n.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(o).then(()=>{})}}L(ut);S(ut,!0,r=>new Fo(r));const ht="KHR_materials_unlit";class Oo{constructor(e){this.name=ht,this.order=210,this._loader=e,this.enabled=this._loader.isExtensionUsed(ht)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return T.LoadExtensionAsync(e,t,this.name,()=>this._loadUnlitPropertiesAsync(e,t,n))}_loadUnlitPropertiesAsync(e,t,n){if(!(n instanceof W))throw new Error(`${e}: Material type not supported`);const o=new Array;n.unlit=!0;const s=t.pbrMetallicRoughness;return s&&(s.baseColorFactor?(n.albedoColor=V.FromArray(s.baseColorFactor),n.alpha=s.baseColorFactor[3]):n.albedoColor=V.White(),s.baseColorTexture&&o.push(this._loader.loadTextureInfoAsync(`${e}/baseColorTexture`,s.baseColorTexture,a=>{a.name=`${n.name} (Base Color)`,n.albedoTexture=a}))),t.doubleSided&&(n.backFaceCulling=!1,n.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(e,t,n),Promise.all(o).then(()=>{})}}L(ht);S(ht,!0,r=>new Oo(r));const dt="KHR_materials_clearcoat";class Co{constructor(e){this.name=dt,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(dt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return T.LoadExtensionAsync(e,t,this.name,(o,s)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(this._loadClearCoatPropertiesAsync(o,s,n)),Promise.all(a).then(()=>{})})}_loadClearCoatPropertiesAsync(e,t,n){if(!(n instanceof W))throw new Error(`${e}: Material type not supported`);const o=new Array;return n.clearCoat.isEnabled=!0,n.clearCoat.useRoughnessFromMainTexture=!1,n.clearCoat.remapF0OnInterfaceChange=!1,t.clearcoatFactor!=null?n.clearCoat.intensity=t.clearcoatFactor:n.clearCoat.intensity=0,t.clearcoatTexture&&o.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatTexture`,t.clearcoatTexture,s=>{s.name=`${n.name} (ClearCoat)`,n.clearCoat.texture=s})),t.clearcoatRoughnessFactor!=null?n.clearCoat.roughness=t.clearcoatRoughnessFactor:n.clearCoat.roughness=0,t.clearcoatRoughnessTexture&&(t.clearcoatRoughnessTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatRoughnessTexture`,t.clearcoatRoughnessTexture,s=>{s.name=`${n.name} (ClearCoat Roughness)`,n.clearCoat.textureRoughness=s}))),t.clearcoatNormalTexture&&(t.clearcoatNormalTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatNormalTexture`,t.clearcoatNormalTexture,s=>{s.name=`${n.name} (ClearCoat Normal)`,n.clearCoat.bumpTexture=s})),n.invertNormalMapX=!n.getScene().useRightHandedSystem,n.invertNormalMapY=n.getScene().useRightHandedSystem,t.clearcoatNormalTexture.scale!=null&&(n.clearCoat.bumpTexture.level=t.clearcoatNormalTexture.scale)),Promise.all(o).then(()=>{})}}L(dt);S(dt,!0,r=>new Co(r));const _t="KHR_materials_iridescence";class Go{constructor(e){this.name=_t,this.order=195,this._loader=e,this.enabled=this._loader.isExtensionUsed(_t)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return T.LoadExtensionAsync(e,t,this.name,(o,s)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(this._loadIridescencePropertiesAsync(o,s,n)),Promise.all(a).then(()=>{})})}_loadIridescencePropertiesAsync(e,t,n){if(!(n instanceof W))throw new Error(`${e}: Material type not supported`);const o=new Array;return n.iridescence.isEnabled=!0,n.iridescence.intensity=t.iridescenceFactor??0,n.iridescence.indexOfRefraction=t.iridescenceIor??t.iridescenceIOR??1.3,n.iridescence.minimumThickness=t.iridescenceThicknessMinimum??100,n.iridescence.maximumThickness=t.iridescenceThicknessMaximum??400,t.iridescenceTexture&&o.push(this._loader.loadTextureInfoAsync(`${e}/iridescenceTexture`,t.iridescenceTexture,s=>{s.name=`${n.name} (Iridescence)`,n.iridescence.texture=s})),t.iridescenceThicknessTexture&&o.push(this._loader.loadTextureInfoAsync(`${e}/iridescenceThicknessTexture`,t.iridescenceThicknessTexture,s=>{s.name=`${n.name} (Iridescence Thickness)`,n.iridescence.thicknessTexture=s})),Promise.all(o).then(()=>{})}}L(_t);S(_t,!0,r=>new Go(r));const pt="KHR_materials_anisotropy";class Po{constructor(e){this.name=pt,this.order=195,this._loader=e,this.enabled=this._loader.isExtensionUsed(pt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return T.LoadExtensionAsync(e,t,this.name,(o,s)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(this._loadIridescencePropertiesAsync(o,s,n)),Promise.all(a).then(()=>{})})}_loadIridescencePropertiesAsync(e,t,n){if(!(n instanceof W))throw new Error(`${e}: Material type not supported`);const o=new Array;return n.anisotropy.isEnabled=!0,n.anisotropy.intensity=t.anisotropyStrength??0,n.anisotropy.angle=t.anisotropyRotation??0,t.anisotropyTexture&&(t.anisotropyTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${e}/anisotropyTexture`,t.anisotropyTexture,s=>{s.name=`${n.name} (Anisotropy Intensity)`,n.anisotropy.texture=s}))),Promise.all(o).then(()=>{})}}L(pt);S(pt,!0,r=>new Po(r));const ft="KHR_materials_emissive_strength";class No{constructor(e){this.name=ft,this.order=170,this._loader=e,this.enabled=this._loader.isExtensionUsed(ft)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return T.LoadExtensionAsync(e,t,this.name,(o,s)=>this._loader.loadMaterialPropertiesAsync(e,t,n).then(()=>{this._loadEmissiveProperties(o,s,n)}))}_loadEmissiveProperties(e,t,n){if(!(n instanceof W))throw new Error(`${e}: Material type not supported`);t.emissiveStrength!==void 0&&(n.emissiveIntensity=t.emissiveStrength)}}L(ft);S(ft,!0,r=>new No(r));const mt="KHR_materials_sheen";class Lo{constructor(e){this.name=mt,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(mt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return T.LoadExtensionAsync(e,t,this.name,(o,s)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(this._loadSheenPropertiesAsync(o,s,n)),Promise.all(a).then(()=>{})})}_loadSheenPropertiesAsync(e,t,n){if(!(n instanceof W))throw new Error(`${e}: Material type not supported`);const o=new Array;return n.sheen.isEnabled=!0,n.sheen.intensity=1,t.sheenColorFactor!=null?n.sheen.color=V.FromArray(t.sheenColorFactor):n.sheen.color=V.Black(),t.sheenColorTexture&&o.push(this._loader.loadTextureInfoAsync(`${e}/sheenColorTexture`,t.sheenColorTexture,s=>{s.name=`${n.name} (Sheen Color)`,n.sheen.texture=s})),t.sheenRoughnessFactor!==void 0?n.sheen.roughness=t.sheenRoughnessFactor:n.sheen.roughness=0,t.sheenRoughnessTexture&&(t.sheenRoughnessTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${e}/sheenRoughnessTexture`,t.sheenRoughnessTexture,s=>{s.name=`${n.name} (Sheen Roughness)`,n.sheen.textureRoughness=s}))),n.sheen.albedoScaling=!0,n.sheen.useRoughnessFromMainTexture=!1,Promise.all(o).then(()=>{})}}L(mt);S(mt,!0,r=>new Lo(r));const yt="KHR_materials_specular";class So{constructor(e){this.name=yt,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(yt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return T.LoadExtensionAsync(e,t,this.name,(o,s)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(this._loadSpecularPropertiesAsync(o,s,n)),Promise.all(a).then(()=>{})})}_loadSpecularPropertiesAsync(e,t,n){if(!(n instanceof W))throw new Error(`${e}: Material type not supported`);const o=new Array;return t.specularFactor!==void 0&&(n.metallicF0Factor=t.specularFactor),t.specularColorFactor!==void 0&&(n.metallicReflectanceColor=V.FromArray(t.specularColorFactor)),t.specularTexture&&(t.specularTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${e}/specularTexture`,t.specularTexture,s=>{s.name=`${n.name} (Specular)`,n.metallicReflectanceTexture=s,n.useOnlyMetallicFromMetallicReflectanceTexture=!0}))),t.specularColorTexture&&o.push(this._loader.loadTextureInfoAsync(`${e}/specularColorTexture`,t.specularColorTexture,s=>{s.name=`${n.name} (Specular Color)`,n.reflectanceTexture=s})),Promise.all(o).then(()=>{})}}L(yt);S(yt,!0,r=>new So(r));const gt="KHR_materials_ior";class Lt{constructor(e){this.name=gt,this.order=180,this._loader=e,this.enabled=this._loader.isExtensionUsed(gt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return T.LoadExtensionAsync(e,t,this.name,(o,s)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(this._loadIorPropertiesAsync(o,s,n)),Promise.all(a).then(()=>{})})}_loadIorPropertiesAsync(e,t,n){if(!(n instanceof W))throw new Error(`${e}: Material type not supported`);return t.ior!==void 0?n.indexOfRefraction=t.ior:n.indexOfRefraction=Lt._DEFAULT_IOR,Promise.resolve()}}Lt._DEFAULT_IOR=1.5;L(gt);S(gt,!0,r=>new Lt(r));const ne="KHR_materials_variants";class de{constructor(e){this.name=ne,this._loader=e,this.enabled=this._loader.isExtensionUsed(ne)}dispose(){this._loader=null}static GetAvailableVariants(e){const t=this._GetExtensionMetadata(e);return t?Object.keys(t.variants):[]}getAvailableVariants(e){return de.GetAvailableVariants(e)}static SelectVariant(e,t){const n=this._GetExtensionMetadata(e);if(!n)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${ne} extension`);const o=s=>{const a=n.variants[s];if(a)for(const i of a)i.mesh.material=i.material};if(t instanceof Array)for(const s of t)o(s);else o(t);n.lastSelected=t}selectVariant(e,t){de.SelectVariant(e,t)}static Reset(e){const t=this._GetExtensionMetadata(e);if(!t)throw new Error(`Cannot reset on a glTF mesh that does not have the ${ne} extension`);for(const n of t.original)n.mesh.material=n.material;t.lastSelected=null}reset(e){de.Reset(e)}static GetLastSelectedVariant(e){const t=this._GetExtensionMetadata(e);if(!t)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${ne} extension`);return t.lastSelected}getLastSelectedVariant(e){return de.GetLastSelectedVariant(e)}static _GetExtensionMetadata(e){var t,n;return((n=(t=e==null?void 0:e._internalMetadata)==null?void 0:t.gltf)==null?void 0:n[ne])||null}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._variants=t.variants}}onReady(){var t;const e=this._loader.rootBabylonMesh;if(e){const n=this._loader.parent.extensionOptions[ne];n!=null&&n.defaultVariant&&de.SelectVariant(e,n.defaultVariant),(t=n==null?void 0:n.onLoaded)==null||t.call(n,{get variants(){return de.GetAvailableVariants(e)},get selectedVariant(){const o=de.GetLastSelectedVariant(e);return o?Array.isArray(o)?o[0]:o:de.GetAvailableVariants(e)[0]},set selectedVariant(o){de.SelectVariant(e,o)}})}}_loadMeshPrimitiveAsync(e,t,n,o,s,a){return T.LoadExtensionAsync(e,s,this.name,(i,l)=>{const c=new Array;return c.push(this._loader._loadMeshPrimitiveAsync(e,t,n,o,s,u=>{if(a(u),u instanceof Ne){const h=T._GetDrawMode(e,s.mode),d=this._loader.rootBabylonMesh,p=d?d._internalMetadata=d._internalMetadata||{}:{},m=p.gltf=p.gltf||{},b=m[ne]=m[ne]||{lastSelected:null,original:[],variants:{}};b.original.push({mesh:u,material:u.material});for(let A=0;A<l.mappings.length;++A){const E=l.mappings[A],I=g.Get(`${i}/mappings/${A}/material`,this._loader.gltf.materials,E.material);c.push(this._loader._loadMaterialAsync(`#/materials/${E.material}`,I,u,h,P=>{for(let O=0;O<E.variants.length;++O){const k=E.variants[O],B=g.Get(`/extensions/${ne}/variants/${k}`,this._variants,k);b.variants[B.name]=b.variants[B.name]||[],b.variants[B.name].push({mesh:u,material:P}),u.onClonedObservable.add(v=>{const F=v;let H=null,K=F;do{if(K=K.parent,!K)return;H=de._GetExtensionMetadata(K)}while(H===null);if(d&&H===de._GetExtensionMetadata(d)){K._internalMetadata={};for(const q in d._internalMetadata)K._internalMetadata[q]=d._internalMetadata[q];K._internalMetadata.gltf=[];for(const q in d._internalMetadata.gltf)K._internalMetadata.gltf[q]=d._internalMetadata.gltf[q];K._internalMetadata.gltf[ne]={lastSelected:null,original:[],variants:{}};for(const q of H.original)K._internalMetadata.gltf[ne].original.push({mesh:q.mesh,material:q.material});for(const q in H.variants)if(Object.prototype.hasOwnProperty.call(H.variants,q)){K._internalMetadata.gltf[ne].variants[q]=[];for(const Qe of H.variants[q])K._internalMetadata.gltf[ne].variants[q].push({mesh:Qe.mesh,material:Qe.material})}H=K._internalMetadata.gltf[ne]}for(const q of H.original)q.mesh===u&&(q.mesh=F);for(const q of H.variants[B.name])q.mesh===u&&(q.mesh=F)})}}))}}})),Promise.all(c).then(([u])=>u)})}}L(ne);S(ne,!0,r=>new de(r));class nn{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Te.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(e,t){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...nn._GetDefaultOptions(),...e},this._scene=t,this._scene._transmissionHelper=this,this.onErrorObservable=new oe,this._scene.onDisposeObservable.addOnce(()=>{this.dispose()}),this._parseScene(),this._setupRenderTargets()}updateOptions(e){if(!Object.keys(e).filter(s=>this._options[s]!==e[s]).length)return;const n={...this._options,...e},o=this._options;this._options=n,n.renderSize!==o.renderSize||n.renderTargetTextureType!==o.renderTargetTextureType||n.generateMipmaps!==o.generateMipmaps||!this._opaqueRenderTarget?this._setupRenderTargets():(this._opaqueRenderTarget.samples=n.samples,this._opaqueRenderTarget.lodGenerationScale=n.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=n.lodGenerationOffset)}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(e){return e?!!(e instanceof W&&e.subSurface.isRefractionEnabled):!1}_addMesh(e){this._materialObservers[e.uniqueId]=e.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),M.SetImmediate(()=>{this._shouldRenderAsTransmission(e.material)?(e.material.refractionTexture=this._opaqueRenderTarget,this._transparentMeshesCache.indexOf(e)===-1&&this._transparentMeshesCache.push(e)):this._opaqueMeshesCache.indexOf(e)===-1&&this._opaqueMeshesCache.push(e)})}_removeMesh(e){e.onMaterialChangedObservable.remove(this._materialObservers[e.uniqueId]),delete this._materialObservers[e.uniqueId];let t=this._transparentMeshesCache.indexOf(e);t!==-1&&this._transparentMeshesCache.splice(t,1),t=this._opaqueMeshesCache.indexOf(e),t!==-1&&this._opaqueMeshesCache.splice(t,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(e){const t=this._transparentMeshesCache.indexOf(e),n=this._opaqueMeshesCache.indexOf(e);this._shouldRenderAsTransmission(e.material)?(e.material instanceof W&&(e.material.subSurface.refractionTexture=this._opaqueRenderTarget),n!==-1?(this._opaqueMeshesCache.splice(n,1),this._transparentMeshesCache.push(e)):t===-1&&this._transparentMeshesCache.push(e)):t!==-1?(this._transparentMeshesCache.splice(t,1),this._opaqueMeshesCache.push(e)):n===-1&&this._opaqueMeshesCache.push(e)}_isRenderTargetValid(){var e;return((e=this._opaqueRenderTarget)==null?void 0:e.getInternalTexture())!==null}_setupRenderTargets(){var t;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Or("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=((t=this._options.clearColor)==null?void 0:t.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.renderInLinearSpace=!0;let e;this._opaqueRenderTarget.onBeforeBindObservable.add(n=>{e=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?n.clearColor.copyFrom(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(n.clearColor,this._scene.getEngine().useExactSrgbConversions)}),this._opaqueRenderTarget.onAfterUnbindObservable.add(()=>{this._scene.environmentIntensity=e}),this._transparentMeshesCache.forEach(n=>{this._shouldRenderAsTransmission(n.material)&&(n.material.refractionTexture=this._opaqueRenderTarget)})}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const wt="KHR_materials_transmission";class Ro{constructor(e){this.name=wt,this.order=175,this._loader=e,this.enabled=this._loader.isExtensionUsed(wt),this.enabled&&(e.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return T.LoadExtensionAsync(e,t,this.name,(o,s)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(this._loadTransparentPropertiesAsync(o,t,n,s)),Promise.all(a).then(()=>{})})}_loadTransparentPropertiesAsync(e,t,n,o){var a,i;if(!(n instanceof W))throw new Error(`${e}: Material type not supported`);const s=n;if(s.subSurface.isRefractionEnabled=!0,s.subSurface.volumeIndexOfRefraction=1,s.subSurface.useAlbedoToTintRefraction=!0,o.transmissionFactor!==void 0){s.subSurface.refractionIntensity=o.transmissionFactor;const l=s.getScene();s.subSurface.refractionIntensity&&!l._transmissionHelper?new nn({},s.getScene()):s.subSurface.refractionIntensity&&!((a=l._transmissionHelper)!=null&&a._isRenderTargetValid())&&((i=l._transmissionHelper)==null||i._setupRenderTargets())}else return s.subSurface.refractionIntensity=0,s.subSurface.isRefractionEnabled=!1,Promise.resolve();return s.subSurface.minimumThickness=0,s.subSurface.maximumThickness=0,o.transmissionTexture?(o.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${e}/transmissionTexture`,o.transmissionTexture,void 0).then(l=>{l.name=`${n.name} (Transmission)`,s.subSurface.refractionIntensityTexture=l,s.subSurface.useGltfStyleTextures=!0})):Promise.resolve()}}L(wt);S(wt,!0,r=>new Ro(r));const bt="KHR_materials_diffuse_transmission";class Mo{constructor(e){this.name=bt,this.order=174,this._loader=e,this.enabled=this._loader.isExtensionUsed(bt),this.enabled&&(e.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return T.LoadExtensionAsync(e,t,this.name,(o,s)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(this._loadTranslucentPropertiesAsync(o,t,n,s)),Promise.all(a).then(()=>{})})}_loadTranslucentPropertiesAsync(e,t,n,o){if(!(n instanceof W))throw new Error(`${e}: Material type not supported`);const s=n;if(s.subSurface.isTranslucencyEnabled=!0,s.subSurface.volumeIndexOfRefraction=1,s.subSurface.minimumThickness=0,s.subSurface.maximumThickness=0,s.subSurface.useAlbedoToTintTranslucency=!1,o.diffuseTransmissionFactor!==void 0)s.subSurface.translucencyIntensity=o.diffuseTransmissionFactor;else return s.subSurface.translucencyIntensity=0,s.subSurface.isTranslucencyEnabled=!1,Promise.resolve();const a=new Array;return s.subSurface.useGltfStyleTextures=!0,o.diffuseTransmissionTexture&&(o.diffuseTransmissionTexture.nonColorData=!0,a.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTransmissionTexture`,o.diffuseTransmissionTexture).then(i=>{i.name=`${n.name} (Diffuse Transmission)`,s.subSurface.translucencyIntensityTexture=i}))),o.diffuseTransmissionColorFactor!==void 0?s.subSurface.translucencyColor=V.FromArray(o.diffuseTransmissionColorFactor):s.subSurface.translucencyColor=V.White(),o.diffuseTransmissionColorTexture&&a.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTransmissionColorTexture`,o.diffuseTransmissionColorTexture).then(i=>{i.name=`${n.name} (Diffuse Transmission Color)`,s.subSurface.translucencyColorTexture=i})),Promise.all(a).then(()=>{})}}L(bt);S(bt,!0,r=>new Mo(r));const At="KHR_materials_volume";class Vo{constructor(e){this.name=At,this.order=173,this._loader=e,this.enabled=this._loader.isExtensionUsed(At),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(e,t,n){return T.LoadExtensionAsync(e,t,this.name,(o,s)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(this._loadVolumePropertiesAsync(o,t,n,s)),Promise.all(a).then(()=>{})})}_loadVolumePropertiesAsync(e,t,n,o){if(!(n instanceof W))throw new Error(`${e}: Material type not supported`);if(!n.subSurface.isRefractionEnabled&&!n.subSurface.isTranslucencyEnabled||!o.thicknessFactor)return Promise.resolve();n.subSurface.volumeIndexOfRefraction=n.indexOfRefraction;const s=o.attenuationDistance!==void 0?o.attenuationDistance:Number.MAX_VALUE;return n.subSurface.tintColorAtDistance=s,o.attenuationColor!==void 0&&o.attenuationColor.length==3&&n.subSurface.tintColor.copyFromFloats(o.attenuationColor[0],o.attenuationColor[1],o.attenuationColor[2]),n.subSurface.minimumThickness=0,n.subSurface.maximumThickness=o.thicknessFactor,n.subSurface.useThicknessAsDepth=!0,o.thicknessTexture?(o.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${e}/thicknessTexture`,o.thicknessTexture).then(a=>{a.name=`${n.name} (Thickness)`,n.subSurface.thicknessTexture=a,n.subSurface.useGltfStyleTextures=!0})):Promise.resolve()}}L(At);S(At,!0,r=>new Vo(r));const Tt="KHR_materials_dispersion";class Do{constructor(e){this.name=Tt,this.order=174,this._loader=e,this.enabled=this._loader.isExtensionUsed(Tt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return T.LoadExtensionAsync(e,t,this.name,(o,s)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(this._loadDispersionPropertiesAsync(o,t,n,s)),Promise.all(a).then(()=>{})})}_loadDispersionPropertiesAsync(e,t,n,o){if(!(n instanceof W))throw new Error(`${e}: Material type not supported`);return!n.subSurface.isRefractionEnabled||!o.dispersion||(n.subSurface.isDispersionEnabled=!0,n.subSurface.dispersion=o.dispersion),Promise.resolve()}}L(Tt);S(Tt,!0,r=>new Do(r));const xt="KHR_mesh_quantization";class $o{constructor(e){this.name=xt,this.enabled=e.isExtensionUsed(xt)}dispose(){}}L(xt);S(xt,!0,r=>new $o(r));const Et="KHR_texture_basisu";class Ho{constructor(e){this.name=Et,this._loader=e,this.enabled=e.isExtensionUsed(Et)}dispose(){this._loader=null}_loadTextureAsync(e,t,n){return T.LoadExtensionAsync(e,t,this.name,(o,s)=>{const a=t.sampler==null?T.DefaultSampler:g.Get(`${e}/sampler`,this._loader.gltf.samplers,t.sampler),i=g.Get(`${o}/source`,this._loader.gltf.images,s.source);return this._loader._createTextureAsync(e,a,i,l=>{n(l)},t._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!t._textureInfo.nonColorData)})}}L(Et);S(Et,!0,r=>new Ho(r));const vt="KHR_texture_transform";class Ko{constructor(e){this.name=vt,this._loader=e,this.enabled=this._loader.isExtensionUsed(vt)}dispose(){this._loader=null}loadTextureInfoAsync(e,t,n){return T.LoadExtensionAsync(e,t,this.name,(o,s)=>this._loader.loadTextureInfoAsync(e,t,a=>{if(!(a instanceof $))throw new Error(`${o}: Texture type not supported`);s.offset&&(a.uOffset=s.offset[0],a.vOffset=s.offset[1]),a.uRotationCenter=0,a.vRotationCenter=0,s.rotation&&(a.wAng=-s.rotation),s.scale&&(a.uScale=s.scale[0],a.vScale=s.scale[1]),s.texCoord!=null&&(a.coordinatesIndex=s.texCoord),n(a)}))}}L(vt);S(vt,!0,r=>new Ko(r));const kt="KHR_xmp_json_ld";class Uo{constructor(e){this.name=kt,this.order=100,this._loader=e,this.enabled=this._loader.isExtensionUsed(kt)}dispose(){this._loader=null}onLoading(){var n,o,s;if(this._loader.rootBabylonMesh===null)return;const e=(n=this._loader.gltf.extensions)==null?void 0:n.KHR_xmp_json_ld,t=(s=(o=this._loader.gltf.asset)==null?void 0:o.extensions)==null?void 0:s.KHR_xmp_json_ld;if(e&&t){const a=+t.packet;e.packets&&a<e.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=e.packets[a])}}}L(kt);S(kt,!0,r=>new Uo(r));function Be(r,e,t,n){return V.FromArray(e,t).scale(n)}function qo(r,e,t,n){return e[t+3]*n}function D(r,e,t,n){return e[t]*n}function rn(r,e,t,n){return-e[t]*n}function Bt(r,e,t,n){return e[t+1]*n}function rr(r,e,t,n){return e[t]*n*2}function z(r){return{scale:[new R(x.ANIMATIONTYPE_FLOAT,`${r}.uScale`,D,()=>2),new R(x.ANIMATIONTYPE_FLOAT,`${r}.vScale`,Bt,()=>2)],offset:[new R(x.ANIMATIONTYPE_FLOAT,`${r}.uOffset`,D,()=>2),new R(x.ANIMATIONTYPE_FLOAT,`${r}.vOffset`,Bt,()=>2)],rotation:[new R(x.ANIMATIONTYPE_FLOAT,`${r}.wAng`,rn,()=>1)]}}class we extends Re{buildAnimations(e,t,n,o){return[{babylonAnimatable:e._babylonCamera,babylonAnimation:this._buildAnimation(t,n,o)}]}}class R extends Re{buildAnimations(e,t,n,o){const s=[];for(const a in e._data)s.push({babylonAnimatable:e._data[a].babylonMaterial,babylonAnimation:this._buildAnimation(t,n,o)});return s}}class Ce extends Re{buildAnimations(e,t,n,o){return[{babylonAnimatable:e._babylonLight,babylonAnimation:this._buildAnimation(t,n,o)}]}}f("/cameras/{}/orthographic/xmag",[new we(x.ANIMATIONTYPE_FLOAT,"orthoLeft",rn,()=>1),new we(x.ANIMATIONTYPE_FLOAT,"orthoRight",Bt,()=>1)]);f("/cameras/{}/orthographic/ymag",[new we(x.ANIMATIONTYPE_FLOAT,"orthoBottom",rn,()=>1),new we(x.ANIMATIONTYPE_FLOAT,"orthoTop",Bt,()=>1)]);f("/cameras/{}/orthographic/zfar",[new we(x.ANIMATIONTYPE_FLOAT,"maxZ",D,()=>1)]);f("/cameras/{}/orthographic/znear",[new we(x.ANIMATIONTYPE_FLOAT,"minZ",D,()=>1)]);f("/cameras/{}/perspective/yfov",[new we(x.ANIMATIONTYPE_FLOAT,"fov",D,()=>1)]);f("/cameras/{}/perspective/zfar",[new we(x.ANIMATIONTYPE_FLOAT,"maxZ",D,()=>1)]);f("/cameras/{}/perspective/znear",[new we(x.ANIMATIONTYPE_FLOAT,"minZ",D,()=>1)]);f("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new R(x.ANIMATIONTYPE_COLOR3,"albedoColor",Be,()=>4),new R(x.ANIMATIONTYPE_FLOAT,"alpha",qo,()=>4)]);f("/materials/{}/pbrMetallicRoughness/metallicFactor",[new R(x.ANIMATIONTYPE_FLOAT,"metallic",D,()=>1)]);f("/materials/{}/pbrMetallicRoughness/metallicFactor",[new R(x.ANIMATIONTYPE_FLOAT,"roughness",D,()=>1)]);const on=z("albedoTexture");f("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",on.scale);f("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",on.offset);f("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",on.rotation);const sn=z("metallicTexture");f("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",sn.scale);f("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",sn.offset);f("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",sn.rotation);f("/materials/{}/emissiveFactor",[new R(x.ANIMATIONTYPE_COLOR3,"emissiveColor",Be,()=>3)]);const an=z("bumpTexture");f("/materials/{}/normalTexture/scale",[new R(x.ANIMATIONTYPE_FLOAT,"bumpTexture.level",D,()=>1)]);f("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",an.scale);f("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",an.offset);f("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",an.rotation);f("/materials/{}/occlusionTexture/strength",[new R(x.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",D,()=>1)]);const ln=z("ambientTexture");f("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",ln.scale);f("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",ln.offset);f("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",ln.rotation);const cn=z("emissiveTexture");f("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",cn.scale);f("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",cn.offset);f("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",cn.rotation);f("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new R(x.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",D,()=>1)]);f("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new R(x.ANIMATIONTYPE_FLOAT,"anisotropy.angle",D,()=>1)]);const un=z("anisotropy.texture");f("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",un.scale);f("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",un.offset);f("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",un.rotation);f("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new R(x.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",D,()=>1)]);f("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new R(x.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",D,()=>1)]);const hn=z("clearCoat.texture");f("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",hn.scale);f("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",hn.offset);f("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",hn.rotation);const dn=z("clearCoat.bumpTexture");f("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new R(x.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",D,()=>1)]);f("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",dn.scale);f("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",dn.offset);f("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",dn.rotation);const _n=z("clearCoat.textureRoughness");f("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",_n.scale);f("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",_n.offset);f("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",_n.rotation);f("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new R(x.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",D,()=>1)]);f("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new R(x.ANIMATIONTYPE_FLOAT,"emissiveIntensity",D,()=>1)]);f("/materials/{}/extensions/KHR_materials_ior/ior",[new R(x.ANIMATIONTYPE_FLOAT,"indexOfRefraction",D,()=>1)]);f("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new R(x.ANIMATIONTYPE_FLOAT,"iridescence.intensity",D,()=>1)]);f("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new R(x.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",D,()=>1)]);f("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new R(x.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",D,()=>1)]);f("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new R(x.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",D,()=>1)]);const pn=z("iridescence.texture");f("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",pn.scale);f("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",pn.offset);f("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",pn.rotation);const fn=z("iridescence.thicknessTexture");f("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",fn.scale);f("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",fn.offset);f("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",fn.rotation);f("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new R(x.ANIMATIONTYPE_COLOR3,"sheen.color",Be,()=>3)]);f("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new R(x.ANIMATIONTYPE_FLOAT,"sheen.roughness",D,()=>1)]);const mn=z("sheen.texture");f("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",mn.scale);f("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",mn.offset);f("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",mn.rotation);const yn=z("sheen.textureRoughness");f("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",yn.scale);f("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",yn.offset);f("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",yn.rotation);f("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new R(x.ANIMATIONTYPE_FLOAT,"metallicF0Factor",D,()=>1)]);f("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new R(x.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Be,()=>3)]);const gn=z("metallicReflectanceTexture");f("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",gn.scale);f("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",gn.offset);f("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",gn.rotation);const wn=z("reflectanceTexture");f("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",wn.scale);f("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",wn.offset);f("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",wn.rotation);f("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new R(x.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",D,()=>1)]);const bn=z("subSurface.refractionIntensityTexture");f("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",bn.scale);f("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",bn.offset);f("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",bn.rotation);f("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new R(x.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Be,()=>3)]);f("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new R(x.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",D,()=>1)]);f("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new R(x.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",D,()=>1)]);const An=z("subSurface.thicknessTexture");f("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",An.scale);f("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",An.offset);f("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",An.rotation);f("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new R(x.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",D,()=>1)]);const Tn=z("subSurface.translucencyIntensityTexture");f("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Tn.scale);f("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Tn.offset);f("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Tn.rotation);f("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new R(x.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Be,()=>3)]);const xn=z("subSurface.translucencyColorTexture");f("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",xn.scale);f("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",xn.offset);f("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",xn.rotation);f("/extensions/KHR_lights_punctual/lights/{}/color",[new Ce(x.ANIMATIONTYPE_COLOR3,"diffuse",Be,()=>3)]);f("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Ce(x.ANIMATIONTYPE_FLOAT,"intensity",D,()=>1)]);f("/extensions/KHR_lights_punctual/lights/{}/range",[new Ce(x.ANIMATIONTYPE_FLOAT,"range",D,()=>1)]);f("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Ce(x.ANIMATIONTYPE_FLOAT,"innerAngle",rr,()=>1)]);f("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Ce(x.ANIMATIONTYPE_FLOAT,"angle",rr,()=>1)]);f("/nodes/{}/extensions/EXT_lights_ies/color",[new Ce(x.ANIMATIONTYPE_COLOR3,"diffuse",Be,()=>3)]);f("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Ce(x.ANIMATIONTYPE_FLOAT,"intensity",D,()=>1)]);const It="KHR_animation_pointer";class Wo{constructor(e){this.name=It,this._loader=e,this._pathToObjectConverter=jn(this._loader.gltf)}get enabled(){return this._loader.isExtensionUsed(It)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(e,t,n,o,s){var c;const a=(c=o.target.extensions)==null?void 0:c.KHR_animation_pointer;if(!a||!this._pathToObjectConverter)return null;o.target.path!=="pointer"&&C.Warn(`${e}/target/path: Value (${o.target.path}) must be (pointer) when using the ${this.name} extension`),o.target.node!=null&&C.Warn(`${e}/target/node: Value (${o.target.node}) must not be present when using the ${this.name} extension`);const i=`${e}/extensions/${this.name}`,l=a.pointer;if(!l)throw new Error(`${i}: Pointer is missing`);try{const u=this._pathToObjectConverter.convert(l);if(!u.info.interpolation)throw new Error(`${i}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(e,t,n,o,{object:u.object,info:u.info.interpolation},s)}catch{return C.Warn(`${i}/pointer: Invalid pointer (${l}) skipped`),null}}}L(It);S(It,!0,r=>new Wo(r));const Ft="MSFT_audio_emitter";class Yo{constructor(e){this.name=Ft,this._loader=e,this.enabled=this._loader.isExtensionUsed(Ft)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._clips=t.clips,this._emitters=t.emitters,g.Assign(this._clips),g.Assign(this._emitters)}}loadSceneAsync(e,t){return T.LoadExtensionAsync(e,t,this.name,(n,o)=>{const s=new Array;s.push(this._loader.loadSceneAsync(e,t));for(const a of o.emitters){const i=g.Get(`${n}/emitters`,this._emitters,a);if(i.refDistance!=null||i.maxDistance!=null||i.rolloffFactor!=null||i.distanceModel!=null||i.innerAngle!=null||i.outerAngle!=null)throw new Error(`${n}: Direction or Distance properties are not allowed on emitters attached to a scene`);s.push(this._loadEmitterAsync(`${n}/emitters/${i.index}`,i))}return Promise.all(s).then(()=>{})})}loadNodeAsync(e,t,n){return T.LoadExtensionAsync(e,t,this.name,(o,s)=>{const a=new Array;return this._loader.loadNodeAsync(o,t,i=>{for(const l of s.emitters){const c=g.Get(`${o}/emitters`,this._emitters,l);a.push(this._loadEmitterAsync(`${o}/emitters/${c.index}`,c).then(()=>{for(const u of c._babylonSounds)u.attachToMesh(i),(c.innerAngle!=null||c.outerAngle!=null)&&(u.setLocalDirectionToMesh(G.Forward()),u.setDirectionalCone(2*M.ToDegrees(c.innerAngle==null?Math.PI:c.innerAngle),2*M.ToDegrees(c.outerAngle==null?Math.PI:c.outerAngle),0))}))}n(i)}).then(i=>Promise.all(a).then(()=>i))})}loadAnimationAsync(e,t){return T.LoadExtensionAsync(e,t,this.name,(n,o)=>this._loader.loadAnimationAsync(e,t).then(s=>{const a=new Array;g.Assign(o.events);for(const i of o.events)a.push(this._loadAnimationEventAsync(`${n}/events/${i.index}`,e,t,i,s));return Promise.all(a).then(()=>s)}))}_loadClipAsync(e,t){if(t._objectURL)return t._objectURL;let n;if(t.uri)n=this._loader.loadUriAsync(e,t,t.uri);else{const o=g.Get(`${e}/bufferView`,this._loader.gltf.bufferViews,t.bufferView);n=this._loader.loadBufferViewAsync(`/bufferViews/${o.index}`,o)}return t._objectURL=n.then(o=>URL.createObjectURL(new Blob([o],{type:t.mimeType}))),t._objectURL}_loadEmitterAsync(e,t){if(t._babylonSounds=t._babylonSounds||[],!t._babylonData){const n=new Array,o=t.name||`emitter${t.index}`,s={loop:!1,autoplay:!1,volume:t.volume==null?1:t.volume};for(let i=0;i<t.clips.length;i++){const l=`/extensions/${this.name}/clips`,c=g.Get(l,this._clips,t.clips[i].clip);n.push(this._loadClipAsync(`${l}/${t.clips[i].clip}`,c).then(u=>{const h=t._babylonSounds[i]=new Cr(o,u,this._loader.babylonScene,null,s);h.refDistance=t.refDistance||1,h.maxDistance=t.maxDistance||256,h.rolloffFactor=t.rolloffFactor||1,h.distanceModel=t.distanceModel||"exponential"}))}const a=Promise.all(n).then(()=>{const i=t.clips.map(c=>c.weight||1),l=new Nr(t.loop||!1,t._babylonSounds,i);t.innerAngle&&(l.directionalConeInnerAngle=2*M.ToDegrees(t.innerAngle)),t.outerAngle&&(l.directionalConeOuterAngle=2*M.ToDegrees(t.outerAngle)),t.volume&&(l.volume=t.volume),t._babylonData.sound=l});t._babylonData={loaded:a}}return t._babylonData.loaded}_getEventAction(e,t,n,o,s){switch(n){case"play":return a=>{const i=(s||0)+(a-o);t.play(i)};case"stop":return()=>{t.stop()};case"pause":return()=>{t.pause()};default:throw new Error(`${e}: Unsupported action ${n}`)}}_loadAnimationEventAsync(e,t,n,o,s){if(s.targetedAnimations.length==0)return Promise.resolve();const a=s.targetedAnimations[0],i=o.emitter,l=g.Get(`/extensions/${this.name}/emitters`,this._emitters,i);return this._loadEmitterAsync(e,l).then(()=>{const c=l._babylonData.sound;if(c){const u=new Qt(o.time,this._getEventAction(e,c,o.action,o.time,o.startOffset));a.animation.addEvent(u),s.onAnimationGroupEndObservable.add(()=>{c.stop()}),s.onAnimationGroupPauseObservable.add(()=>{c.pause()})}})}}L(Ft);S(Ft,!0,r=>new Yo(r));const Ue="MSFT_lod";class Xo{constructor(e){var t;this.name=Ue,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new oe,this.onMaterialLODsLoadedObservable=new oe,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=e,this.maxLODsToLoad=((t=this._loader.parent.extensionOptions[Ue])==null?void 0:t.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Ue)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let e=0;e<this._nodePromiseLODs.length;e++){const t=Promise.all(this._nodePromiseLODs[e]).then(()=>{e!==0&&(this._loader.endPerformanceCounter(`Node LOD ${e}`),this._loader.log(`Loaded node LOD ${e}`)),this.onNodeLODsLoadedObservable.notifyObservers(e),e!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${e+1}`),this._loadBufferLOD(this._nodeBufferLODs,e+1),this._nodeSignalLODs[e]&&this._nodeSignalLODs[e].resolve())});this._loader._completePromises.push(t)}for(let e=0;e<this._materialPromiseLODs.length;e++){const t=Promise.all(this._materialPromiseLODs[e]).then(()=>{e!==0&&(this._loader.endPerformanceCounter(`Material LOD ${e}`),this._loader.log(`Loaded material LOD ${e}`)),this.onMaterialLODsLoadedObservable.notifyObservers(e),e!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${e+1}`),this._loadBufferLOD(this._materialBufferLODs,e+1),this._materialSignalLODs[e]&&this._materialSignalLODs[e].resolve())});this._loader._completePromises.push(t)}}loadSceneAsync(e,t){const n=this._loader.loadSceneAsync(e,t);return this._loadBufferLOD(this._bufferLODs,0),n}loadNodeAsync(e,t,n){return T.LoadExtensionAsync(e,t,this.name,(o,s)=>{let a;const i=this._getLODs(o,t,this._loader.gltf.nodes,s.ids);this._loader.logOpen(`${o}`);for(let l=0;l<i.length;l++){const c=i[l];l!==0&&(this._nodeIndexLOD=l,this._nodeSignalLODs[l]=this._nodeSignalLODs[l]||new He);const u=d=>{n(d),d.setEnabled(!1)},h=this._loader.loadNodeAsync(`/nodes/${c.index}`,c,u).then(d=>{if(l!==0){const p=i[l-1];p._babylonTransformNode&&(this._disposeTransformNode(p._babylonTransformNode),delete p._babylonTransformNode)}return d.setEnabled(!0),d});this._nodePromiseLODs[l]=this._nodePromiseLODs[l]||[],l===0?a=h:(this._nodeIndexLOD=null,this._nodePromiseLODs[l].push(h))}return this._loader.logClose(),a})}_loadMaterialAsync(e,t,n,o,s){return this._nodeIndexLOD?null:T.LoadExtensionAsync(e,t,this.name,(a,i)=>{let l;const c=this._getLODs(a,t,this._loader.gltf.materials,i.ids);this._loader.logOpen(`${a}`);for(let u=0;u<c.length;u++){const h=c[u];u!==0&&(this._materialIndexLOD=u);const d=this._loader._loadMaterialAsync(`/materials/${h.index}`,h,n,o,p=>{u===0&&s(p)}).then(p=>{if(u!==0){s(p);const m=c[u-1]._data;m[o]&&(this._disposeMaterials([m[o].babylonMaterial]),delete m[o])}return p});this._materialPromiseLODs[u]=this._materialPromiseLODs[u]||[],u===0?l=d:(this._materialIndexLOD=null,this._materialPromiseLODs[u].push(d))}return this._loader.logClose(),l})}_loadUriAsync(e,t,n){if(this._nodeIndexLOD!==null){this._loader.log("deferred");const o=this._nodeIndexLOD-1;return this._nodeSignalLODs[o]=this._nodeSignalLODs[o]||new He,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then(()=>this._loader.loadUriAsync(e,t,n))}else if(this._materialIndexLOD!==null){this._loader.log("deferred");const o=this._materialIndexLOD-1;return this._materialSignalLODs[o]=this._materialSignalLODs[o]||new He,this._materialSignalLODs[o].promise.then(()=>this._loader.loadUriAsync(e,t,n))}return null}loadBufferAsync(e,t,n,o){if(this._loader.parent.useRangeRequests&&!t.uri){if(!this._loader.bin)throw new Error(`${e}: Uri is missing or the binary glTF is missing its binary chunk`);const s=(a,i)=>{const l=n,c=l+o-1;let u=a[i];return u?(u.start=Math.min(u.start,l),u.end=Math.max(u.end,c)):(u={start:l,end:c,loaded:new He},a[i]=u),u.loaded.promise.then(h=>new Uint8Array(h.buffer,h.byteOffset+n-u.start,o))};return this._loader.log("deferred"),this._nodeIndexLOD!==null?s(this._nodeBufferLODs,this._nodeIndexLOD):this._materialIndexLOD!==null?s(this._materialBufferLODs,this._materialIndexLOD):s(this._bufferLODs,0)}return null}_loadBufferLOD(e,t){const n=e[t];n&&(this._loader.log(`Loading buffer range [${n.start}-${n.end}]`),this._loader.bin.readAsync(n.start,n.end-n.start+1).then(o=>{n.loaded.resolve(o)},o=>{n.loaded.reject(o)}))}_getLODs(e,t,n,o){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const s=[];for(let a=o.length-1;a>=0;a--)if(s.push(g.Get(`${e}/ids/${o[a]}`,n,o[a])),s.length===this.maxLODsToLoad)return s;return s.push(t),s}_disposeTransformNode(e){const t=[],n=e.material;n&&t.push(n);for(const s of e.getChildMeshes())s.material&&t.push(s.material);e.dispose();const o=t.filter(s=>this._loader.babylonScene.meshes.every(a=>a.material!=s));this._disposeMaterials(o)}_disposeMaterials(e){const t={};for(const n of e){for(const o of n.getActiveTextures())t[o.uniqueId]=o;n.dispose()}for(const n in t)for(const o of this._loader.babylonScene.materials)o.hasTexture(t[n])&&delete t[n];for(const n in t)t[n].dispose()}}L(Ue);S(Ue,!0,r=>new Xo(r));const Ot="MSFT_minecraftMesh";class Jo{constructor(e){this.name=Ot,this._loader=e,this.enabled=this._loader.isExtensionUsed(Ot)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return T.LoadExtraAsync(e,t,this.name,(o,s)=>{if(s){if(!(n instanceof W))throw new Error(`${o}: Material type not supported`);const a=this._loader.loadMaterialPropertiesAsync(e,t,n);return n.needAlphaBlending()&&(n.forceDepthWrite=!0,n.separateCullingPass=!0),n.backFaceCulling=n.forceDepthWrite,n.twoSidedLighting=!0,a}return null})}}L(Ot);S(Ot,!0,r=>new Jo(r));const Ct="MSFT_sRGBFactors";class Zo{constructor(e){this.name=Ct,this._loader=e,this.enabled=this._loader.isExtensionUsed(Ct)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return T.LoadExtraAsync(e,t,this.name,(o,s)=>{if(s){if(!(n instanceof W))throw new Error(`${o}: Material type not supported`);const a=this._loader.loadMaterialPropertiesAsync(e,t,n),i=n.getScene().getEngine().useExactSrgbConversions;return n.albedoTexture||n.albedoColor.toLinearSpaceToRef(n.albedoColor,i),n.reflectivityTexture||n.reflectivityColor.toLinearSpaceToRef(n.reflectivityColor,i),a}return null})}}L(Ct);S(Ct,!0,r=>new Zo(r));function Sn(r){const[e,t]=r.split(":");return or({op:e,extension:t})}function or(r,e=!0){var n;const t=r.extension?(n=tt[r.extension])==null?void 0:n[r.op]:Qo[r.op];if(!t&&(C.Warn(`No mapping found for operation ${r.op} and extension ${r.extension||"KHR_interactivity"}`),e)){const o={},s={flows:{}};if(r.inputValueSockets){o.values={};for(const a in r.inputValueSockets)o.values[a]={name:a}}return r.outputValueSockets&&(s.values={},Object.keys(r.outputValueSockets).forEach(a=>{s.values[a]={name:a}})),{blocks:[],inputs:o,outputs:s}}return t}function En(r,e,t){tt[e]||(tt[e]={}),tt[e][r]=t}const tt={BABYLON:{"flow/log":{blocks:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Qo={"event/onStart":{blocks:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{blocks:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{blocks:["FlowGraphSendCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},extraProcessor(r,e,t,n,o){if(e.op!=="event/send"||!r.configuration||Object.keys(r.configuration).length!==1)throw new Error("Receive event should have a single configuration object, the event itself");const a=r.configuration.event.value[0];if(typeof a!="number")throw new Error("Event id should be a number");const i=n.arrays.events[a],l=o[0];return l.config||(l.config={}),l.config.eventId=i.eventId,l.config.eventData=i.eventData,o}},"event/receive":{blocks:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(r,e){var s;if(!r.configuration)return C.Error("Receive event should have a configuration object"),!1;const t=r.configuration.event;if(!t)return C.Error("Receive event should have a single configuration object, the event itself"),!1;const n=t.value[0];return typeof n!="number"?(C.Error("Event id should be a number"),!1):((s=e.events)==null?void 0:s[n])?!0:(C.Error(`Event with id ${n} not found`),!1)},extraProcessor(r,e,t,n,o){if(e.op!=="event/receive"||!r.configuration||Object.keys(r.configuration).length!==1)throw new Error("Receive event should have a single configuration object, the event itself");const a=r.configuration.event.value[0];if(typeof a!="number")throw new Error("Event id should be a number");const i=n.arrays.events[a],l=o[0];return l.config||(l.config={}),l.config.eventId=i.eventId,l.config.eventData=i.eventData,o}},"math/e":w("FlowGraphEBlock"),"math/pi":w("FlowGraphPIBlock"),"math/inf":w("FlowGraphInfBlock"),"math/nan":w("FlowGraphNaNBlock"),"math/abs":w("FlowGraphAbsBlock"),"math/sign":w("FlowGraphSignBlock"),"math/trunc":w("FlowGraphTruncBlock"),"math/floor":w("FlowGraphFloorBlock"),"math/ceil":w("FlowGraphCeilBlock"),"math/round":{blocks:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(r,e,t,n,o){return o[0].config=o[0].config||{},o[0].config.roundHalfAwayFromZero=!0,o}},"math/fract":w("FlowGraphFractBlock"),"math/neg":w("FlowGraphNegationBlock"),"math/add":w("FlowGraphAddBlock",["a","b"],!0),"math/sub":w("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{blocks:["FlowGraphMultiplyBlock"],extraProcessor(r,e,t,n,o){o[0].config=o[0].config||{},o[0].config.useMatrixPerComponent=!0;let s=-1;return Object.keys(r.values||{}).find(a=>{var i;return((i=r.values)==null?void 0:i[a].type)!==void 0?(s=r.values[a].type,!0):!1}),s!==-1&&(o[0].config.type=n.arrays.types[s].flowGraphType),o}},"math/div":w("FlowGraphDivideBlock",["a","b"],!0),"math/rem":w("FlowGraphModuloBlock",["a","b"]),"math/min":w("FlowGraphMinBlock",["a","b"]),"math/max":w("FlowGraphMaxBlock",["a","b"]),"math/clamp":w("FlowGraphClampBlock",["a","b","c"]),"math/saturate":w("FlowGraphSaturateBlock"),"math/mix":w("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":w("FlowGraphEqualityBlock",["a","b"]),"math/lt":w("FlowGraphLessThanBlock",["a","b"]),"math/le":w("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":w("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":w("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":w("FlowGraphIsNaNBlock"),"math/isinf":w("FlowGraphIsInfBlock"),"math/select":{blocks:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{blocks:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":w("FlowGraphSinBlock"),"math/cos":w("FlowGraphCosBlock"),"math/tan":w("FlowGraphTanBlock"),"math/asin":w("FlowGraphASinBlock"),"math/acos":w("FlowGraphACosBlock"),"math/atan":w("FlowGraphATanBlock"),"math/atan2":w("FlowGraphATan2Block",["a","b"]),"math/sinh":w("FlowGraphSinhBlock"),"math/cosh":w("FlowGraphCoshBlock"),"math/tanh":w("FlowGraphTanhBlock"),"math/asinh":w("FlowGraphASinhBlock"),"math/acosh":w("FlowGraphACoshBlock"),"math/atanh":w("FlowGraphATanhBlock"),"math/exp":w("FlowGraphExponentialBlock"),"math/log":w("FlowGraphLogBlock"),"math/log2":w("FlowGraphLog2Block"),"math/log10":w("FlowGraphLog10Block"),"math/sqrt":w("FlowGraphSquareRootBlock"),"math/cbrt":w("FlowGraphCubeRootBlock"),"math/pow":w("FlowGraphPowerBlock",["a","b"]),"math/length":w("FlowGraphLengthBlock"),"math/normalize":w("FlowGraphNormalizeBlock"),"math/dot":w("FlowGraphDotBlock",["a","b"]),"math/cross":w("FlowGraphCrossBlock",["a","b"]),"math/rotate2d":w("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3d":w("FlowGraphRotate3DBlock",["a","b","c"]),"math/transform":{blocks:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{blocks:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{blocks:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{blocks:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{blocks:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{blocks:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{blocks:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":w("FlowGraphTransposeBlock"),"math/determinant":w("FlowGraphDeterminantBlock"),"math/inverse":w("FlowGraphInvertMatrixBlock"),"math/matmul":w("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{blocks:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"scaling",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(r,e,t,n,o,s){const a=o[0].dataInputs.find(i=>i.name==="rotationQuaternion");if(!a)throw new Error("Rotation quaternion input not found");return s._connectionValues[a.uniqueId]&&(s._connectionValues[a.uniqueId].type="Quaternion"),o}},"math/matDecompose":{blocks:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"scaling"}}}},"math/combine2x2":{blocks:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(r,e,t,n,o){return o[0].config=o[0].config||{},o[0].config.inputIsColumnMajor=!0,o}},"math/extract2x2":{blocks:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{blocks:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(r,e,t,n,o){return o[0].config=o[0].config||{},o[0].config.inputIsColumnMajor=!0,o}},"math/extract3x3":{blocks:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{blocks:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(r,e,t,n,o){return o[0].config=o[0].config||{},o[0].config.inputIsColumnMajor=!0,o}},"math/extract4x4":{blocks:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/compose":{blocks:["FlowGraphMatrixCompose"],configuration:{},inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"scaling",gltfType:"float3"}}},outputs:{values:{value:{name:"output"}}}},"math/decompose":{blocks:["FlowGraphMatrixDecompose"],configuration:{},inputs:{values:{a:{name:"input"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"scaling"}}}},"math/not":{blocks:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(r,e,t,n,o,s){var i;o[0].config=o[0].config||{};const a=o[0].dataInputs[0];return o[0].config.valueType=((i=s._connectionValues[a.uniqueId])==null?void 0:i.type)??"FlowGraphInteger",o}},"math/and":{blocks:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(r,e,t,n,o,s){var l,c;o[0].config=o[0].config||{};const a=o[0].dataInputs[0],i=o[0].dataInputs[1];return o[0].config.valueType=((l=s._connectionValues[a.uniqueId])==null?void 0:l.type)??((c=s._connectionValues[i.uniqueId])==null?void 0:c.type)??"FlowGraphInteger",o}},"math/or":{blocks:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(r,e,t,n,o,s){var l,c;o[0].config=o[0].config||{};const a=o[0].dataInputs[0],i=o[0].dataInputs[1];return o[0].config.valueType=((l=s._connectionValues[a.uniqueId])==null?void 0:l.type)??((c=s._connectionValues[i.uniqueId])==null?void 0:c.type)??"FlowGraphInteger",o}},"math/xor":{blocks:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(r,e,t,n,o,s){var l,c;o[0].config=o[0].config||{};const a=o[0].dataInputs[0],i=o[0].dataInputs[1];return o[0].config.valueType=((l=s._connectionValues[a.uniqueId])==null?void 0:l.type)??((c=s._connectionValues[i.uniqueId])==null?void 0:c.type)??"FlowGraphInteger",o}},"math/asr":w("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":w("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":w("FlowGraphLeadingZerosBlock"),"math/ctz":w("FlowGraphTrailingZerosBlock"),"math/popcnt":w("FlowGraphOneBitsCounterBlock"),"math/rad":w("FlowGraphDegToRadBlock"),"math/deg":w("FlowGraphRadToDegBlock"),"type/boolToInt":w("FlowGraphBooleanToInt"),"type/boolToFloat":w("FlowGraphBooleanToFloat"),"type/intToBool":w("FlowGraphIntToBoolean"),"type/intToFloat":w("FlowGraphIntToFloat"),"type/floatToInt":w("FlowGraphFloatToInt"),"type/floatToBool":w("FlowGraphFloatToBoolean"),"flow/sequence":{blocks:["FlowGraphSequenceBlock"],extraProcessor(r,e,t,n,o){const s=o[0];return s.config||(s.config={}),s.config.outputSignalCount=Object.keys(r.flows||[]).length,s.signalOutputs.forEach((a,i)=>{a.name="out_"+i}),o}},"flow/branch":{blocks:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{blocks:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(r){if(r.configuration&&r.configuration.cases){const e=r.configuration.cases.value;if(!e.every(o=>typeof o=="number"&&/^\d+$/.test(o.toString())))return r.configuration.cases.value=[],!0;const n=new Set(e);r.configuration.cases.value=Array.from(n)}return!0},extraProcessor(r,e,t,n,o){if(e.op!=="flow/switch"||!r.flows||Object.keys(r.flows).length===0)throw new Error("Switch should have a single configuration object, the cases array");return o[0].signalOutputs.forEach(a=>{a.name!=="default"&&(a.name="out_"+a.name)}),o}},"flow/while":{blocks:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{blocks:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}}},"flow/doN":{blocks:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{blocks:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(r,e,t,n,o){if(e.op!=="flow/multiGate"||!r.flows||Object.keys(r.flows).length===0)throw new Error("MultiGate should have a single configuration object, the number of output flows");const s=o[0];return s.config||(s.config={}),s.config.outputSignalCount=Object.keys(r.flows).length,s.signalOutputs.forEach((a,i)=>{a.name="out_"+i}),o}},"flow/waitAll":{blocks:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{"[segment]":{name:"in_$1"}}},validation(r){var e,t;return typeof((t=(e=r.configuration)==null?void 0:e.inputFlows)==null?void 0:t.value[0])!="number"&&(r.configuration=r.configuration||{inputFlows:{value:[0]}},r.configuration.inputFlows.value=[0]),!0}},"flow/throttle":{blocks:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{blocks:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{blocks:["FlowGraphCancelDelayBlock"]},"variable/get":{blocks:["FlowGraphGetVariableBlock"],validation(r){var e,t;return(t=(e=r.configuration)==null?void 0:e.variable)!=null&&t.value?!0:(C.Error("Variable get block should have a variable configuration"),!1)},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer(r,e){return[e.getVariableName(r[0])]}}}},"variable/set":{blocks:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer(r,e){return[e.getVariableName(r[0])]}}}},"variable/setMultiple":{blocks:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer(r,e){return[r[0].map(t=>e.getVariableName(t))]}}},extraProcessor(r,e,t,n,o){return o[0].dataInputs.forEach(a=>{a.name=n.getVariableName(+a.name)}),o}},"variable/interpolate":{blocks:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer(r,e){return[e.getVariableName(r[0])]}},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:r=>r[0]===!0?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(r,e,t,n,o){var h;var s,a;const i=o[0],l=(h=r.configuration)==null?void 0:h.variable.value[0];if(typeof l!="number")throw C.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const c=n.arrays.staticVariables[l];typeof i.config.animationType.value>"u"&&(n.arrays.staticVariables,i.config.animationType.value=Gr(c.type));const u=o[4];return u.config||(u.config={}),(s=u.config).variable||(s.variable={}),u.config.variable.value=n.getVariableName(l),(a=o[3]).config||(a.config={}),o}},"pointer/get":{blocks:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor(r,e,t,n,o){return o.forEach(s=>{s.className==="FlowGraphJsonPointerParserBlock"&&(s.config||(s.config={}),s.config.outputValue=!0)}),o}},"pointer/set":{blocks:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor(r,e,t,n,o){return o.forEach(s=>{s.className==="FlowGraphJsonPointerParserBlock"&&(s.config||(s.config={}),s.config.outputValue=!0)}),o}},"pointer/interpolate":{blocks:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphEasingBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphEasingBlock"},p2:{name:"controlPoint2",toBlock:"FlowGraphEasingBlock"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor(r,e,t,n,o){return o.forEach(s=>{s.className==="FlowGraphJsonPointerParserBlock"?(s.config||(s.config={}),s.config.outputValue=!0):s.className==="FlowGraphInterpolationBlock"&&(s.config||(s.config={}),Object.keys(r.values||[]).forEach(a=>{var l;const i=(l=r.values)==null?void 0:l[a];if(a==="value"&&i){const c=i.type;c!==void 0&&(s.config.animationType=n.arrays.types[c].flowGraphType)}}))}),o}},"animation/start":{blocks:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(r,e)=>[r[0]*e._loader.parent.targetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(r,e)=>[r[0]*e._loader.parent.targetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(r,e,t,n,o,s,a){const i=o[o.length-1];return i.config||(i.config={}),i.config.glTF=a,o}},"animation/stop":{blocks:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(r,e,t,n,o,s,a){const i=o[o.length-1];return i.config||(i.config={}),i.config.glTF=a,o}},"animation/stopAt":{blocks:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(r,e)=>[r[0]*e._loader.parent.targetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(r,e,t,n,o,s,a){const i=o[o.length-1];return i.config||(i.config={}),i.config.glTF=a,o}},"math/switch":{blocks:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(r){if(r.configuration&&r.configuration.cases){const e=r.configuration.cases.value;if(!e.every(o=>typeof o=="number"&&/^\d+$/.test(o.toString())))return r.configuration.cases.value=[],!0;const n=new Set(e);r.configuration.cases.value=Array.from(n)}return!0},extraProcessor(r,e,t,n,o){return o[0].dataInputs.forEach(a=>{a.name!=="default"&&a.name!=="case"&&(a.name="in_"+a.name)}),o}},"debug/log":{blocks:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function w(r,e=["a"],t){return{blocks:[r],inputs:{values:e.reduce((n,o)=>(n[o]={name:o},n),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(n,o,s,a,i){if(t){i[0].config=i[0].config||{};let l=-1;Object.keys(n.values||{}).find(c=>{var u;return((u=n.values)==null?void 0:u[c].type)!==void 0?(l=n.values[c].type,!0):!1}),l!==-1&&(i[0].config.type=a.arrays.types[l].flowGraphType)}return i}}}const jo={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Vector3",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class zo{constructor(e,t,n){this._interactivityGraph=e,this._gltf=t,this._loader=n,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const e of this._interactivityGraph.types)this._types.push(jo[e.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const e of this._interactivityGraph.declarations){const t=or(e);if(!t)throw C.Error(["No mapping found for declaration",e]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:t,fullOperationName:e.extension?e.op+":"+e.extension:e.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const e of this._interactivityGraph.variables){const t=this._parseVariable(e);this._staticVariables.push(t)}}_parseVariable(e,t){const n=this._types[e.type];if(!n)throw C.Error(["No type found for variable",e]),new Error("Error parsing variables");if(e.value&&e.value.length!==n.length)throw C.Error(["Invalid value length for variable",e,n]),new Error("Error parsing variables");const o=e.value||[];if(!o.length)switch(n.flowGraphType){case"boolean":o.push(!1);break;case"FlowGraphInteger":o.push(0);break;case"number":o.push(NaN);break;case"Vector2":o.push(NaN,NaN);break;case"Vector3":o.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":o.fill(NaN,0,4);break;case"Matrix":o.fill(NaN,0,16);break;case"Matrix3D":o.fill(NaN,0,9);break}return{type:n.flowGraphType,value:t?t(o,this):o}}_parseEvents(){if(this._interactivityGraph.events)for(const e of this._interactivityGraph.events){const t={eventId:e.id||"internalEvent_"+this._internalEventsCounter++};e.values&&(t.eventData=Object.keys(e.values).map(n=>{var i;const o=(i=e.values)==null?void 0:i[n];if(!o)throw C.Error(["No value found for event key",n]),new Error("Error parsing events");const s=this._types[o.type];if(!s)throw C.Error(["No type found for event value",o]),new Error("Error parsing events");const a=typeof o.value<"u"?this._parseVariable(o):void 0;return{id:n,type:s.flowGraphType,eventData:!0,value:a}})),this._events.push(t)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const e of this._interactivityGraph.nodes){if(typeof e.declaration!="number")throw C.Error(["No declaration found for node",e]),new Error("Error parsing nodes");const t=this._mappings[e.declaration];if(!t)throw C.Error(["No mapping found for node",e]),new Error("Error parsing nodes");if(t.flowGraphMapping.validation&&!t.flowGraphMapping.validation(e,this._interactivityGraph,this._gltf))throw new Error(`Error validating interactivity node ${e}`);const n=[];for(const o of t.flowGraphMapping.blocks){const s=this._getEmptyBlock(o,t.fullOperationName);this._parseNodeConfiguration(e,s,t.flowGraphMapping,o),n.push(s)}this._nodes.push({blocks:n,fullOperationName:t.fullOperationName})}}_getEmptyBlock(e,t){return{uniqueId:Rt(),className:e,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:t,metadata:{}}}_parseNodeConfiguration(e,t,n,o){const s=t.config;e.configuration&&Object.keys(e.configuration).forEach(a=>{var u,h;const i=(u=e.configuration)==null?void 0:u[a];if(!i)throw C.Error(["No value found for node configuration",a]),new Error("Error parsing node configuration");const l=(h=n.configuration)==null?void 0:h[a];if(l&&l.toBlock?l.toBlock===o:n.blocks.indexOf(o)===0){const d=(l==null?void 0:l.name)||a;(!i||typeof i.value>"u")&&typeof(l==null?void 0:l.defaultValue)<"u"?s[d]={value:l.defaultValue}:i.value.length>=1?s[d]={value:i.value.length===1?i.value[0]:i.value}:C.Warn(["Invalid value for node configuration",i]),l&&l.dataTransformer&&(s[d].value=l.dataTransformer([s[d].value],this)[0])}})}_parseNodeConnections(e){var t,n,o,s,a,i,l,c,u,h,d,p,m,b,A,E,I,P,O;for(let k=0;k<this._nodes.length;k++){const B=(t=this._interactivityGraph.nodes)==null?void 0:t[k];if(!B)throw C.Error(["No node found for interactivity node",this._nodes[k]]),new Error("Error parsing node connections");const v=this._nodes[k],F=this._mappings[B.declaration];if(!F)throw C.Error(["No mapping found for node",B]),new Error("Error parsing node connections");const H=B.flows||{},K=Object.keys(H).sort();for(const te of K){const se=H[te],X=(o=(n=F.flowGraphMapping.outputs)==null?void 0:n.flows)==null?void 0:o[te],Ge=(X==null?void 0:X.name)||te,Me=this._createNewSocketConnection(Ge,!0);(X&&X.toBlock&&v.blocks.find(pe=>pe.className===X.toBlock)||v.blocks[0]).signalOutputs.push(Me);const St=se.node,ae=this._nodes[St];if(!ae)throw C.Error(["No node found for input node id",St]),new Error("Error parsing node connections");const be=Sn(ae.fullOperationName);if(!be)throw C.Error(["No mapping found for input node",ae]),new Error("Error parsing node connections");let ce=(a=(s=be.inputs)==null?void 0:s.flows)==null?void 0:a[se.socket||"in"],Ie=!1;if(!ce)for(const pe in(i=be.inputs)==null?void 0:i.flows)pe.startsWith("[")&&pe.endsWith("]")&&(Ie=!0,ce=(c=(l=be.inputs)==null?void 0:l.flows)==null?void 0:c[pe]);const ue=ce?Ie?ce.name.replace("$1",se.socket||""):ce.name:se.socket||"in",De=ce&&ce.toBlock&&ae.blocks.find(pe=>pe.className===ce.toBlock)||ae.blocks[0];let Ae=De.signalInputs.find(pe=>pe.name===ue);Ae||(Ae=this._createNewSocketConnection(ue),De.signalInputs.push(Ae)),Ae.connectedPointIds.push(Me.uniqueId),Me.connectedPointIds.push(Ae.uniqueId)}const q=B.values||{},Qe=Object.keys(q);for(const te of Qe){const se=q[te];let X=(h=(u=F.flowGraphMapping.inputs)==null?void 0:u.values)==null?void 0:h[te],Ge=!1;if(!X)for(const ae in(d=F.flowGraphMapping.inputs)==null?void 0:d.values)ae.startsWith("[")&&ae.endsWith("]")&&(Ge=!0,X=(m=(p=F.flowGraphMapping.inputs)==null?void 0:p.values)==null?void 0:m[ae]);const Me=X?Ge?X.name.replace("$1",te):X.name:te,Ve=this._createNewSocketConnection(Me);if((X&&X.toBlock&&v.blocks.find(ae=>ae.className===X.toBlock)||v.blocks[0]).dataInputs.push(Ve),se.value!==void 0){const ae=this._parseVariable(se,X&&X.dataTransformer);e._connectionValues[Ve.uniqueId]=ae}else if(typeof se.node<"u"){const ae=se.node,be=se.socket||"value",ce=this._nodes[ae];if(!ce)throw C.Error(["No node found for output socket reference",se]),new Error("Error parsing node connections");const Ie=Sn(ce.fullOperationName);if(!Ie)throw C.Error(["No mapping found for output socket reference",se]),new Error("Error parsing node connections");let ue=(A=(b=Ie.outputs)==null?void 0:b.values)==null?void 0:A[be],De=!1;if(!ue)for(const Fe in(E=Ie.outputs)==null?void 0:E.values)Fe.startsWith("[")&&Fe.endsWith("]")&&(De=!0,ue=(P=(I=Ie.outputs)==null?void 0:I.values)==null?void 0:P[Fe]);const Ae=ue?De?ue.name.replace("$1",be):ue==null?void 0:ue.name:be,pe=ue&&ue.toBlock&&ce.blocks.find(Fe=>Fe.className===ue.toBlock)||ce.blocks[0];let $e=pe.dataOutputs.find(Fe=>Fe.name===Ae);$e||($e=this._createNewSocketConnection(Ae,!0),pe.dataOutputs.push($e)),Ve.connectedPointIds.push($e.uniqueId),$e.connectedPointIds.push(Ve.uniqueId)}else throw C.Error(["Invalid value for value connection",se]),new Error("Error parsing node connections")}if(F.flowGraphMapping.interBlockConnectors)for(const te of F.flowGraphMapping.interBlockConnectors){const se=te.input,X=te.output,Ge=te.isVariable;this._connectFlowGraphNodes(se,X,v.blocks[te.inputBlockIndex],v.blocks[te.outputBlockIndex],Ge)}if(F.flowGraphMapping.extraProcessor){const te=(O=this._interactivityGraph.declarations)==null?void 0:O[B.declaration];if(!te)throw C.Error(["No declaration found for extra processor",B]),new Error("Error parsing node connections");v.blocks=F.flowGraphMapping.extraProcessor(B,te,F.flowGraphMapping,this,v.blocks,e,this._gltf)}}}_createNewSocketConnection(e,t){return{uniqueId:Rt(),name:e,_connectionType:t?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(e,t,n,o,s){const a=s?n.dataInputs:n.signalInputs,i=s?o.dataOutputs:o.signalOutputs,l=a.find(u=>u.name===e)||this._createNewSocketConnection(e),c=i.find(u=>u.name===t)||this._createNewSocketConnection(t,!0);a.find(u=>u.name===e)||a.push(l),i.find(u=>u.name===t)||i.push(c),l.connectedPointIds.push(c.uniqueId),c.connectedPointIds.push(l.uniqueId)}getVariableName(e){return"staticVariable_"+e}serializeToFlowGraph(){const e={uniqueId:Rt(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(e);for(let n=0;n<this._staticVariables.length;n++){const o=this._staticVariables[n];e._userVariables[this.getVariableName(n)]=o}return{rightHanded:!0,allBlocks:this._nodes.reduce((n,o)=>n.concat(o.blocks),[]),executionContexts:[e]}}}const Xe="KHR_interactivity";class es{constructor(e){this._loader=e,this.name=Xe,this.enabled=this._loader.isExtensionUsed(Xe),this._pathConverter=jn(this._loader.gltf),e._skipStartAnimationStep=!0;const t=e.babylonScene;t&&ts(t)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var s;if(!this._loader.babylonScene||!this._pathConverter)return;const e=this._loader.babylonScene,t=(s=this._loader.gltf.extensions)==null?void 0:s.KHR_interactivity;if(!t)return;const n=new Pr({scene:e}),o=t.graphs.map(a=>new zo(a,this._loader.gltf,this._loader).serializeToFlowGraph());await Promise.all(o.map(a=>Vr(a,{coordinator:n,pathConverter:this._pathConverter}))),n.start()}}function ts(r){me("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>r.activeCamera?j.FromRotationMatrix(r.activeCamera.getWorldMatrix()).normalize():new j(NaN,NaN,NaN,NaN),type:"Quaternion",getTarget:()=>r.activeCamera}),me("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>r.activeCamera?r.activeCamera.position:new G(NaN,NaN,NaN),type:"Vector3",getTarget:()=>r.activeCamera}),me("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:e=>{var t;return((t=e._babylonAnimationGroup)==null?void 0:t.isPlaying)??!1},type:"boolean",getTarget:e=>e._babylonAnimationGroup}),me("/animations/{}/extensions/KHR_interactivity/minTime",{get:e=>{var t;return(((t=e._babylonAnimationGroup)==null?void 0:t.from)??0)/60},type:"number",getTarget:e=>e._babylonAnimationGroup}),me("/animations/{}/extensions/KHR_interactivity/maxTime",{get:e=>{var t;return(((t=e._babylonAnimationGroup)==null?void 0:t.to)??0)/60},type:"number",getTarget:e=>e._babylonAnimationGroup}),me("/animations/{}/extensions/KHR_interactivity/playhead",{get:e=>{var t;return(((t=e._babylonAnimationGroup)==null?void 0:t.getCurrentFrame())??0)/60},type:"number",getTarget:e=>e._babylonAnimationGroup}),me("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:e=>{var t;return(((t=e._babylonAnimationGroup)==null?void 0:t.getCurrentFrame())??0)/60},type:"number",getTarget:e=>e._babylonAnimationGroup})}Lr(Xe,"FlowGraphGLTFDataProvider",async()=>(await _(async()=>{const{FlowGraphGLTFDataProvider:r}=await import("./flowGraphGLTFDataProvider-C4kuehID.js");return{FlowGraphGLTFDataProvider:r}},__vite__mapDeps([2,1]))).FlowGraphGLTFDataProvider);L(Xe);S(Xe,!0,r=>new es(r));const Gt="KHR_node_visibility";me("/nodes/{}/extensions/KHR_node_visibility/visible",{get:r=>{const e=r._babylonTransformNode;return e&&e.isVisible!==void 0?e.isVisible:!0},set:(r,e)=>{var t,n;(t=e._primitiveBabylonMeshes)==null||t.forEach(o=>{o.inheritVisibility=!0}),e._babylonTransformNode&&(e._babylonTransformNode.isVisible=r),(n=e._primitiveBabylonMeshes)==null||n.forEach(o=>{o.isVisible=r})},getTarget:r=>r._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class ns{constructor(e){this.name=Gt,this._loader=e,this.enabled=e.isExtensionUsed(Gt)}async onReady(){var e;(e=this._loader.gltf.nodes)==null||e.forEach(t=>{var n,o,s,a;(n=t._primitiveBabylonMeshes)==null||n.forEach(i=>{i.inheritVisibility=!0}),(o=t.extensions)!=null&&o.KHR_node_visibility&&((s=t.extensions)==null?void 0:s.KHR_node_visibility.visible)===!1&&(t._babylonTransformNode&&(t._babylonTransformNode.isVisible=!1),(a=t._primitiveBabylonMeshes)==null||a.forEach(i=>{i.isVisible=!1}))})}dispose(){this._loader=null}}L(Gt);S(Gt,!0,r=>new ns(r));const Je="KHR_node_selectability";En("event/onSelect",Je,{blocks:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer(r){return["pickedMesh_"+r[0]]}}},outputs:{values:{selectedNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(r,e,t,n,o,s,a){var u,h,d,p,m,b;const i=o[o.length-1];i.config=i.config||{},i.config.glTF=a;const l=(h=(u=r.configuration)==null?void 0:u.nodeIndex)==null?void 0:h.value[0];if(l===void 0||typeof l!="number")throw new Error("nodeIndex not found in configuration");const c="pickedMesh_"+l;return o[1].config.variable=c,s._userVariables[c]={className:"Mesh",id:(p=(d=a==null?void 0:a.nodes)==null?void 0:d[l]._babylonTransformNode)==null?void 0:p.id,uniqueId:(b=(m=a==null?void 0:a.nodes)==null?void 0:m[l]._babylonTransformNode)==null?void 0:b.uniqueId},o}});me("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:r=>{const e=r._babylonTransformNode;return e&&e.isPickable!==void 0?e.isPickable:!0},set:(r,e)=>{var t;(t=e._primitiveBabylonMeshes)==null||t.forEach(n=>{n.isPickable=r})},getTarget:r=>r._babylonTransformNode,getPropertyName:[()=>"isPickable"],type:"boolean"});class rs{constructor(e){this.name=Je,this._loader=e,this.enabled=e.isExtensionUsed(Je)}async onReady(){var e;(e=this._loader.gltf.nodes)==null||e.forEach(t=>{var n,o,s;(n=t.extensions)!=null&&n.KHR_node_selectability&&((o=t.extensions)==null?void 0:o.KHR_node_selectability.selectable)===!1&&((s=t._babylonTransformNode)==null||s.getChildMeshes().forEach(a=>{a.isPickable=!1}))})}dispose(){this._loader=null}}L(Je);S(Je,!0,r=>new rs(r));const Se="KHR_node_hoverability",Rn="targetMeshPointerOver_";En("event/onHoverIn",Se,{blocks:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer(r){return[Rn+r[0]]}}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(r,e,t,n,o,s,a){var u,h,d,p,m,b;const i=o[o.length-1];i.config=i.config||{},i.config.glTF=a;const l=(h=(u=r.configuration)==null?void 0:u.nodeIndex)==null?void 0:h.value[0];if(l===void 0||typeof l!="number")throw new Error("nodeIndex not found in configuration");const c=Rn+l;return o[1].config.variable=c,s._userVariables[c]={className:"Mesh",id:(p=(d=a==null?void 0:a.nodes)==null?void 0:d[l]._babylonTransformNode)==null?void 0:p.id,uniqueId:(b=(m=a==null?void 0:a.nodes)==null?void 0:m[l]._babylonTransformNode)==null?void 0:b.uniqueId},o}});const Mn="targetMeshPointerOut_";En("event/onHoverOut",Se,{blocks:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer(r){return[Mn+r[0]]}}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(r,e,t,n,o,s,a){var u,h,d,p,m,b;const i=o[o.length-1];i.config=i.config||{},i.config.glTF=a;const l=(h=(u=r.configuration)==null?void 0:u.nodeIndex)==null?void 0:h.value[0];if(l===void 0||typeof l!="number")throw new Error("nodeIndex not found in configuration");const c=Mn+l;return o[1].config.variable=c,s._userVariables[c]={className:"Mesh",id:(p=(d=a==null?void 0:a.nodes)==null?void 0:d[l]._babylonTransformNode)==null?void 0:p.id,uniqueId:(b=(m=a==null?void 0:a.nodes)==null?void 0:m[l]._babylonTransformNode)==null?void 0:b.uniqueId},o}});me("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:r=>{const e=r._babylonTransformNode;return e&&e.pointerOverDisableMeshTesting!==void 0?e.pointerOverDisableMeshTesting:!0},set:(r,e)=>{var t;(t=e._primitiveBabylonMeshes)==null||t.forEach(n=>{n.pointerOverDisableMeshTesting=!r})},getTarget:r=>r._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class os{constructor(e){this.name=Se,this._loader=e,this.enabled=e.isExtensionUsed(Se)}async onReady(){var e;(e=this._loader.gltf.nodes)==null||e.forEach(t=>{var n,o,s;(n=t.extensions)!=null&&n.KHR_node_hoverability&&((o=t.extensions)==null?void 0:o.KHR_node_hoverability.hoverable)===!1&&((s=t._babylonTransformNode)==null||s.getChildMeshes().forEach(a=>{a.pointerOverDisableMeshTesting=!0}))})}dispose(){this._loader=null}}L(Se);S(Se,!0,r=>new os(r));const vn="ExtrasAsMetadata";class ss{_assignExtras(e,t){if(t.extras&&Object.keys(t.extras).length>0){const n=e.metadata=e.metadata||{},o=n.gltf=n.gltf||{};o.extras=t.extras}}constructor(e){this.name=vn,this.enabled=!0,this._loader=e}dispose(){this._loader=null}loadNodeAsync(e,t,n){return this._loader.loadNodeAsync(e,t,o=>{this._assignExtras(o,t),n(o)})}loadCameraAsync(e,t,n){return this._loader.loadCameraAsync(e,t,o=>{this._assignExtras(o,t),n(o)})}createMaterial(e,t,n){const o=this._loader.createMaterial(e,t,n);return this._assignExtras(o,t),o}}L(vn);S(vn,!1,r=>new ss(r));
